import{_ as s,c as a}from"./app.1414484b.js";var n="/naive-dafou-ui-dist/assets/image-20211224010431041.724671b6.png",e="/naive-dafou-ui-dist/assets/image-20211224010629655.55c2aa61.png",t="/naive-dafou-ui-dist/assets/image-20211224011604544.44938a93.png",l="/naive-dafou-ui-dist/assets/image-20211224012136190.48f580c6.png",p="/naive-dafou-ui-dist/assets/image-20211224012619136.273d445b.png",i="/naive-dafou-ui-dist/assets/image-20211224014326516.855c6617.png",o="/naive-dafou-ui-dist/assets/image-20211224025156998.68470623.png",c="/naive-dafou-ui-dist/assets/image-20211224085108789.0334dddc.png",u="/naive-dafou-ui-dist/assets/image-20211224034826081.3594ad71.png",r="/naive-dafou-ui-dist/assets/image-20211224053414949.bbfaecae.png",d="/naive-dafou-ui-dist/assets/image-20211224065652526.81a5ae45.png",m="/naive-dafou-ui-dist/assets/image-20211224070212837.f0901fff.png",v="/naive-dafou-ui-dist/assets/image-20211224070336571.c6dd4890.png",k="/naive-dafou-ui-dist/assets/image-20211224074134432.1e924eef.png",b="/naive-dafou-ui-dist/assets/image-20211224074334715.a86538f8.png",g="/naive-dafou-ui-dist/assets/image-20211224075815566.2dbe7990.png",h="/naive-dafou-ui-dist/assets/image-20211224075921059.2f1c626b.png",q="/naive-dafou-ui-dist/assets/image-20211224080959841.c37f2edb.png",y="/naive-dafou-ui-dist/assets/image-20211224090044004.48fc5594.png",_="/naive-dafou-ui-dist/assets/image-20211224091127912.bcfe0fef.png",f="/naive-dafou-ui-dist/assets/image-20211224091636336.7014c854.png",E="/naive-dafou-ui-dist/assets/image-20211226151649058.63689a13.png",T="/naive-dafou-ui-dist/assets/image-20211226151722687.939e5286.png",x="/naive-dafou-ui-dist/assets/image-20211226153109553.76cb24bd.png",A="/naive-dafou-ui-dist/assets/image-20211226173035283.6ed18dc8.png",S="/naive-dafou-ui-dist/assets/image-20211226165021623.5747d642.png",R="/naive-dafou-ui-dist/assets/image-20211226171330663.7b7f7457.png",w="/naive-dafou-ui-dist/assets/image-20211226173613506.ce9c10d9.png",M="/naive-dafou-ui-dist/assets/image-20211226174323994.5e85f8a1.png",N="/naive-dafou-ui-dist/assets/image-20211226174249938.248387c4.png",I="/naive-dafou-ui-dist/assets/image-20211226175907515.e94c12ae.png",O="/naive-dafou-ui-dist/assets/image-20211226180425127.00421396.png",L="/naive-dafou-ui-dist/assets/image-20211226180729782.bc37cf4d.png",C="/naive-dafou-ui-dist/assets/image-20211229152537375.1c483f97.png",D="/naive-dafou-ui-dist/assets/image-20211229152624349.e61c111b.png",P="/naive-dafou-ui-dist/assets/image-20211229152656310.6da3ee34.png",H="/naive-dafou-ui-dist/assets/image-20211229152751878.942ca03f.png",U="/naive-dafou-ui-dist/assets/image-20211229152812151.bc278e5a.png",B="/naive-dafou-ui-dist/assets/image-20211229154800755.a96a6284.png",V="/naive-dafou-ui-dist/assets/image-20211229160330906.aca6bb12.png",Q="/naive-dafou-ui-dist/assets/image-20211229163035161.4ee69927.png",Y="/naive-dafou-ui-dist/assets/image-20211229163119622.aa10adc4.png",K="/naive-dafou-ui-dist/assets/image-20211229163502529.a232f366.png",G="/naive-dafou-ui-dist/assets/image-20211229163535962.ee00ab64.png",j="/naive-dafou-ui-dist/assets/image-20211229164448460.fd1c1a52.png",F="/naive-dafou-ui-dist/assets/image-20211229164521978.714e7fd4.png",W="/naive-dafou-ui-dist/assets/image-20211229164652475.647f9e1a.png",z="/naive-dafou-ui-dist/assets/image-20211229164729977.b679260d.png",$="/naive-dafou-ui-dist/assets/image-20211229164803014.5e177713.png",J="/naive-dafou-ui-dist/assets/image-20211229165005263.bbf882e6.png",Z="/naive-dafou-ui-dist/assets/image-20211229165025458.e11f1839.png",X="/naive-dafou-ui-dist/assets/image-20211229165043176.4edbc2f4.png",ss="/naive-dafou-ui-dist/assets/image-20211229165320776.4b054f8d.png",as="/naive-dafou-ui-dist/assets/image-20211229165401450.25c21ca0.png",ns="/naive-dafou-ui-dist/assets/image-20211229170038586.86c843d2.png",es="/naive-dafou-ui-dist/assets/image-20211229170246147.a718c598.png",ts="/naive-dafou-ui-dist/assets/image-20211229170321426.859d1fed.png",ls="/naive-dafou-ui-dist/assets/image-20211229170518057.d2d2c9f1.png",ps="/naive-dafou-ui-dist/assets/image-20211229170544690.074bb61a.png",is="/naive-dafou-ui-dist/assets/image-20211229170626599.3c2dadbd.png",os="/naive-dafou-ui-dist/assets/image-20211229170657558.7873ee9b.png",cs="/naive-dafou-ui-dist/assets/image-20211229170814412.f73ad098.png",us="/naive-dafou-ui-dist/assets/image-20211229170829748.bee9661f.png",rs="/naive-dafou-ui-dist/assets/image-20211229170905008.3d4397ae.png";const ds={},ms=a('<h2 id="\u6982\u8FF0"><a class="header-anchor" href="#\u6982\u8FF0" aria-hidden="true">#</a> \u6982\u8FF0</h2><h3 id="\u662F\u4EC0\u4E48"><a class="header-anchor" href="#\u662F\u4EC0\u4E48" aria-hidden="true">#</a> \u662F\u4EC0\u4E48</h3><p>mycat\u662F\u6570\u636E\u5E93\u4E2D\u95F4\u4EF6</p><ol><li>\u6570\u636E\u5E93\u4E2D\u95F4\u4EF6</li></ol><p>\u4E2D\u95F4\u4EF6\uFF1A\u662F\u4E00\u7C7B\u8FDE\u63A5\u8F6F\u4EF6\u7EC4\u4EF6\u548C\u5E94\u7528\u7684\u8BA1\u7B97\u673A\u8F6F\u4EF6\uFF0C\u4EE5\u4FBF\u4E8E\u8F6F\u4EF6\u5404\u90E8\u4EF6\u4E4B\u95F4\u7684\u6C9F\u901A</p><p>\u4F8B\u5B50\uFF1ATomcat\uFF0Cweb\u4E2D\u95F4\u4EF6</p><p>\u6570\u636E\u5E93\u4E2D\u95F4\u4EF6\uFF1A\u8FDE\u63A5Java\u5E94\u7528\u7A0B\u5E8F\u548C\u6570\u636E\u5E93</p><p><img src="'+n+'" alt="image-20211224010431041"></p><ol start="2"><li>\u6570\u636E\u5E93\u4E2D\u95F4\u4EF6\u5BF9\u6BD4</li></ol><p><img src="'+e+'" alt="image-20211224010629655"></p><h3 id="\u5E72\u4EC0\u4E48"><a class="header-anchor" href="#\u5E72\u4EC0\u4E48" aria-hidden="true">#</a> \u5E72\u4EC0\u4E48</h3><ol><li>\u8BFB\u5199\u5206\u79BB</li></ol><p><img src="'+t+'" alt="image-20211224011604544"></p><ol start="2"><li>\u6570\u636E\u5206\u7247</li></ol><p>\u5782\u76F4\u62C6\u5206\uFF08\u5206\u5E93\uFF09\u3001\u6C34\u5E73\u62C6\u5206\uFF08\u5206\u8868\uFF09\u3001\u5782\u76F4+\u6C34\u5E73\u62C6\u5206\uFF08\u5206\u5E93\u5206\u8868\uFF09</p><p><img src="'+l+'" alt="image-20211224012136190"></p><ol start="3"><li>\u591A\u6570\u636E\u6E90\u6574\u5408</li></ol><p><img src="'+p+'" alt="image-20211224012619136"></p><h3 id="\u539F\u7406"><a class="header-anchor" href="#\u539F\u7406" aria-hidden="true">#</a> \u539F\u7406</h3><p>mycat\u7684\u539F\u7406\u4E2D\u6700\u91CD\u8981\u7684\u4E00\u4E2A\u52A8\u8BCD\u662F&quot;\u62E6\u622A&quot;\uFF0C\u5B83\u62E6\u622A\u4E86\u7528\u6237\u53D1\u9001\u8FC7\u6765\u7684SQL\u8BED\u53E5\uFF0C\u9996\u5148\u5BF9SQL\u8BED\u53E5\u505A\u4E86\u4E00\u4E9B\u7279\u5B9A\u7684\u5206\u6790\uFF1A\u5982\u5206\u7247\u5206\u6790\u3001\u8DEF\u7531\u5206\u6790\u3001\u8BFB\u5199\u5206\u79BB\u5206\u6790\u3001\u7F13\u5B58\u5206\u6790\u7B49\uFF0C\u7136\u540E\u5C06\u6B64SQL\u53D1\u5F80\u540E\u7AEF\u7684\u771F\u662F\u6570\u636E\u5E93\uFF0C\u5E76\u5C06\u8FD4\u56DE\u7684\u7ED3\u679C\u505A\u9002\u5F53\u7684\u5904\u7406\uFF0C\u6700\u7EC8\u518D\u8FD4\u56DE\u7ED9\u7528\u6237</p><p><img src="'+i+`" alt="image-20211224014326516"></p><p>\u8FD9\u79CD\u65B9\u5F0F\u628A\u6570\u636E\u5E93\u7684\u5206\u5E03\u5F0F\u4ECE\u4EE3\u7801\u4E2D\u89E3\u8026\u51FA\u6765\uFF0C\u7A0B\u5E8F\u5458\u5BDF\u89C9\u4E0D\u51FA\u6765\u540E\u53F0\u4F7F\u7528\u4E86mycat\u8FD8\u662Fmysql</p><h2 id="\u5B89\u88C5\u542F\u52A8"><a class="header-anchor" href="#\u5B89\u88C5\u542F\u52A8" aria-hidden="true">#</a> \u5B89\u88C5\u542F\u52A8</h2><p>\u6211\u4EEC\u9700\u8981\u628Amycat\u5B89\u88C5\u5230Linux\u4E2D</p><h3 id="\u5B89\u88C5jdk"><a class="header-anchor" href="#\u5B89\u88C5jdk" aria-hidden="true">#</a> \u5B89\u88C5jdk</h3><p>\u56E0\u4E3Amycat\u662F\u4F7F\u7528Java\u7F16\u5199\u7684\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u5B89\u88C5Java\u73AF\u5883</p><p>\uFF081\uFF09\u521B\u5EFA\u5B89\u88C5\u76EE\u5F55</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> /usr/local/java/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\uFF082\uFF09\u89E3\u538B\u81F3\u5B89\u88C5\u76EE\u5F55</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local/java/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF</p><p>\u6253\u5F00\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728\u672B\u5C3E\u6DFB\u52A0</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/java/jdk1.8.0_171
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span><span class="token variable">\${JAVA_HOME}</span>/jre
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">\${JAVA_HOME}</span>/lib:<span class="token variable">\${JRE_HOME}</span>/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">\${JAVA_HOME}</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u73AF\u5883\u53D8\u91CF\u751F\u6548</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6DFB\u52A0\u8F6F\u94FE\u63A5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">ln</span> -s /usr/local/java/jdk1.8.0_171/bin/java /usr/bin/java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u68C0\u67E5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>java -version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u521B\u5EFAmysql"><a class="header-anchor" href="#\u521B\u5EFAmysql" aria-hidden="true">#</a> \u521B\u5EFAMySQL</h3><p>\u4E3A\u4E86\u80FD\u4F7F\u7528mycat\u8FDE\u63A5\u5230MySQL\uFF0C\u6211\u4EEC\u5728docker\u4E2D\u521B\u5EFA\u4E24\u4E2AMySQL\u955C\u50CF\uFF0C\u4E00\u4E2A\u8FDB\u884C\u8BFB\u5E93\u3001\u4E00\u4E2A\u8FDB\u884C\u5199\u5E93</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.3&quot;</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">mycat_network</span><span class="token punctuation">:</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql_dn_write</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> dn_write
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./dn_write/data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=root&quot;</span>
  <span class="token key atrule">mysql_dn_write</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> dn_read
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3307:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./dn_read/data<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=root&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770Bcontainer</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
5050208c6af6   mysql:5.7   <span class="token string">&quot;docker-entrypoint.s\u2026&quot;</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes   <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, :::3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   dn_write
eae27098f88f   mysql:5.7   <span class="token string">&quot;docker-entrypoint.s\u2026&quot;</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">2</span> minutes   <span class="token number">33060</span>/tcp, <span class="token number">0.0</span>.0.0:3307-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, :::3307-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp   dn_read
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9A8C\u8BC1\u6570\u636E\u5E93\u7684\u8BBF\u95EE\u60C5\u51B5\uFF0C\u6211\u4EEC\u5728\u672C\u5730\u7684\u7EC8\u7AEF\u8BBF\u95EELinux\u4E0Bdocker\u4E2D\u7684\u6570\u636E\u5E93</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -uroot -proot -h <span class="token number">172.16</span>.187.17 -P <span class="token number">3306</span> <span class="token comment">## \u5199\u5E93</span>
mysql -uroot -proot -h <span class="token number">172.16</span>.187.17 -P <span class="token number">3307</span> <span class="token comment">## \u8BFB\u5E93</span>
<span class="token comment">## \u5982\u679C\u4E0D\u80FD\u8BBF\u95EE\uFF0C\u5C1D\u8BD5\u5C06Linux\u7684\u9632\u706B\u5899\u5173\u95ED</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+o+`" alt="image-20211224025156998"></p><h3 id="\u5B89\u88C5"><a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a> \u5B89\u88C5</h3><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">##</span> linux\u4E0B\u7684\u5B89\u88C5\u65B9\u5F0F</span>
<span class="token list punctuation">-</span> rpm\u65B9\u5F0F .rpm\u5B89\u88C5\u5305\uFF0C\u591A\u4E2Arpm\u7684\u60C5\u51B5\u4E0B\uFF0C\u9700\u8981\u6309\u987A\u5E8F\u5B89\u88C5
<span class="token list punctuation">-</span> yum\u65B9\u5F0F \u9700\u8981\u8054\u7F51
<span class="token list punctuation">-</span> \u89E3\u538B\u5305\uFF0C\u89E3\u538B\u540E\u5373\u53EF\u7528
<span class="token list punctuation">-</span> \u6E90\u7801\u5305\uFF0C\u89E3\u538B\u540E\u7F16\u8BD1\u5B89\u88C5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u89E3\u538B\u540E\u5373\u53EF\u4F7F\u7528\uFF0C\u89E3\u538B\u538B\u7F29\u6587\u4EF6\u62F7\u8D1D\u5230linux\u4E0B<code>/usr/local/</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## ll</span>
\u603B\u7528\u91CF <span class="token number">12</span>
drwxr-xr-x. <span class="token number">2</span> root root  <span class="token number">190</span> <span class="token number">12</span>\u6708 <span class="token number">24</span> 01:57 bin
drwxrwxrwx. <span class="token number">2</span> root root    <span class="token number">6</span> <span class="token number">6</span>\u6708  <span class="token number">24</span> <span class="token number">2019</span> catlet
drwxrwxrwx. <span class="token number">4</span> root root <span class="token number">4096</span> <span class="token number">12</span>\u6708 <span class="token number">24</span> 01:57 conf
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">4096</span> <span class="token number">12</span>\u6708 <span class="token number">24</span> 01:57 lib
drwxrwxrwx. <span class="token number">2</span> root root    <span class="token number">6</span> <span class="token number">6</span>\u6708  <span class="token number">26</span> <span class="token number">2019</span> logs
-rwxrwxrwx. <span class="token number">1</span> root root  <span class="token number">227</span> <span class="token number">6</span>\u6708  <span class="token number">27</span> <span class="token number">2019</span> version.txt
<span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## pwd</span>
/usr/local/mycat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E09\u4E2A\u914D\u7F6E\u6587\u4EF6<code>cd conf/</code></p><ul><li>schema.xml \u5B9A\u4E49\u903B\u8F91\u8868\uFF0C\u8868\u3001\u5206\u7247\u8282\u70B9\u7B49\u5185\u5BB9</li><li>rule.xml \u5B9A\u4E49\u5206\u7247\u89C4\u5219</li><li>server.xml \u5B9A\u4E49\u7528\u6237\u4EE5\u53CA\u7CFB\u7EDF\u76F8\u5173\u53D8\u91CF\uFF0C\u5982\u7AEF\u53E3\u7B49</li></ul><h3 id="\u542F\u52A8"><a class="header-anchor" href="#\u542F\u52A8" aria-hidden="true">#</a> \u542F\u52A8</h3><ol><li>\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6server.xml</li></ol><p>\u4FEE\u6539\u7528\u6237\u4FE1\u5FC3\uFF0C\u4E0EMySQL\u533A\u5206\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&lt;</span>user <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;mycat&quot;</span> <span class="token assign-left variable">defaultAccount</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span> <span class="token comment">## \u8FD9\u91CC\u6539\u6210mycat</span>
  <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span><span class="token number">12345</span><span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span>/property<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;schemas&quot;</span><span class="token operator">&gt;</span>TESTDB<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span> <span class="token comment">## \u903B\u8F91\u5E93 TESTDB</span>

  <span class="token operator">&lt;</span><span class="token operator">!</span>-- \u8868\u7EA7 DML \u6743\u9650\u8BBE\u7F6E --<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span>--
  <span class="token operator">&lt;</span>privileges <span class="token assign-left variable">check</span><span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>schema <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;TESTDB&quot;</span> <span class="token assign-left variable">dml</span><span class="token operator">=</span><span class="token string">&quot;0110&quot;</span> <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>table <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;tb01&quot;</span> <span class="token assign-left variable">dml</span><span class="token operator">=</span><span class="token string">&quot;0000&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/table<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>table <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;tb02&quot;</span> <span class="token assign-left variable">dml</span><span class="token operator">=</span><span class="token string">&quot;1111&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/table<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/schema<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/privileges<span class="token operator">&gt;</span>
  --<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/user<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6schema.xml</li></ol><p>schema\u6807\u7B7E\u5B9A\u4E49\u4E86\u8868\u4FE1\u606F\uFF0C\u56E0\u4E3A\u6211\u4EEC\u6682\u65F6\u8FD8\u6CA1\u6709\u8FD9\u4E9B\uFF0C\u6240\u4EE5\u5148\u5220\u9664\uFF0C\u5E76\u5728\u8BE5\u8282\u70B9\u4E0A\u5B9A\u4E49\u903B\u8F91\u5E93\u7684\u8282\u70B9</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u5220\u9664\u591A\u884C\u53EF\u4EE5\u4F7F\u7528<span class="token code-snippet code keyword">\`d\u884C\u6570d\`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>dataNode\u5B9A\u4E49\u4E86\u8282\u70B9\u4FE1\u606F\uFF0C\u56E0\u4E3A\u5E76\u6CA1\u6709\u90A3\u4E48\u591A\u6570\u636E\u8282\u70B9\uFF0C\u6240\u4EE5\u6211\u4EEC\u5148\u5220\u9664\u5176\u4ED6\u7684\u8282\u70B9\uFF0CdataHost\u5B9A\u4E49\u4E86\u8FDE\u63A5\u7684\u6570\u636E\u5E93\uFF0C\u6211\u4EEC\u5C06\u521A\u624D\u5728docker\u4E2D\u521B\u5EFA\u7684MySQL\u4FE1\u606F\u586B\u5199\u8FDB\u5165</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mycat:schema SYSTEM <span class="token string">&quot;schema.dtd&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mycat:schema xmlns:mycat<span class="token operator">=</span><span class="token string">&quot;http://io.mycat/&quot;</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>schema <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;TESTDB&quot;</span> <span class="token assign-left variable">checkSQLschema</span><span class="token operator">=</span><span class="token string">&quot;false&quot;</span> <span class="token assign-left variable">sqlMaxLimit</span><span class="token operator">=</span><span class="token string">&quot;100&quot;</span> <span class="token assign-left variable">dataNode</span><span class="token operator">=</span><span class="token string">&quot;dn1&quot;</span><span class="token operator">&gt;</span> <span class="token comment">## \u8FD9\u91CC\u914D\u7F6E dataNode=&quot;dn1&quot;</span>
        <span class="token operator">&lt;</span>/schema<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dataNode <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;dn1&quot;</span> <span class="token assign-left variable">dataHost</span><span class="token operator">=</span><span class="token string">&quot;localhost1&quot;</span> <span class="token assign-left variable">database</span><span class="token operator">=</span><span class="token string">&quot;db1&quot;</span> /<span class="token operator">&gt;</span> <span class="token comment">## localhost1\u8868\u793A\u8FDE\u63A5\u5230\u7269\u7406\u6570\u636E\u5E93\u7684\u8FDE\u63A5\u4FE1\u606F</span>
        <span class="token operator">&lt;</span>dataHost <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;localhost1&quot;</span> <span class="token assign-left variable">maxCon</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span> <span class="token assign-left variable">minCon</span><span class="token operator">=</span><span class="token string">&quot;10&quot;</span> <span class="token assign-left variable">balance</span><span class="token operator">=</span><span class="token string">&quot;0&quot;</span>
                          <span class="token assign-left variable">writeType</span><span class="token operator">=</span><span class="token string">&quot;0&quot;</span> <span class="token assign-left variable">dbType</span><span class="token operator">=</span><span class="token string">&quot;mysql&quot;</span> <span class="token assign-left variable">dbDriver</span><span class="token operator">=</span><span class="token string">&quot;native&quot;</span> <span class="token assign-left variable">switchType</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span>  <span class="token assign-left variable">slaveThreshold</span><span class="token operator">=</span><span class="token string">&quot;100&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>heartbeat<span class="token operator">&gt;</span>select user<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>/heartbeat<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span>-- can have multi <span class="token function">write</span> hosts --<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>writeHost <span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">&quot;hostM1&quot;</span> <span class="token assign-left variable">url</span><span class="token operator">=</span><span class="token string">&quot;172.16.187.17:3306&quot;</span> <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span>
                                   <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span>-- can have multi <span class="token builtin class-name">read</span> hosts --<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>readHost <span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">&quot;hostS2&quot;</span> <span class="token assign-left variable">url</span><span class="token operator">=</span><span class="token string">&quot;172.16.187.17:3307&quot;</span> <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> /<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>/writeHost<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dataHost<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/mycat:schema<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u9A8C\u8BC1\u6570\u636E\u5E93\u7684\u8BBF\u95EE\u60C5\u51B5</li></ol><p>\u521A\u624D\u6211\u4EEC\u5728docker\u4E2D\u5B89\u88C5MySQL\u7684\u65F6\u5019\u5DF2\u7ECF\u6D4B\u8BD5\u8FC7\u4E86\uFF0C\u53EF\u4EE5\u8FDE\u63A5</p><ol start="4"><li>\u542F\u52A8\u7A0B\u5E8F</li></ol><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">##</span> 6\u4E2A\u7279\u6B8A\u7684\u76EE\u5F55\uFF1A\u5728Linux\u4E0B\u67096\u4E2A\u76EE\u5F55\u5728\u6574\u4E2ALinux\u4E0B\u4EFB\u610F\u4F4D\u7F6E\u90FD\u53EF\u4EE5\u6267\u884C\u8FD9\u91CC\u9762\u7684\u811A\u672C\uFF0C\u5E76\u4E14\u4E0D\u9700\u8981\u52A0./</span>
<span class="token list punctuation">-</span> bin
<span class="token list punctuation">-</span> usr/bin
<span class="token list punctuation">-</span> usr/local/bin
<span class="token list punctuation">-</span> sbin
<span class="token list punctuation">-</span> usr/sbin
<span class="token list punctuation">-</span> usr/local/sbin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u63A7\u5236\u53F0\u542F\u52A8\uFF1A\u8FDB\u5165<code>mycat/bin</code>\u76EE\u5F55\u4E0B\u6267\u884C<code>./mycat console</code></li><li>\u540E\u53F0\u542F\u52A8\uFF1A\u8FDB\u5165<code>mycat/bin</code>\u76EE\u5F55\u4E0B\u6267\u884C<code>./mycat start</code></li></ul><p>\u4E3A\u4E86\u80FD\u7B2C\u4E00\u65F6\u95F4\u770B\u5230\u542F\u52A8\u65E5\u5FD7\uFF0C\u65B9\u4FBF\u5B9A\u4F4D\u95EE\u9898\uFF0C\u6211\u4EEC\u9009\u62E9\u63A7\u5236\u53F0\u542F\u52A8</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## ./bin/mycat console</span>
Running Mycat-server<span class="token punctuation">..</span>.
wrapper  <span class="token operator">|</span> --<span class="token operator">&gt;</span> Wrapper Started as Console
wrapper  <span class="token operator">|</span> Launching a JVM<span class="token punctuation">..</span>.
jvm <span class="token number">1</span>    <span class="token operator">|</span> Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM warning: ignoring option <span class="token assign-left variable">MaxPermSize</span><span class="token operator">=</span>64M<span class="token punctuation">;</span> support was removed <span class="token keyword">in</span> <span class="token number">8.0</span>
jvm <span class="token number">1</span>    <span class="token operator">|</span> Wrapper <span class="token punctuation">(</span>Version <span class="token number">3.2</span>.3<span class="token punctuation">)</span> http://wrapper.tanukisoftware.org
jvm <span class="token number">1</span>    <span class="token operator">|</span>   Copyright <span class="token number">1999</span>-2006 Tanuki Software, Inc.  All Rights Reserved.
jvm <span class="token number">1</span>    <span class="token operator">|</span>
jvm <span class="token number">1</span>    <span class="token operator">|</span> MyCAT Server startup successfully. see logs <span class="token keyword">in</span> logs/mycat.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u767B\u5F55"><a class="header-anchor" href="#\u767B\u5F55" aria-hidden="true">#</a> \u767B\u5F55</h3><ol><li>\u767B\u5F55\u540E\u53F0\u7BA1\u7406\u7A97\u53E3</li></ol><p>\u6B64\u767B\u5F55\u65B9\u5F0F\u7528\u4E8E\u7BA1\u7406\u7EF4\u62A4mycat</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -P <span class="token number">9066</span> -h <span class="token number">172.16</span>.187.19
<span class="token comment">## \u6267\u884C\u6548\u679C \u5982\u679C\u4E0D\u80FD\u8FDE\u63A5\uFF0C\u67E5\u770B\u662F\u5426\u5173\u95ED\u9632\u706B\u5899</span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> aldencarter@aldencarter ~ % mysql -umycat -p123456 -P <span class="token number">9066</span> -h <span class="token number">172.16</span>.187.19
mysql: <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> Using a password on the <span class="token builtin class-name">command</span> line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">1</span>
Server version: <span class="token number">5.6</span>.29-mycat-1.6.7.1-release-20190627191042 MyCat Server <span class="token punctuation">(</span>monitor<span class="token punctuation">)</span> <span class="token comment">## \u8FD9\u91CC\u662Fmonitor</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2020</span>, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">&#39;help;&#39;</span> or <span class="token string">&#39;\\h&#39;</span> <span class="token keyword">for</span> help. Type <span class="token string">&#39;\\c&#39;</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u767B\u5F55\u6570\u636E\u7A97\u53E3</li></ol><p>\u6B64\u767B\u5F55\u65B9\u5F0F\u7528\u4E8E\u901A\u8FC7mycat\u67E5\u8BE2\u6570\u636E\uFF0C\u6211\u4EEC\u9009\u62E9\u8FD9\u79CD\u65B9\u5F0F\u8BBF\u95EEmycat</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">172.16</span>.187.19 -P <span class="token number">8066</span>
<span class="token comment">## \u6267\u884C\u7ED3\u679C</span>
<span class="token punctuation">(</span>base<span class="token punctuation">)</span> aldencarter@aldencarter ~ % mysql -umycat -p123456 -h <span class="token number">172.16</span>.187.19 -P <span class="token number">8066</span>
mysql: <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> Using a password on the <span class="token builtin class-name">command</span> line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">2</span>
Server version: <span class="token number">5.6</span>.29-mycat-1.6.7.1-release-20190627191042 MyCat Server <span class="token punctuation">(</span>OpenCloudDB<span class="token punctuation">)</span> <span class="token comment">## \u8FD9\u91CC\u662Fmycat server OpenCloudDB</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2020</span>, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">&#39;help;&#39;</span> or <span class="token string">&#39;\\h&#39;</span> <span class="token keyword">for</span> help. Type <span class="token string">&#39;\\c&#39;</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5E38\u7528\u7684\u547D\u4EE4</p><ul><li><code>show databases;</code></li><li><code>use TESTDB</code></li><li><code>show tables;</code></li></ul><h2 id="\u642D\u5EFA\u8BFB\u5199\u5206\u79BB"><a class="header-anchor" href="#\u642D\u5EFA\u8BFB\u5199\u5206\u79BB" aria-hidden="true">#</a> \u642D\u5EFA\u8BFB\u5199\u5206\u79BB</h2><p>\u5728\u642D\u5EFAmycat\u7684\u8BFB\u5199\u5206\u79BB\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u914D\u7F6Emysql\u7684\u4E3B\u4ECE\u590D\u5236</p><p>\u6211\u4EEC\u901A\u8FC7mycat\u548CMySQL\u7684\u4E3B\u4ECE\u590D\u5236\u914D\u5408\u642D\u5EFA\u6570\u636E\u5E93\u7684\u8BFB\u5199\u5206\u79BB\uFF0C\u5B9E\u73B0MySQL\u7684\u9AD8\u53EF\u7528\u6027\u3002\u6211\u4EEC\u5C06\u642D\u5EFA\uFF1A\u4E00\u4E3B\u4E00\u4ECE\u3001\u53CC\u4E3B\u53CC\u4ECE\u4E24\u79CD\u8BFB\u5199\u5206\u79BB\u6A21\u5F0F</p><h3 id="\u4E00\u4E3B\u4E00\u4ECE"><a class="header-anchor" href="#\u4E00\u4E3B\u4E00\u4ECE" aria-hidden="true">#</a> \u4E00\u4E3B\u4E00\u4ECE</h3><p>\u4E00\u4E2A\u4E3B\u673A\u7528\u4E8E\u5904\u7406\u6240\u6709\u5199\u8BF7\u6C42\uFF0C\u4E00\u53F0\u4ECE\u673A\u8D1F\u8D23\u6240\u6709\u8BFB\u8BF7\u6C42\uFF0C\u67B6\u6784\u56FE\u5982\u4E0B\uFF1A</p><p><img src="`+c+'" alt="image-20211224085108789"></p><h4 id="\u642D\u5EFAmysql\u6570\u636E\u5E93\u4E3B\u4ECE\u590D\u5236"><a class="header-anchor" href="#\u642D\u5EFAmysql\u6570\u636E\u5E93\u4E3B\u4ECE\u590D\u5236" aria-hidden="true">#</a> \u642D\u5EFAMySQL\u6570\u636E\u5E93\u4E3B\u4ECE\u590D\u5236</h4><h5 id="\u4E3B\u4ECE\u590D\u5236\u7684\u539F\u7406"><a class="header-anchor" href="#\u4E3B\u4ECE\u590D\u5236\u7684\u539F\u7406" aria-hidden="true">#</a> \u4E3B\u4ECE\u590D\u5236\u7684\u539F\u7406</h5><p>\u4E3B\u673A\u628A\u6240\u6709\u7684\u5199\u64CD\u4F5C\u90FD\u5199\u5165\u5230\u65E5\u5FD7\u6587\u4EF6\u4E2D\uFF0C\u4ECE\u673A\u8BFB\u53D6\u4E3B\u673A\u7684\u65E5\u5FD7\u6587\u4EF6\uFF0C\u7136\u540E\u653E\u5230\u4E00\u4E2A\u4E2D\u7EE7\u65E5\u5FD7\u4E2D\uFF0C\u4E4B\u540E\u5728\u6267\u884C\u65E5\u5FD7\u5199\u5165\u6570\u636E</p><p>\u548CRedis\u76F8\u540C\u7684\u662F</p><ul><li>\u4E3B\u673A\u53EA\u80FD\u6709\u4E00\u53F0\uFF0C\u4ECE\u673A\u80FD\u6709\u591A\u53F0</li></ul><p>\u548CRedis\u4E0D\u540C\u7684\u662F</p><ul><li>Redis\u662F\u4ECE\u5934\u5F00\u59CB\u590D\u5236</li><li>MySQL\u662F\u4ECE\u63A5\u5165\u70B9\u5F00\u59CB\u590D\u5236</li></ul><p>\u56E0\u4E3A\u4F7F\u7528\u4E86IO\u7EBF\u7A0B\uFF0C\u6240\u4EE5\u5B58\u5728\u4E00\u4E2A\u5EF6\u65F6\u6027\u7684\u95EE\u9898</p><p><img src="'+u+`" alt="image-20211224034826081"></p><h5 id="\u914D\u7F6E"><a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a> \u914D\u7F6E</h5><p>\u5728\u4E0A\u9762\u642D\u5EFA\u7684docker\u4E2D\u6211\u4EEC\u4F7F\u75283306\u7AEF\u53E3\u7684MySQL\u4F5C\u4E3A\u4E3B\u673A\uFF0C\u4F7F\u75283307\u7684\u7AEF\u53E3\u4F5C\u4E3A\u4ECE\u673A</p><p>\u6211\u4EEC\u4E3A\u4E86\u4FEE\u6539\u914D\u7F6E\uFF0C\u9700\u8981\u628A<code>/etc/mysql/</code>\u6302\u8F7D\u51FA\u6765\uFF0C\u6240\u4EE5\u6211\u4EEC\u5148\u628A\u5F53\u524Dcompose\u79FB\u9664</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## docker-compose down</span>
Stopping dn_write <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Stopping dn_read  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Removing dn_write <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Removing dn_read  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Removing network mycat_mycat_network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728dn_read/conf\u548Cdn_write/conf\u76EE\u5F55\u4E0B\u521B\u5EFAmy.cnf</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span>mysql
character-set-server<span class="token operator">=</span>utf8
<span class="token assign-left variable">default_authentication_plugin</span><span class="token operator">=</span>mysql_native_password

<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8

<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6\uFF0C\u6302\u8F7DMySQL\u914D\u7F6E\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.3&quot;</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">mycat_network</span><span class="token punctuation">:</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql_dn_write</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> dn_write
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./dn_write/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ./dn_write/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span>
  <span class="token key atrule">mysql_dn_read</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> dn_read
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3307:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./dn_read/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ./dn_read/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u91CD\u65B0\u542F\u52A8<code>docker-compose up -d</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## docker-compose up -d</span>
Creating network <span class="token string">&quot;mycat_mycat_network&quot;</span> with the default driver
Creating dn_write <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating dn_read  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>\u4E3B\u673A\u914D\u7F6E</li></ol><p>\u4FEE\u6539<code>vim dn_write/conf/my.cnf</code>\u914D\u7F6E\u6587\u4EF6</p><p>\u6DFB\u52A0\u914D\u7F6E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u4E3B\u670D\u52A1\u5668\u552F\u4E00ID</span>
server-id<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">## \u542F\u7528\u4E8C\u8FDB\u5236\u65E5\u5FD7</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">## \u8BBE\u7F6E\u4E0D\u8981\u590D\u5236\u7684\u6570\u636E\u5E93(\u53EF\u8BBE\u7F6E\u591A\u4E2A)</span>
binlog-ignore-db<span class="token operator">=</span>mysql
binlog-ignore-db<span class="token operator">=</span>information_schema
<span class="token comment">## \u8BBE\u7F6E\u9700\u8981\u590D\u5236\u7684\u6570\u636E\u5E93 \u56E0\u4E3A\u590D\u5236\u662F\u4ECE\u63A5\u5165\u70B9\u5F00\u59CB\u590D\u5236\u7684\uFF0C\u6240\u4EE5\u5E94\u8BE5\u662F\u5199\u4E00\u4E2A\u6CA1\u6709\u521B\u5EFA\u8FC7\u7684\u6570\u636E\u5E93</span>
binlog-do-db<span class="token operator">=</span>testdb
<span class="token comment">## \u8BBE\u7F6Elogbin\u683C\u5F0F</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>STATEMENT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>binlog\u65E5\u5FD7\u5B58\u50A8\u7684\u4E09\u79CD\u6A21\u5F0F</p><p><img src="`+r+`" alt="image-20211224053414949"></p><ol start="2"><li>\u4ECE\u673A\u914D\u7F6E</li></ol><p>\u4FEE\u6539<code>vim dn_read/conf/my.cnf</code>\u914D\u7F6E\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u4ECE\u670D\u52A1\u5668\u552F\u4E00ID</span>
server-id<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment">## \u542F\u7528\u4E2D\u7EE7\u65E5\u5FD7</span>
relay-log<span class="token operator">=</span>mysql-relay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u91CD\u542F\u4E3B\u673A\u548C\u4ECE\u673A</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## docker-compose down ## \u53EF\u4EE5\u4F7F\u7528restart</span>
Stopping dn_read  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Stopping dn_write <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Removing dn_read  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Removing dn_write <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Removing network mycat_mycat_network
<span class="token punctuation">[</span>root@localhost mycat<span class="token punctuation">]</span><span class="token comment">## docker-compose up -d</span>
Creating network <span class="token string">&quot;mycat_mycat_network&quot;</span> with the default driver
Creating dn_write <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating dn_read  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>\u5728\u4E3B\u673A\u4E0A\u5EFA\u7ACB\u8D26\u53F7\u5E76\u6388\u6743slave</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u5728\u4E3B\u673AMySQL\u91CC\u6267\u884C\u6388\u6743\u547D\u4EE4</span>
GRANT REPLICATION SLAVE ON *.* TO <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
<span class="token comment">## \u7ED3\u679C</span>
mysql<span class="token operator">&gt;</span> GRANT REPLICATION SLAVE ON *.* TO <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u8BE2master\u7684\u72B6\u6001</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>show master status;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u6B64\u65F6\uFF0C\u53D1\u73B0\u5E76\u6CA1\u6709\u751F\u6548\uFF0C\u8FDB\u5165\u5BB9\u5668\u5185\u90E8\u67E5\u8BE2</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>root@999a93548efe:/<span class="token comment">## mysql --help | grep my.cnf</span>
mysql: <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> unknown variable <span class="token string">&#39;server-id=1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u89E3\u51B3\u65B9\u6848\uFF1A</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u5BF9\u6211\u6765\u8BF4\uFF0C\u5B83\u7684\u5DE5\u4F5C\u539F\u7406\u662F\u5C06 /etc/mysql/conf.d/my.cnf \u91CD\u547D\u540D\u4E3A /etc/mysql/conf.d/my.ini

\u6211\u4E0D\u786E\u5B9A\u5176\u786E\u5207\u539F\u56E0\uFF08\u8BF7\u968F\u610F\u7F16\u8F91\u6B64\u7B54\u6848\u5E76\u6DFB\u52A0\u5230\u5176\u4E2D\uFF09

\u6211\u5C1D\u8BD5\u4E86\u5404\u79CD\u7EC4\u5408\uFF1A

\u4FDD\u6301\u53D8\u91CF\u4E3A\uFF1Aserver-id\u548Cserver_id
\u4FDD\u6301\u7EC4/\u90E8\u5206\u4E3A\uFF1A[mysql]\u548C[mysqld]
\u5C06\u6587\u4EF6\u91CD\u547D\u540D\u4E3A\uFF1Amy.cnf, mysqld.cnf, mysql.cnf,my.ini
\u60A8\u53EF\u4EE5\u7EE7\u7EED\u5C1D\u8BD5\u4E0A\u8FF0\u9009\u9879\u4E2D\u7684\u5404\u79CD\u7EC4\u5408\uFF0C\u5B83\u80AF\u5B9A\u4F1A\u594F\u6548\u3002:)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u8FD9\u91CC\u662F\u628A\u5B83\u653E\u5230\u4E86[mysqld]\u4E0B\u5C31\u751F\u6548\u4E86</p></blockquote><p>\u8BB0\u5F55\u4E0BFile\u548CPosition\u7684\u503C\uFF0C\u6267\u884C\u5B8C\u6B64\u6B65\u9AA4\u540E\u4E0D\u8981\u518D\u64CD\u4F5C\u4E3B\u670D\u52A1\u5668MySQL\uFF0C\u9632\u6B62\u4E3B\u670D\u52A1\u5668\u72B6\u6001\u503C\u53D8\u5316</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+------------------+----------+--------------+--------------------------+-------------------+
<span class="token operator">|</span> File             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB         <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+------------------+----------+--------------+--------------------------+-------------------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>      <span class="token number">154</span> <span class="token operator">|</span> testdb       <span class="token operator">|</span> mysql,information_schema <span class="token operator">|</span>                   <span class="token operator">|</span>
+------------------+----------+--------------+--------------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>\u5728\u4ECE\u673A\u4E0A\u914D\u7F6E\u9700\u8981\u590D\u5236\u7684\u4E3B\u673A</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u590D\u5236\u4E3B\u673A\u7684\u547D\u4EE4</span>
CHANGE MASTER TO <span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token string">&#39;172.16.187.17&#39;</span>,
<span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token string">&#39;slave&#39;</span>,
<span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token string">&#39;123456&#39;</span>,
<span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">&#39;mysql-bin.000001&#39;</span>,MASTER_LOG_POS<span class="token operator">=</span><span class="token number">154</span><span class="token punctuation">;</span>
<span class="token comment">## \u6267\u884C\u7ED3\u679C</span>
mysql<span class="token operator">&gt;</span> CHANGE MASTER TO <span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token string">&#39;172.16.187.17&#39;</span>,
    -<span class="token operator">&gt;</span> <span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token string">&#39;slave&#39;</span>,
    -<span class="token operator">&gt;</span> <span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token string">&#39;123456&#39;</span>,
    -<span class="token operator">&gt;</span> <span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">&#39;mysql-bin.000001&#39;</span>,MASTER_LOG_POS<span class="token operator">=</span><span class="token number">154</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8\u4ECE\u670D\u52A1\u5668\u590D\u5236\u529F\u80FD</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>start slave<span class="token punctuation">;</span>
<span class="token comment">## \u6267\u884C\u7ED3\u679C</span>
mysql<span class="token operator">&gt;</span> start slave<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u4ECE\u670D\u52A1\u5668\u72B6\u6001</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>show slave status\\G;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E0B\u9762\u4E24\u4E2A\u53C2\u6570\u90FD\u662FYes\uFF0C\u5219\u8BF4\u660E\u4E3B\u4ECE\u914D\u7F6E\u6210\u529F</p><p><img src="`+d+'" alt="image-20211224065652526"></p><p>\u5982\u679C\u51FA\u73B0\u9519\u8BEF\uFF0C\u4F1A\u5728Last_Error\u4E2D\u663E\u793A</p><h5 id="\u6D4B\u8BD5"><a class="header-anchor" href="#\u6D4B\u8BD5" aria-hidden="true">#</a> \u6D4B\u8BD5</h5><p>\u5728master\u4E3B\u673A\u65B0\u5EFA\u5E93\u3001\u65B0\u5EFA\u8868\u3001insert \u8BB0\u5F55</p><p><img src="'+m+'" alt="image-20211224070212837"></p><p>\u4ECE\u673A\u590D\u5236</p><p><img src="'+v+`" alt="image-20211224070336571"></p><h5 id="\u5176\u4ED6\u547D\u4EE4"><a class="header-anchor" href="#\u5176\u4ED6\u547D\u4EE4" aria-hidden="true">#</a> \u5176\u4ED6\u547D\u4EE4</h5><p>\u505C\u6B62\u4ECE\u670D\u52A1\u590D\u5236\u529F\u80FD</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>stop slave
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u4F55\u91CD\u65B0\u914D\u7F6E\u4E3B\u4ECE\uFF1F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>stop slave<span class="token punctuation">;</span> 
reset master<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u4FEE\u6539mycat\u7684\u914D\u7F6E\u6587\u4EF6schema-xml"><a class="header-anchor" href="#\u4FEE\u6539mycat\u7684\u914D\u7F6E\u6587\u4EF6schema-xml" aria-hidden="true">#</a> \u4FEE\u6539mycat\u7684\u914D\u7F6E\u6587\u4EF6schema.xml</h4><p>\u5C06dataNode\u4FEE\u6539\u4E2D\u7684\u6570\u636E\u5E93\u5E93\u4FEE\u6539\u6210\u6211\u4EEC\u521A\u624D\u7684\u6570\u636E\u5E93testdb</p><p><img src="`+k+'" alt="image-20211224074134432"></p><p>\u6D4B\u8BD5mycat\u662F\u5426\u53EF\u4EE5\u6210\u529F\u8FDE\u63A5\u5230MySQL\u4E2D\u7684\u6570\u636E\u5E93</p><p><img src="'+b+`" alt="image-20211224074334715"></p><h6 id="\u9A8C\u8BC1\u662F\u5426\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB"><a class="header-anchor" href="#\u9A8C\u8BC1\u662F\u5426\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB" aria-hidden="true">#</a> \u9A8C\u8BC1\u662F\u5426\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB</h6><p>\u4E4B\u524D\u7684\u914D\u7F6E\u5DF2\u5206\u914D\u4E86\u8BFB\u5199\u4E3B\u673A\uFF0C\u662F\u5426\u5DF2\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB\uFF1F</p><p>\u5728\u5199\u4E3B\u673A\u63D2\u5165\u4E00\u6761\u6570\u636E</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>insert into mytbl values (1,@@hostname); ## \u83B7\u53D6\u5F53\u524D\u7684\u4E3B\u673A\u540D\uFF0C\u5E76\u63D2\u5165\u6570\u636E\u5E93\uFF0C\u5982\u679C\u5B9E\u73B0\u4E86\u8BFB\u5199\u5206\u79BB\uFF0C\u90A3\u4E48\u6211\u6211\u4EEC\u5728\u67E5\u8BE2\u7684\u65F6\u5019\uFF0C\u5E94\u8BE5\u4F7F\u7528\u7684\u662F\u8BFB\u4E3B\u673A\uFF0C\u4E5F\u5C31\u662F\u8BFB\u4E3B\u673A\u7684\u4E3B\u673A\u540D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728mycat\u67E5\u8BE2</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>select * from mytbl;
## \u8FD4\u56DE\u7ED3\u679C
mysql&gt; select * from mytbl;
+------+--------------+
| id   | name         |
+------+--------------+
|    1 | zhangsan     |
|    1 | 046e0e02a4c7 |
+------+--------------+
2 rows in set (0.00 sec)
## \u548C\u5199\u4E3B\u673A\u7684docker id\u4E00\u81F4\uFF0C\u6CA1\u6709\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB
[root@localhost mycat]## docker ps
CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                                                  NAMES
5976fad06d9b   mysql:5.7   &quot;docker-entrypoint.s\u2026&quot;   58 minutes ago   Up 58 minutes   33060/tcp, 0.0.0.0:3307-&gt;3306/tcp, :::3307-&gt;3306/tcp   dn_read
046e0e02a4c7   mysql:5.7   &quot;docker-entrypoint.s\u2026&quot;   58 minutes ago   Up 58 minutes   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   dn_write
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="\u4FEE\u6539\u8BFB\u5199\u5206\u79BB\u914D\u7F6E"><a class="header-anchor" href="#\u4FEE\u6539\u8BFB\u5199\u5206\u79BB\u914D\u7F6E" aria-hidden="true">#</a> \u4FEE\u6539\u8BFB\u5199\u5206\u79BB\u914D\u7F6E</h6><p>\u4FEE\u6539<code>&lt;dataHost&gt;</code>\u7684balance\u5C5E\u6027\uFF0C\u901A\u8FC7\u6B64\u5C5E\u6027\u914D\u7F6E\u8BFB\u5199\u5206\u79BB\u7684\u7C7B\u578B</p><p>\u8D1F\u8F7D\u5747\u8861\u7C7B\u578B\uFF0C\u76EE\u524D\u7684\u53D6\u503C\u67094 \u79CD\uFF1A(<strong>\u80FD\u5199\u7684\u4E3B\u673A\u53EA\u6709\u4E00\u53F0\uFF0C\u4F46\u662F\u80FD\u8BFB\u7684\u4E3B\u673A\u6709\u4E24\u53F0\u5440</strong>)</p><ul><li><p><code>balance=&quot;0&quot;</code>\uFF0C\u4E0D\u5F00\u542F\u8BFB\u5199\u5206\u79BB\u673A\u5236\uFF0C\u6240\u6709\u8BFB\u64CD\u4F5C\u90FD\u53D1\u9001\u5230\u5F53\u524D\u53EF\u7528\u7684 writeHost \u4E0A</p></li><li><p><code>balance=&quot;1&quot;</code>\uFF0C\u5168\u90E8\u7684 readHost \u4E0E stand by writeHost \u53C2\u4E0E select \u8BED\u53E5\u7684\u8D1F\u8F7D\u5747\u8861\uFF0C\u7B80\u5355\u7684\u8BF4\uFF0C\u5F53\u53CC\u4E3B\u53CC\u4ECE\u6A21\u5F0F(M1-&gt;S1\uFF0CM2-&gt;S2\uFF0C\u5E76\u4E14 M1 \u4E0E M2 \u4E92\u4E3A\u4E3B\u5907)\uFF0C\u6B63\u5E38\u60C5\u51B5\u4E0B\uFF0CM2,S1,S2 \u90FD\u53C2\u4E0E select \u8BED\u53E5\u7684\u8D1F\u8F7D\u5747\u8861</p></li><li><p><code>balance=&quot;2&quot;</code>\uFF0C\u6240\u6709\u8BFB\u64CD\u4F5C\u90FD\u968F\u673A\u7684\u5728 writeHost\u3001readhost \u4E0A\u5206\u53D1</p></li><li><p><code>balance=&quot;3&quot;</code>\uFF0C\u6240\u6709\u8BFB\u8BF7\u6C42\u968F\u673A\u7684\u5206\u53D1\u5230 readhost \u6267\u884C\uFF0CwriterHost \u4E0D\u8D1F\u62C5\u8BFB\u538B\u529B</p></li></ul><p>\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u5F53\u524D\u7684balance\u503C\u4E3A0\uFF0C\u8868\u793A\u4E0D\u5F00\u542F\u8BFB\u5199\u5206\u79BB\u673A\u5236</p><p><img src="`+g+'" alt="image-20211224075815566"></p><p><strong><code>\u6B63\u5E38\u4E0D\u662F1\u5C31\u662F3</code></strong>\uFF0C\u4E3A\u4E86\u80FD\u770B\u5230\u8BFB\u5199\u5206\u79BB\u7684\u6548\u679C\uFF0C\u628Abalance\u8BBE\u7F6E\u62102\uFF0C\u4F1A\u5728\u4E24\u4E2A\u4E3B\u673A\u95F4\u968F\u673A\u5207\u6362\u67E5\u8BE2</p><p><img src="'+h+`" alt="image-20211224075921059"></p><p>\u542F\u52A8mycat\uFF0C\u91CD\u65B0\u8FDE\u63A5\uFF0C\u9A8C\u8BC1\u8BFB\u5199\u5206\u79BB</p><p>\u5728\u5199\u4E3B\u673A\u6570\u636E\u5E93\u8868mytbl\u4E2D\u63D2\u5165\u5E26\u7CFB\u7EDF\u53D8\u91CF\u6570\u636E\uFF0C\u9020\u6210\u4E3B\u4ECE\u6570\u636E\u4E0D\u4E00\u81F4</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO mytbl VALUES(2,@@hostname);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728Mycat\u91CC\u67E5\u8BE2mytbl\u8868,\u53EF\u4EE5\u770B\u5230\u67E5\u8BE2\u8BED\u53E5\u5728\u4E3B\u4ECE\u4E24\u4E2A\u4E3B\u673A\u95F4\u5207\u6362</p><p><img src="`+q+'" alt="image-20211224080959841"></p><h3 id="\u53CC\u4E3B\u53CC\u4ECE"><a class="header-anchor" href="#\u53CC\u4E3B\u53CC\u4ECE" aria-hidden="true">#</a> \u53CC\u4E3B\u53CC\u4ECE</h3><p>\u4E00\u4E2A\u4E3B\u673Am1\u7528\u4E8E\u5904\u7406\u6240\u6709\u5199\u8BF7\u6C42\uFF0C\u5B83\u7684\u4ECE\u673As1\u548C\u53E6\u4E00\u53F0\u4E3B\u673Am2\u8FD8\u6709\u5B83\u7684\u4ECE\u673As2\u8D1F\u8D23\u6240\u6709\u7684\u8BFB\u8BF7\u6C42\u3002\u5F53m1\u4E3B\u673A\u5B95\u673A\u4E4B\u540E\uFF0Cm2\u8D1F\u8D23\u5199\u8BF7\u6C42\uFF0Cm1\u3001m2\u4E92\u4E3A\u5907\u673A\uFF0C\u5982\u679C\u5B95\u673A\u540E\uFF0C\u518D\u91CD\u542F\uFF0C\u6B64\u65F6\u5C31\u4F5C\u4E3A\u5907\u673A\u3002\u67B6\u6784\u5982\u4E0B\uFF1A</p><p><img src="'+y+`" alt="image-20211224090044004"></p><h4 id="mysql\u73AF\u5883\u642D\u5EFA"><a class="header-anchor" href="#mysql\u73AF\u5883\u642D\u5EFA" aria-hidden="true">#</a> MySQL\u73AF\u5883\u642D\u5EFA</h4><p>\u4E3A\u4E86\u80FD\u521B\u5EFA\u51FA\u53CC\u4E3B\u53CC\u4ECE\uFF0C\u6211\u4EEC\u521B\u5EFA4\u4E2Adocker\u5BB9\u5668\u6765\u5B89\u88C5MySQL\uFF0C\u8FD8\u662F\u4F7F\u7528docker-compose\u6765\u5B89\u88C5</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.3&quot;</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">mycat_cluster_network</span><span class="token punctuation">:</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql_master_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> master_1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_cluster_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./master_1/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ./master_1/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span>
  <span class="token key atrule">mysql_master_2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> master_2
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3307:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_cluster_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./master_2/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ./master_2/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span>
  <span class="token key atrule">mysql_slave_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> slave_1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3308:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_cluster_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./slave_1/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ./slave_1/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span>
  <span class="token key atrule">mysql_slave_2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> slave_2
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3309:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mycat_cluster_network
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./slave_2/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ./slave_2/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;MYSQL_ROOT_PASSWORD=123456&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u5E94\u7684\u5BB9\u5668\u548C\u7AEF\u53E3\u4E3A\uFF1A</p><ul><li>master_1 3306</li><li>master_2 3307</li><li>slave_1 3308</li><li>slave_2 3309</li></ul><p><img src="`+_+`" alt="image-20211224091127912"></p><p>\u521B\u5EFA\u5BB9\u5668</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> up
<span class="token comment">## \u7ED3\u679C</span>
<span class="token punctuation">[</span>root@localhost mycat_cluster<span class="token punctuation">]</span><span class="token comment">## docker-compose up</span>
Creating network <span class="token string">&quot;mycat_cluster_mycat_cluster_network&quot;</span> with the default driver
Creating slave_2  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating master_2 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating slave_1  <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Creating master_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Attaching to master_1, slave_2, master_2, slave_1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6267\u884C\u5B8C\u4E4B\u540E\uFF0C\u4F1A\u5E2E\u6211\u4EEC\u521B\u5EFA\u6302\u8F7D\u7684\u76EE\u5F55\uFF0C\u5C06\u57FA\u7840\u914D\u7F6E\u6587\u4EF6my.cnf\u6DFB\u52A0\u5230\u6307\u5B9A\u7684conf\u76EE\u5F55\u4E0B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span>mysql
character-set-server<span class="token operator">=</span>utf8
<span class="token assign-left variable">default_authentication_plugin</span><span class="token operator">=</span>mysql_native_password

<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8

<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+f+`" alt="image-20211224091636336"></p><h4 id="\u642D\u5EFA\u53CC\u4E3B\u53CC\u4ECE"><a class="header-anchor" href="#\u642D\u5EFA\u53CC\u4E3B\u53CC\u4ECE" aria-hidden="true">#</a> \u642D\u5EFA\u53CC\u4E3B\u53CC\u4ECE</h4><h5 id="\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6conf-my-cnf"><a class="header-anchor" href="#\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6conf-my-cnf" aria-hidden="true">#</a> \u4FEE\u6539\u914D\u7F6E\u6587\u4EF6<code>conf/my.cnf</code></h5><ol><li>msater_1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u4E3B\u670D\u52A1\u5668\u552F\u4E00ID</span>
server-id<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">## \u542F\u7528\u4E8C\u8FDB\u5236\u65E5\u5FD7</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">## \u8BBE\u7F6E\u4E0D\u8981\u590D\u5236\u7684\u6570\u636E\u5E93(\u53EF\u8BBE\u7F6E\u591A\u4E2A)</span>
binlog-ignore-db<span class="token operator">=</span>mysql
binlog-ignore-db<span class="token operator">=</span>information_schema
<span class="token comment">## \u8BBE\u7F6E\u9700\u8981\u590D\u5236\u7684\u6570\u636E\u5E93</span>
binlog-do-db<span class="token operator">=</span>testdb
<span class="token comment">## \u8BBE\u7F6Elogbin\u683C\u5F0F</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>STATEMENT
<span class="token comment">## \u5728\u4F5C\u4E3A\u4ECE\u6570\u636E\u5E93\u7684\u65F6\u5019\uFF0C\u6709\u5199\u5165\u64CD\u4F5C\u4E5F\u8981\u66F4\u65B0\u4E8C\u8FDB\u5236\u65E5\u5FD7\u6587\u4EF6</span>
log-slave-updates 
<span class="token comment">## \u8868\u793A\u81EA\u589E\u957F\u5B57\u6BB5\u4ECE\u54EA\u4E2A\u6570\u5F00\u59CB\uFF0C\u6307\u81EA\u589E\u5B57\u6BB5\u7684\u8D77\u59CB\u503C\uFF0C\u5176\u9ED8\u8BA4\u503C\u662F1\uFF0C\u53D6\u503C\u8303\u56F4\u662F1 .. 65535</span>
auto-increment-increment<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment">## \u8868\u793A\u81EA\u589E\u957F\u5B57\u6BB5\u6BCF\u6B21\u9012\u589E\u7684\u91CF\uFF0C\u6307\u5B57\u6BB5\u4E00\u6B21\u9012\u589E\u591A\u5C11\uFF0C\u4ED6\u7684\u53D6\u503C\u8303\u56F4\u662F1 .. 65535</span>
auto-increment-offset<span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>master_2</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u4E3B\u670D\u52A1\u5668\u552F\u4E00ID</span>
server-id<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment">## \u542F\u7528\u4E8C\u8FDB\u5236\u65E5\u5FD7</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">## \u8BBE\u7F6E\u4E0D\u8981\u590D\u5236\u7684\u6570\u636E\u5E93(\u53EF\u8BBE\u7F6E\u591A\u4E2A)</span>
binlog-ignore-db<span class="token operator">=</span>mysql
binlog-ignore-db<span class="token operator">=</span>information_schema
<span class="token comment">#\u8BBE\u7F6E\u9700\u8981\u590D\u5236\u7684\u6570\u636E\u5E93</span>
binlog-do-db<span class="token operator">=</span>testdb
<span class="token comment">#\u8BBE\u7F6Elogbin\u683C\u5F0F</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>STATEMENT
<span class="token comment">## \u5728\u4F5C\u4E3A\u4ECE\u6570\u636E\u5E93\u7684\u65F6\u5019\uFF0C\u6709\u5199\u5165\u64CD\u4F5C\u4E5F\u8981\u66F4\u65B0\u4E8C\u8FDB\u5236\u65E5\u5FD7\u6587\u4EF6</span>
log-slave-updates 
<span class="token comment">## \u8868\u793A\u81EA\u589E\u957F\u5B57\u6BB5\u4ECE\u54EA\u4E2A\u6570\u5F00\u59CB\uFF0C\u6307\u81EA\u589E\u5B57\u6BB5\u7684\u8D77\u59CB\u503C\uFF0C\u5176\u9ED8\u8BA4\u503C\u662F1\uFF0C\u53D6\u503C\u8303\u56F4\u662F1 .. 65535</span>
auto-increment-increment<span class="token operator">=</span><span class="token number">2</span> 
<span class="token comment">## \u8868\u793A\u81EA\u589E\u957F\u5B57\u6BB5\u6BCF\u6B21\u9012\u589E\u7684\u91CF\uFF0C\u6307\u5B57\u6BB5\u4E00\u6B21\u9012\u589E\u591A\u5C11\uFF0C\u4ED6\u7684\u53D6\u503C\u8303\u56F4\u662F1 .. 65535</span>
auto-increment-offset<span class="token operator">=</span><span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>slave_1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u4ECE\u670D\u52A1\u5668\u552F\u4E00ID</span>
server-id<span class="token operator">=</span><span class="token number">3</span>
<span class="token comment">## \u542F\u7528\u4E2D\u7EE7\u65E5\u5FD7</span>
relay-log<span class="token operator">=</span>mysql-relay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>slave_2</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u4ECE\u670D\u52A1\u5668\u552F\u4E00ID</span>
server-id<span class="token operator">=</span><span class="token number">4</span>
<span class="token comment">## \u542F\u7528\u4E2D\u7EE7\u65E5\u5FD7</span>
relay-log<span class="token operator">=</span>mysql-relay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u91CD\u542F\u670D\u52A1\u5E76\u914D\u7F6E"><a class="header-anchor" href="#\u91CD\u542F\u670D\u52A1\u5E76\u914D\u7F6E" aria-hidden="true">#</a> \u91CD\u542F\u670D\u52A1\u5E76\u914D\u7F6E</h5><ol><li>\u53CC\u4E3B\u673A\u3001\u53CC\u4ECE\u673A\u91CD\u542F mysql \u670D\u52A1\uFF0C\u5728\u4E24\u53F0\u4E3B\u673A\u4E0A\u5EFA\u7ACB\u5E10\u6237\u5E76\u6388\u6743 slave</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u5728\u4E3B\u673AMySQL\u91CC\u6267\u884C\u6388\u6743\u547D\u4EE4
GRANT REPLICATION SLAVE ON *.* TO &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
#\u67E5\u8BE2Master_1\u7684\u72B6\u6001
show master status;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+E+`" alt="image-20211226151649058"></p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u5728\u4E3B\u673AMySQL\u91CC\u6267\u884C\u6388\u6743\u547D\u4EE4
GRANT REPLICATION SLAVE ON *.* TO &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
#\u67E5\u8BE2Master_2\u7684\u72B6\u6001
show master status;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+T+`" alt="image-20211226151722687"></p><p>\u5206\u522B\u8BB0\u5F55\u4E0BFile\u548CPosition\u7684\u503C\uFF0C\u6267\u884C\u5B8C\u6B64\u6B65\u9AA4\u540E\u4E0D\u8981\u518D\u64CD\u4F5C\u4E3B\u670D\u52A1\u5668MYSQL\uFF0C\u9632\u6B62\u4E3B\u670D\u52A1\u5668\u72B6\u6001\u503C\u53D8\u5316</p><ol start="2"><li>\u5728\u4ECE\u673A\u4E0A\u914D\u7F6E\u9700\u8981\u590D\u5236\u7684\u4E3B\u673A</li></ol><p>slava_1 \u590D\u5236 Master1\uFF0Cslava_2 \u590D\u5236 master_2</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u590D\u5236\u4E3B\u673A\u7684\u547D\u4EE4
CHANGE MASTER TO MASTER_HOST=&#39;172.16.187.1&#39;,
MASTER_USER=&#39;slave&#39;,
MASTER_PASSWORD=&#39;123456&#39;,
MASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,MASTER_LOG_POS=435;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8\u4E24\u53F0\u4ECE\u670D\u52A1\u5668\u590D\u5236\u529F\u80FD</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>start slave;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u67E5\u770B\u4ECE\u670D\u52A1\u5668\u72B6\u6001</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>show slave status\\G;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="\u4E24\u4E2A\u4E3B\u673A\u4E92\u76F8\u590D\u5236"><a class="header-anchor" href="#\u4E24\u4E2A\u4E3B\u673A\u4E92\u76F8\u590D\u5236" aria-hidden="true">#</a> \u4E24\u4E2A\u4E3B\u673A\u4E92\u76F8\u590D\u5236</h5><p>Master2 \u590D\u5236 Master1\uFF0CMaster1 \u590D\u5236 Master2\uFF0C\u4F7F\u7528\u7684\u547D\u4EE4\u8FD8\u662F\u4ECE\u673A\u590D\u5236\u4E3B\u673A\u7684\u547D\u4EE4</p><p>slava_1 \u590D\u5236 Master1\uFF0Cslava_2 \u590D\u5236 master_2</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u590D\u5236\u4E3B\u673A\u7684\u547D\u4EE4
CHANGE MASTER TO MASTER_HOST=&#39;172.16.187.1&#39;,
MASTER_USER=&#39;slave&#39;,
MASTER_PASSWORD=&#39;123456&#39;,
MASTER_LOG_FILE=&#39;mysql-bin.000002&#39;,MASTER_LOG_POS=435;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8\u4E24\u53F0\u4E3B\u670D\u52A1\u5668\u590D\u5236\u529F\u80FD</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>start slave;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u67E5\u770B\u4ECE\u670D\u52A1\u5668\u72B6\u6001</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>show slave status\\G;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="\u6D4B\u8BD5-1"><a class="header-anchor" href="#\u6D4B\u8BD5-1" aria-hidden="true">#</a> \u6D4B\u8BD5</h4><h5 id="\u4E3B\u4ECE\u590D\u5236"><a class="header-anchor" href="#\u4E3B\u4ECE\u590D\u5236" aria-hidden="true">#</a> \u4E3B\u4ECE\u590D\u5236</h5><p>\u5206\u522B\u5BF9master_1\u3001slave_1 \u548Cmaster_2\u3001slave_2\u6D4B\u8BD5</p><p>Master1 \u4E3B\u673A\u65B0\u5EFA\u5E93\u3001\u65B0\u5EFA\u8868\u3001insert \u8BB0\u5F55\uFF0CMaster2 \u548C\u4ECE\u673A\u590D\u5236</p><h5 id="\u9A8C\u8BC1mycat"><a class="header-anchor" href="#\u9A8C\u8BC1mycat" aria-hidden="true">#</a> \u9A8C\u8BC1mycat</h5><p>\u4FEE\u6539schema.xml\uFF0C\u4E3A\u4E86\u53CC\u4E3B\u53CC\u4ECE\u8BFB\u5199\u5206\u79BBbalance\u8BBE\u7F6E\u4E3A1\uFF0C\u5E76\u6DFB\u52A0\u4E3B\u673A</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testdb<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>172.16.187.17:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- can have multi read hosts --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>172.16.187.17:3308<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>172.16.187.17:3307<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- can have multi read hosts --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>172.16.187.17:3309<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8mycat\uFF0C\u9A8C\u8BC1\u8BFB\u5199\u5206\u79BB</p><p>\u5728\u5199\u4E3B\u673AMaster1\u6570\u636E\u5E93\u8868mytbl\u4E2D\u63D2\u5165\u5E26\u7CFB\u7EDF\u53D8\u91CF\u6570\u636E\uFF0C\u9020\u6210\u4E3B\u4ECE\u6570\u636E\u4E0D\u4E00\u81F4</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO mytbl VALUES(3,@@hostname);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="\u6297\u98CE\u9669\u80FD\u529B"><a class="header-anchor" href="#\u6297\u98CE\u9669\u80FD\u529B" aria-hidden="true">#</a> \u6297\u98CE\u9669\u80FD\u529B</h5><p>\u505C\u6B62\u6570\u636E\u5E93Master1\uFF0C\u5728Mycat\u91CC\u63D2\u5165\u6570\u636E\u4F9D\u7136\u6210\u529F\uFF0CMaster2\u81EA\u52A8\u5207\u6362\u4E3A\u5199\u4E3B\u673A</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO mytbl VALUES(3,@@hostname);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u542F\u52A8\u6570\u636E\u5E93Master1\uFF0CMaster1\u3001Master2 \u4E92\u505A\u5907\u673A\uFF0C\u8D1F\u8D23\u5199\u7684\u4E3B\u673A\u5B95\u673A\uFF0C\u5907\u673A\u5207\u6362\u8D1F\u8D23\u5199\u64CD\u4F5C\uFF0C\u4FDD\u8BC1\u6570\u636E\u5E93\u8BFB\u5199\u5206\u79BB\u9AD8\u53EF\u7528\u6027\u3002</p><h4 id="\u5176\u4ED6\u547D\u4EE4-1"><a class="header-anchor" href="#\u5176\u4ED6\u547D\u4EE4-1" aria-hidden="true">#</a> \u5176\u4ED6\u547D\u4EE4</h4><p>\u5982\u4F55\u505C\u6B62\u4ECE\u670D\u52A1\u590D\u5236\u529F\u80FD</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>stop slave;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u4F55\u91CD\u65B0\u914D\u7F6E\u4E3B\u4ECE</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>stop slave; 
reset master;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5782\u76F4\u62C6\u5206-\u5206\u5E93"><a class="header-anchor" href="#\u5782\u76F4\u62C6\u5206-\u5206\u5E93" aria-hidden="true">#</a> \u5782\u76F4\u62C6\u5206-\u5206\u5E93</h2><p>\u4E00\u4E2A\u6570\u636E\u5E93\u7531\u5F88\u591A\u7684\u8868\u6784\u6210\uFF0C\u6BCF\u4E2A\u8868\u5BF9\u5E94\u7740\u4E0D\u540C\u7684\u4E1A\u52A1\uFF0C\u5782\u76F4\u5207\u5206\u662F\u6307\u6309\u7167\u4E1A\u52A1\u5C06\u8868\u8FDB\u884C\u5206\u7C7B\uFF0C\u5206\u5E03\u5230\u4E0D\u540C\u7684\u6570\u636E\u5E93\u4E0A\u9762\uFF0C\u8FD9\u6837\u4E5F\u5C31\u5C06\u6570\u636E\u6216\u8005\u538B\u529B\u5206\u62C5\u5230\u4E0D\u540C\u7684\u5E93\u4E0A\u9762\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><p><img src="`+x+`" alt="image-20211226153109553"></p><p>\u7CFB\u7EDF\u88AB\u5207\u5206\u6210\u7528\u6237\u3001\u8BA2\u5355\u4EA4\u6613\u3001\u652F\u4ED8\u51E0\u4E2A\u6A21\u5757</p><h3 id="\u5982\u4F55\u5212\u5206\u8868"><a class="header-anchor" href="#\u5982\u4F55\u5212\u5206\u8868" aria-hidden="true">#</a> \u5982\u4F55\u5212\u5206\u8868</h3><p>\u4E00\u4E2A\u95EE\u9898\uFF1A\u5728\u4E24\u53F0\u4E3B\u673A\u4E0A\u7684\u4E24\u4E2A\u6570\u636E\u5E93\u4E2D\u7684\u8868\uFF0C\u80FD\u5426\u5173\u8054\u67E5\u8BE2\uFF1F\u4E0D\u53EF\u4EE5</p><p>\u5206\u5E93\u7684\u539F\u5219\uFF1A\u6709\u7D27\u5BC6\u5173\u8054\u5173\u7CFB\u7684\u8868\u5E94\u8BE5\u5728\u4E00\u4E2A\u5E93\u4E2D\uFF0C\u4E92\u76F8\u6CA1\u6709\u5173\u8054\u5173\u7CFB\u7684\u8868\u53EF\u4EE5\u5206\u5230\u4E0D\u540C\u7684\u5E93\u91CC</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u5BA2\u6237\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:20\u4E07
CREATE TABLE customer(
  id INT AUTO_INCREMENT,
  NAME VARCHAR(200),
  PRIMARY KEY(id)
);
## \u8BA2\u5355\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:600\u4E07
CREATE TABLE orders(
  id INT AUTO_INCREMENT,
  order_type INT,
  customer_id INT,
  amount DECIMAL(10,2),
  PRIMARY KEY(id)
); 
## \u8BA2\u5355\u8BE6\u7EC6\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:600\u4E07
CREATE TABLE orders_detail(
  id INT AUTO_INCREMENT,
  detail VARCHAR(2000),
  order_id INT,
  PRIMARY KEY(id)
);
## \u8BA2\u5355\u72B6\u6001\u5B57\u5178\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:20
CREATE TABLE dict_order_type(
  id INT AUTO_INCREMENT,
  order_type VARCHAR(200),
  PRIMARY KEY(id)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u56DB\u4E2A\u8868\u5982\u4F55\u5206\u5E93\uFF1F\u5BA2\u6237\u8868\u5206\u5728\u4E00\u4E2A\u6570\u636E\u5E93\uFF0C\u53E6\u5916\u4E09\u4E2A\u90FD\u9700\u8981\u5173\u8054\u67E5\u8BE2\uFF0C\u5206\u5728\u53E6\u5916\u4E00\u4E2A\u5E93\u4E2D</p><h3 id="\u5B9E\u73B0\u5206\u5E93"><a class="header-anchor" href="#\u5B9E\u73B0\u5206\u5E93" aria-hidden="true">#</a> \u5B9E\u73B0\u5206\u5E93</h3><ol><li>\u4FEE\u6539schema.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- dataNode=&quot;dn1&quot;\u6307\u5B9A\u9ED8\u8BA4\u7684\u8868\u5B58\u50A8\u4F4D\u7F6E\u662Fdn1\u8282\u70B9\uFF0C\u7136\u540Ecustomer\u8FD9\u4E2A\u8868\u7279\u6B8A\u6307\u5B9A\u5B58\u50A8\u5728dn2\u8FD9\u4E2A\u8282\u70B9\u4E0A --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u8BBE\u5B9A\u4E24\u4E2A\u8868\u7684\u6570\u636E\u5E93\u540D\u79F0\u90FD\u662Forders\uFF0C\u8FD9\u91CC\u7684orders\u53EA\u662F\u5E93\u540D\uFF0C\u5E76\u4E0D\u4EE3\u6307\u8BA2\u5355\u8868 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- \u914D\u7F6E\u6570\u636E\u4E3B\u673A --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>172.16.187.17:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>172.16.187.17:3307<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u65B0\u589E\u4E24\u4E2A\u7A7A\u767D\u5E93</li></ol><p>\u5206\u5E93\u64CD\u4F5C\u4E0D\u662F\u5728\u539F\u6765\u7684\u8001\u6570\u636E\u5E93\u4E0A\u8FDB\u884C\u64CD\u4F5C\uFF0C\u9700\u8981\u51C6\u5907\u4E24\u53F0\u673A\u5668\u5206\u522B\u5B89\u88C5\u65B0\u7684\u6570\u636E\u5E93</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u5728\u6570\u636E\u8282\u70B9 dn1\u3001dn2 \u4E0A\u5206\u522B\u521B\u5EFA\u6570\u636E\u5E93 orders
CREATE DATABASE orders;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u542F\u52A8mycat</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./mycat console
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>\u8BBF\u95EEmycat\u8FDB\u884C\u5206\u5E93</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u8BBF\u95EE Mycat
mysql -umycat -p123456 -h 172.16.187.19 -P 8066
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5207\u6362\u5230 TESTDB</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>use TESTDB;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u521B\u5EFA 4 \u5F20\u8868</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>## \u5BA2\u6237\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:20\u4E07
CREATE TABLE customer(
  id INT AUTO_INCREMENT,
  NAME VARCHAR(200),
  PRIMARY KEY(id)
);
## \u8BA2\u5355\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:600\u4E07
CREATE TABLE orders(
  id INT AUTO_INCREMENT,
  order_type INT,
  customer_id INT,
  amount DECIMAL(10,2),
  PRIMARY KEY(id)
); 
## \u8BA2\u5355\u8BE6\u7EC6\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:600\u4E07
CREATE TABLE orders_detail(
  id INT AUTO_INCREMENT,
  detail VARCHAR(2000),
  order_id INT,
  PRIMARY KEY(id)
);
## \u8BA2\u5355\u72B6\u6001\u5B57\u5178\u8868 \u5047\u8BBE\u5DF2\u7ECF\u6709rows:20
CREATE TABLE dict_order_type(
  id INT AUTO_INCREMENT,
  order_type VARCHAR(200),
  PRIMARY KEY(id)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u8868\u4FE1\u606F\uFF0C\u53EF\u4EE5\u770B\u5230\u6210\u529F\u5206\u5E93</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code>\u6211\u4EEC\u5728mycat\u4E0A\u67E5\u8BE2<span class="token code-snippet code keyword">\`show tables\`</span>\uFF0C\u5F97\u51FA\u56DB\u5F20\u8868\uFF0C\u4F46\u662F\u5728dn1\u4E0A\u67E5\u8BE2\u53EA\u6709<span class="token code-snippet code keyword">\`dict_order_type\`</span>\u3001<span class="token code-snippet code keyword">\`orders_detail\`</span>\u3001<span class="token code-snippet code keyword">\`orders\`</span>\uFF0C\u800C<span class="token code-snippet code keyword">\`customer\`</span>\u5728dn2\u4E0A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E5F\u5C31\u662F\u8BF4\uFF1A\u5728mycat\u4E0A\u6267\u884C\u8BED\u53E5\uFF0C\u5F53\u5982\u679C\u662F\u62E6\u622A\u5230\u7684\u8868\u662F<code>dict_order_type</code>\u3001<code>orders_detail</code>\u3001<code>orders</code>\u7684\u65F6\u5019\u4F1A\u8F6C\u53D1\u7ED9dn1\uFF0C\u5982\u679C\u662F<code>customer</code>\u4F1A\u8F6C\u53D1\u7ED9dn2</p><h2 id="\u6C34\u5E73\u62C6\u5206-\u5206\u8868"><a class="header-anchor" href="#\u6C34\u5E73\u62C6\u5206-\u5206\u8868" aria-hidden="true">#</a> \u6C34\u5E73\u62C6\u5206-\u5206\u8868</h2><p>\u76F8\u5BF9\u4E8E\u5782\u76F4\u62C6\u5206\uFF0C\u6C34\u5E73\u62C6\u5206\u4E0D\u662F\u5C06\u8868\u505A\u5206\u7C7B\uFF0C\u800C\u662F\u6309\u7167\u67D0\u4E2A\u5B57\u6BB5\u7684\u67D0\u79CD\u89C4\u5219\u6765\u5206\u6563\u5230\u591A\u4E2A\u5E93\u4E4B\u4E2D\uFF0C\u6BCF\u4E2A\u8868\u4E2D \u5305\u542B\u4E00\u90E8\u5206\u6570\u636E\u3002\u7B80\u5355\u6765\u8BF4\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5C06\u6570\u636E\u7684\u6C34\u5E73\u5207\u5206\u7406\u89E3\u4E3A\u662F\u6309\u7167\u6570\u636E\u884C\u7684\u5207\u5206\uFF0C\u5C31\u662F\u5C06\u8868\u4E2D\u7684\u67D0\u4E9B\u884C\u5207\u5206\u5230\u4E00\u4E2A\u6570\u636E\u5E93\uFF0C\u800C\u53E6\u5916\u7684\u67D0\u4E9B\u884C\u53C8\u5207\u5206\u5230\u5176\u4ED6\u7684\u6570\u636E\u5E93\u4E2D\uFF0C\u5982\u56FE\uFF1A</p><p><img src="`+A+`" alt="image-20211226173035283"></p><h3 id="\u5B9E\u73B0\u5206\u8868"><a class="header-anchor" href="#\u5B9E\u73B0\u5206\u8868" aria-hidden="true">#</a> \u5B9E\u73B0\u5206\u8868</h3><ol><li>\u9009\u62E9\u8981\u62C6\u5206\u7684\u8868</li></ol><p>MySQL\u5355\u8868\u5B58\u50A8\u6570\u636E\u5E93\u6761\u6570\u662F\u6709\u74F6\u9888\u7684\uFF0C\u5355\u8868\u8FBE\u52301000\u4E07\u6761\u6570\u636E\u5C31\u8FBE\u5230\u4E86\u74F6\u9888\uFF0C\u4F1A\u5F71\u54CD\u67E5\u8BE2\u7684\u6548\u7387\uFF0C\u9700\u8981\u8FDB\u884C\u6C34\u5E73\u62C6\u5206\uFF08\u5206\u8868\uFF09\u8FDB\u884C\u4F18\u5316</p><p>\u4F8B\u5982\uFF1A\u4F8B\u5B50\u4E2D\u7684orders\u3001order_detail\u90FD\u5DF2\u7ECF\u8FBE\u5230\u4E86600\u4E07\u884C\u6570\u636E\uFF0C\u9700\u8981\u8FDB\u884C\u5206\u8868\u4F18\u5316</p><ol start="2"><li>\u5206\u8868\u5B57\u6BB5</li></ol><p>\u4EE5orders\u8868\u4E3A\u4F8B\uFF0C\u53EF\u4EE5\u6839\u636E\u4E0D\u540C\u7684\u5B57\u6BB5\u8FDB\u884C\u5206\u8868</p><table><thead><tr><th>\u7F16\u53F7</th><th>\u5206\u8868\u5B57\u6BB5</th><th>\u6548\u679C</th></tr></thead><tbody><tr><td>1</td><td>id \uFF08\u4E3B\u952E\u3001\u6216\u521B\u5EFA\u65F6\u95F4\uFF09</td><td>\u67E5\u8BE2\u8BA2\u5355\u6CE8\u91CD\u65F6\u6548\uFF0C\u5386\u53F2\u8BA2\u5355\u88AB\u67E5\u8BE2\u7684\u6B21\u6570\u5C11\uFF0C\u5982\u6B64\u5206\u7247\u4F1A\u9020\u6210\u4E00\u4E2A\u8282\u70B9\u8BBF\u95EE\u591A\uFF0C\u4E00\u4E2A\u8BBF\u95EE\u5C11\uFF0C\u4E0D\u5E73\u5747</td></tr><tr><td>2</td><td>customer_id\uFF08\u5BA2\u6237id\uFF09</td><td>\u6839\u636E\u5BA2\u6237id\u53BB\u5206\uFF0C\u4E24\u4E2A\u8282\u70B9\u8BBF\u95EE\u5E73\u5747\uFF0C\u4E00\u4E2A\u5BA2\u6237\u6240\u6709\u8BA2\u5355\u90FD\u5728\u4E00\u4E2A\u8282\u70B9</td></tr></tbody></table><ol start="3"><li>\u4FEE\u6539schema.xml\u914D\u7F6E\u6587\u4EF6</li></ol><p>\u4E3A orders \u8868\u8BBE\u7F6E\u6570\u636E\u8282\u70B9\u4E3A dn1\u3001dn2\uFF0C\u5E76\u6307\u5B9A\u5206\u7247\u89C4\u5219\u4E3A mod_rule\uFF08\u81EA\u5B9A\u4E49\u7684\u540D\u5B57\uFF09</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+S+`" alt="image-20211226165021623"></p><ol start="4"><li>\u4FEE\u6539rule.xml\u914D\u7F6E\u6587\u4EF6</li></ol><p>\u5728 rule \u914D\u7F6E\u6587\u4EF6\u91CC\u65B0\u589E\u5206\u7247\u89C4\u5219 <code>mod_rule</code>\uFF0C\u5E76\u6307\u5B9A\u89C4\u5219\u9002\u7528\u5B57\u6BB5\u4E3A <code>customer_id</code>\uFF0C\u8FD8\u6709\u9009\u62E9\u5206\u7247\u7B97\u6CD5 <code>mod-long</code>\uFF08\u5BF9\u5B57\u6BB5\u6C42\u6A21\u8FD0\u7B97\uFF09\uFF0C<code>customer_id</code> \u5BF9\u4E24\u4E2A\u8282\u70B9\u6C42\u6A21\uFF0C\u6839\u636E\u7ED3\u679C\u5206\u7247\uFF0C\u914D\u7F6E\u7B97\u6CD5 <code>mod-long</code> \u53C2\u6570 count \u4E3A 2\uFF0C\u4E24\u4E2A\u8282\u70B9</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>customer_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>mod-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
\u2026
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByMod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- how many data nodes --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>\u5728\u6570\u636E\u8282\u70B9<code>dn2</code>\u4E0A\u5EFA<code>orders</code> \u8868\uFF0C\u91CD\u542F <code>Mycat</code>\uFF0C\u8BA9\u914D\u7F6E\u751F\u6548</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE orders(
  id INT AUTO_INCREMENT,
  order_type INT,
  customer_id INT,
  amount DECIMAL(10,2),
  PRIMARY KEY(id)
); 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>\u8BBF\u95EEMycat\u5B9E\u73B0\u5206\u7247</li></ol><p>\u5728 mycat \u91CC\u5411 orders \u8868\u63D2\u5165\u6570\u636E\uFF0CINSERT \u5B57\u6BB5\u4E0D\u80FD\u7701\u7565</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO orders(id,order_type,customer_id,amount) VALUES (1,101,100,100100);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(2,101,100,100300);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(3,101,101,120000);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(4,101,101,103000);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(5,102,101,100400);
INSERT INTO orders(id,order_type,customer_id,amount) VALUES(6,102,100,100020);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728mycat\u3001dn1\u3001dn2\u4E2D\u67E5\u770Borders\u8868\u6570\u636E\uFF0C\u5206\u8868\u6210\u529F</p><p><img src="`+R+'" alt="image-20211226171330663"></p><h3 id="mycat\u7684\u5206\u7247"><a class="header-anchor" href="#mycat\u7684\u5206\u7247" aria-hidden="true">#</a> mycat\u7684\u5206\u7247</h3><p>&quot;join&quot;</p><p>Orders \u8BA2\u5355\u8868\u5DF2\u7ECF\u8FDB\u884C\u5206\u8868\u64CD\u4F5C\u4E86\uFF0C\u548C\u5B83\u5173\u8054\u7684 orders_detail \u8BA2\u5355\u8BE6\u60C5\u8868\u5982\u4F55\u8FDB\u884C join \u67E5\u8BE2\uFF0C\u6211\u4EEC\u8981\u5BF9 orders_detail \u4E5F\u8981\u8FDB\u884C\u5206\u7247\u64CD\u4F5C\u3002Join \u7684\u539F\u7406\u5982\u4E0B\u56FE\uFF1A</p><p><img src="'+w+`" alt="image-20211226173613506"></p><ol><li>ER\u8868</li></ol><p>Mycat \u501F\u9274\u4E86 NewSQL \u9886\u57DF\u7684\u65B0\u79C0 Foundation DB \u7684\u8BBE\u8BA1\u601D\u8DEF\uFF0CFoundation DB \u521B\u65B0\u6027\u7684\u63D0\u51FA\u4E86 Table Group \u7684\u6982\u5FF5\uFF0C\u5176\u5C06\u5B50\u8868\u7684\u5B58\u50A8\u4F4D\u7F6E\u4F9D\u8D56\u4E8E\u4E3B\u8868\uFF0C\u5E76\u4E14\u7269\u7406\u4E0A\u7D27\u90BB\u5B58\u653E\uFF0C\u56E0\u6B64\u5F7B\u5E95\u89E3\u51B3\u4E86JION \u7684\u6548\u7387\u548C\u6027\u80FD\u95EE\u9898\uFF0C\u6839\u636E\u8FD9\u4E00\u601D\u8DEF\uFF0C\u63D0\u51FA\u4E86\u57FA\u4E8E E-R \u5173\u7CFB\u7684\u6570\u636E\u5206\u7247\u7B56\u7565\uFF0C\u5B50\u8868\u7684\u8BB0\u5F55\u4E0E\u6240\u5173\u8054\u7684\u7236\u8868\u8BB0\u5F55\u5B58\u653E\u5728\u540C\u4E00\u4E2A\u6570\u636E\u5206\u7247\u4E0A</p><p>\u4FEE\u6539 schema.xml \u914D\u7F6E\u6587\u4EF6</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 dn2 \u521B\u5EFA orders_detail \u8868</p><p>\u91CD\u542F Mycat</p><p>\u8BBF\u95EE Mycat \u5411 orders_detail \u8868\u63D2\u5165\u6570\u636E</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO orders_detail(id,detail,order_id) values(1,&#39;detail1&#39;,1);
INSERT INTO orders_detail(id,detail,order_id) VALUES(2,&#39;detail1&#39;,2);
INSERT INTO orders_detail(id,detail,order_id) VALUES(3,&#39;detail1&#39;,3);
INSERT INTO orders_detail(id,detail,order_id) VALUES(4,&#39;detail1&#39;,4);
INSERT INTO orders_detail(id,detail,order_id) VALUES(5,&#39;detail1&#39;,5);
INSERT INTO orders_detail(id,detail,order_id) VALUES(6,&#39;detail1&#39;,6);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728mycat\u3001dn1\u3001dn2\u4E2D\u8FD0\u884C\u4E24\u4E2A\u8868join\u8BED\u53E5</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>select o.*,od.detail from orders o inner join orders_detail od on o.id=od.order_id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+M+`" alt="image-20211226174323994"></p><ol start="2"><li>\u5168\u5C40\u8868</li></ol><p>\u5728\u5206\u7247\u7684\u60C5\u51B5\u4E0B\uFF0C\u5F53\u4E1A\u52A1\u8868\u56E0\u4E3A\u89C4\u6A21\u800C\u8FDB\u884C\u5206\u7247\u4EE5\u540E\uFF0C\u4E1A\u52A1\u8868\u4E0E\u8FD9\u4E9B\u9644\u5C5E\u7684\u5B57\u5178\u8868\u4E4B\u95F4\u7684\u5173\u8054\uFF0C\u5C31\u6210\u4E86\u6BD4\u8F83\u68D8\u624B\u7684\u95EE\u9898\uFF0C\u8003\u8651\u5230\u5B57\u5178\u8868\u5177\u6709\u4EE5\u4E0B\u51E0\u4E2A\u7279\u6027\uFF1A</p><ul><li><p>\u53D8\u52A8\u4E0D\u9891\u7E41</p></li><li><p>\u6570\u636E\u91CF\u603B\u4F53\u53D8\u5316\u4E0D\u5927</p></li><li><p>\u6570\u636E\u89C4\u6A21\u4E0D\u5927\uFF0C\u5F88\u5C11\u6709\u8D85\u8FC7\u6570\u5341\u4E07\u6761\u8BB0\u5F55</p></li></ul><p>\u9274\u4E8E\u6B64\uFF0CMycat \u5B9A\u4E49\u4E86\u4E00\u79CD\u7279\u6B8A\u7684\u8868\uFF0C\u79F0\u4E4B\u4E3A\u201C\u5168\u5C40\u8868\u201D\uFF0C\u5168\u5C40\u8868\u5177\u6709\u4EE5\u4E0B\u7279\u6027\uFF1A</p><ul><li><p>\u5168\u5C40\u8868\u7684\u63D2\u5165\u3001\u66F4\u65B0\u64CD\u4F5C\u4F1A\u5B9E\u65F6\u5728\u6240\u6709\u8282\u70B9\u4E0A\u6267\u884C\uFF0C\u4FDD\u6301\u5404\u4E2A\u5206\u7247\u7684\u6570\u636E\u4E00\u81F4\u6027</p></li><li><p>\u5168\u5C40\u8868\u7684\u67E5\u8BE2\u64CD\u4F5C\uFF0C\u53EA\u4ECE\u4E00\u4E2A\u8282\u70B9\u83B7\u53D6</p></li><li><p>\u5168\u5C40\u8868\u53EF\u4EE5\u8DDF\u4EFB\u4F55\u4E00\u4E2A\u8868\u8FDB\u884C JOIN \u64CD\u4F5C</p></li></ul><p>\u5C06\u5B57\u5178\u8868\u6216\u8005\u7B26\u5408\u5B57\u5178\u8868\u7279\u6027\u7684\u4E00\u4E9B\u8868\u5B9A\u4E49\u4E3A\u5168\u5C40\u8868\uFF0C\u5219\u4ECE\u53E6\u5916\u4E00\u4E2A\u65B9\u9762\uFF0C\u5F88\u597D\u7684\u89E3\u51B3\u4E86\u6570\u636EJOIN \u7684\u96BE\u9898\u3002\u901A\u8FC7\u5168\u5C40\u8868+\u57FA\u4E8E E-R \u5173\u7CFB\u7684\u5206\u7247\u7B56\u7565\uFF0CMycat \u53EF\u4EE5\u6EE1\u8DB3 80%\u4EE5\u4E0A\u7684\u4F01\u4E1A\u5E94\u7528\u5F00\u53D1</p><p>\u4FEE\u6539 schema.xml \u914D\u7F6E\u6587\u4EF6</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dict_order_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>global<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 dn2 \u521B\u5EFA dict_order_type \u8868</p><p>\u91CD\u542F Mycat</p><p>\u8BBF\u95EE Mycat \u5411 dict_order_type \u8868\u63D2\u5165\u6570\u636E</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO dict_order_type(id,order_type) VALUES(101,&#39;type1&#39;);
INSERT INTO dict_order_type(id,order_type) VALUES(102,&#39;type2&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728Mycat\u3001dn1\u3001dn2\u4E2D\u67E5\u8BE2\u8868\u6570\u636E</p><p><img src="`+N+`" alt="image-20211226174249938"></p><h3 id="\u5E38\u7528\u7684\u5206\u7247\u89C4\u5219"><a class="header-anchor" href="#\u5E38\u7528\u7684\u5206\u7247\u89C4\u5219" aria-hidden="true">#</a> \u5E38\u7528\u7684\u5206\u7247\u89C4\u5219</h3><h4 id="\u53D6\u6A21"><a class="header-anchor" href="#\u53D6\u6A21" aria-hidden="true">#</a> \u53D6\u6A21</h4><p>\u6B64\u89C4\u5219\u4E3A\u5BF9\u5206\u7247\u5B57\u6BB5\u6C42\u6478\u8FD0\u7B97\u3002\u4E5F\u662F\u6C34\u5E73\u5206\u8868\u6700\u5E38\u7528\u89C4\u5219\u30025.1 \u914D\u7F6E\u5206\u8868\u4E2D\uFF0Corders \u8868\u91C7\u7528\u4E86\u6B64\u89C4\u5219</p><h4 id="\u5206\u7247\u679A\u4E3E"><a class="header-anchor" href="#\u5206\u7247\u679A\u4E3E" aria-hidden="true">#</a> \u5206\u7247\u679A\u4E3E</h4><p>\u901A\u8FC7\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u914D\u7F6E\u53EF\u80FD\u7684\u679A\u4E3E id\uFF0C\u81EA\u5DF1\u914D\u7F6E\u5206\u7247\uFF0C\u672C\u89C4\u5219\u9002\u7528\u4E8E\u7279\u5B9A\u7684\u573A\u666F\uFF0C\u6BD4\u5982\u6709\u4E9B\u4E1A\u52A1\u9700\u8981\u6309\u7167\u7701\u4EFD\u6216\u533A\u53BF\u6765\u505A\u4FDD\u5B58\uFF0C\u800C\u5168\u56FD\u7701\u4EFD\u533A\u53BF\u56FA\u5B9A\u7684\uFF0C\u8FD9\u7C7B\u4E1A\u52A1\u4F7F\u7528\u672C\u6761\u89C4\u5219</p><ol><li>\u4FEE\u6539schema.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_ware_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_intfile<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u4FEE\u6539rule.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_intfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>areacode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>hash-int<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hash-int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByFileMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>partition-hash-int.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>rule</p><ul><li>columns\uFF1A\u5206\u7247\u5B57\u6BB5</li><li>algorithm\uFF1A\u5206\u7247\u51FD\u6570</li></ul><p>function</p><ul><li>mapFile\uFF1A\u6807\u8BC6\u914D\u7F6E\u6587\u4EF6\u540D\u79F0</li><li>type\uFF1A0\u4E3Aint\u578B\u3001\u975E0\u4E3AString</li><li>defaultNode\uFF1A\u9ED8\u8BA4\u8282\u70B9:\u5C0F\u4E8E 0 \u8868\u793A\u4E0D\u8BBE\u7F6E\u9ED8\u8BA4\u8282\u70B9\uFF0C\u5927\u4E8E\u7B49\u4E8E 0 \u8868\u793A\u8BBE\u7F6E\u9ED8\u8BA4\u8282\u70B9\uFF0C\u8BBE\u7F6E\u9ED8\u8BA4\u8282\u70B9\u5982\u679C\u78B0\u5230\u4E0D\u8BC6\u522B\u7684\u679A\u4E3E\u503C\uFF0C\u5C31\u8BA9\u5B83\u8DEF\u7531\u5230\u9ED8\u8BA4\u8282\u70B9\uFF0C\u5982\u4E0D\u8BBE\u7F6E\u4E0D\u8BC6\u522B\u5C31\u62A5\u9519</li></ul><ol start="3"><li>\u4FEE\u6539partition-hash-int.txt\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>110=0
120=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>\u91CD\u542F Mycat</li><li>\u8BBF\u95EEMycat\u521B\u5EFA\u8868</li></ol><p>\u8BA2\u5355\u5F52\u5C5E\u533A\u57DF\u4FE1\u606F\u8868</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE orders_ware_info
(
  \`id\` INT AUTO_INCREMENT comment &#39;\u7F16\u53F7&#39;,
  \`order_id\` INT comment &#39;\u8BA2\u5355\u7F16\u53F7&#39;,
  \`address\` VARCHAR(200) comment &#39;\u5730\u5740&#39;,
  \`areacode\` VARCHAR(20) comment &#39;\u533A\u57DF\u7F16\u53F7&#39;,
  PRIMARY KEY(id)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>\u63D2\u5165\u6570\u636E</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO orders_ware_info(id, order_id,address,areacode) VALUES (1,1,&#39;\u5317\u4EAC&#39;,&#39;110&#39;);
INSERT INTO orders_ware_info(id, order_id,address,areacode) VALUES (2,2,&#39;\u5929\u6D25&#39;,&#39;120&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>\u67E5\u8BE2Mycat\u3001dn1\u3001dn2\u53EF\u4EE5\u770B\u5230\u6570\u636E\u5206\u7247\u6548\u679C</li></ol><p><img src="`+I+`" alt="image-20211226175907515"></p><h4 id="\u8303\u56F4\u7EA6\u5B9A"><a class="header-anchor" href="#\u8303\u56F4\u7EA6\u5B9A" aria-hidden="true">#</a> \u8303\u56F4\u7EA6\u5B9A</h4><p>\u6B64\u5206\u7247\u9002\u7528\u4E8E\uFF0C\u63D0\u524D\u89C4\u5212\u597D\u5206\u7247\u5B57\u6BB5\u67D0\u4E2A\u8303\u56F4\u5C5E\u4E8E\u54EA\u4E2A\u5206\u7247</p><ol><li>\u4FEE\u6539schema.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>payment_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto_sharding_long<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u4FEE\u6539rule.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto_sharding_long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>order_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>rang-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
\u2026
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rang-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.AutoPartitionByLong<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>autopartition-long.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u4FEE\u6539autopartition-long.txt\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>0-102=0
103-200=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>\u91CD\u542F Mycat</li><li>\u8BBF\u95EEMycat\u521B\u5EFA\u8868</li></ol><p>\u652F\u4ED8\u4FE1\u606F\u8868</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE payment_info
(
  \`id\` INT AUTO_INCREMENT comment &#39;\u7F16\u53F7&#39;,
  \`order_id\` INT comment &#39;\u8BA2\u5355\u7F16\u53F7&#39;,
  \`payment_status\` INT comment &#39;\u652F\u4ED8\u72B6\u6001&#39;,
  PRIMARY KEY(id)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>\u63D2\u5165\u6570\u636E</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO payment_info (id,order_id,payment_status) VALUES (1,101,0);
INSERT INTO payment_info (id,order_id,payment_status) VALUES (2,102,1);
INSERT INTO payment_info (id,order_id ,payment_status) VALUES (3,103,0);
INSERT INTO payment_info (id,order_id,payment_status) VALUES (4,104,1);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>\u67E5\u8BE2Mycat\u3001dn1\u3001dn2\u53EF\u4EE5\u770B\u5230\u6570\u636E\u5206\u7247\u6548\u679C</li></ol><p><img src="`+O+`" alt="image-20211226180425127"></p><h4 id="\u6309\u65E5\u671F-\u5929-\u5206\u7247"><a class="header-anchor" href="#\u6309\u65E5\u671F-\u5929-\u5206\u7247" aria-hidden="true">#</a> \u6309\u65E5\u671F\uFF08\u5929\uFF09\u5206\u7247</h4><p>\u6B64\u89C4\u5219\u4E3A\u6309\u5929\u5206\u7247\u3002\u8BBE\u5B9A\u65F6\u95F4\u683C\u5F0F\u3001\u8303\u56F4</p><ol><li>\u4FEE\u6539schema.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>login_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_date<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u4FEE\u6539rule.xml\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>login_date<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>shardingByDate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
\u2026
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shardingByDate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dateFormat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>yyyy-MM-dd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sBeginDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2019-01-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sEndDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2019-01-04<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sPartionDay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>dateFormat \uFF1A\u65E5\u671F\u683C\u5F0F</li><li>sBeginDate \uFF1A\u5F00\u59CB\u65E5\u671F</li><li>sEndDate\uFF1A\u7ED3\u675F\u65E5\u671F,\u5219\u4EE3\u8868\u6570\u636E\u8FBE\u5230\u4E86\u8FD9\u4E2A\u65E5\u671F\u7684\u5206\u7247\u540E\u5FAA\u73AF\u4ECE\u5F00\u59CB\u5206\u7247\u63D2\u5165</li><li>sPartionDay \uFF1A\u5206\u533A\u5929\u6570\uFF0C\u5373\u9ED8\u8BA4\u4ECE\u5F00\u59CB\u65E5\u671F\u7B97\u8D77\uFF0C\u5206\u9694 2 \u5929\u4E00\u4E2A\u5206\u533A</li></ul><ol start="3"><li>\u91CD\u542F Mycat</li><li>\u8BBF\u95EEMycat\u521B\u5EFA\u8868</li></ol><p>\u7528\u6237\u4FE1\u606F\u8868</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE login_info
(
  \`id\` INT AUTO_INCREMENT comment &#39;\u7F16\u53F7&#39;,
  \`user_id\` INT comment &#39;\u7528\u6237\u7F16\u53F7&#39;,
  \`login_date\` date comment &#39;\u767B\u5F55\u65E5\u671F&#39;,
  PRIMARY KEY(id)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>\u63D2\u5165\u6570\u636E</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO login_info(id,user_id,login_date) VALUES (1,101,&#39;2019-01-01&#39;);
INSERT INTO login_info(id,user_id,login_date) VALUES (2,102,&#39;2019-01-02&#39;);
INSERT INTO login_info(id,user_id,login_date) VALUES (3,103,&#39;2019-01-03&#39;);
INSERT INTO login_info(id,user_id,login_date) VALUES (4,104,&#39;2019-01-04&#39;);
INSERT INTO login_info(id,user_id,login_date) VALUES (5,103,&#39;2019-01-05&#39;);
INSERT INTO login_info(id,user_id,login_date) VALUES (6,104,&#39;2019-01-06&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>\u67E5\u8BE2Mycat\u3001dn1\u3001dn2\u53EF\u4EE5\u770B\u5230\u6570\u636E\u5206\u7247\u6548\u679C</li></ol><p><img src="`+L+`" alt="image-20211226180729782"></p><h3 id="\u5168\u5C40\u5E8F\u5217"><a class="header-anchor" href="#\u5168\u5C40\u5E8F\u5217" aria-hidden="true">#</a> \u5168\u5C40\u5E8F\u5217</h3><p>\u5728\u5B9E\u73B0\u5206\u5E93\u5206\u8868\u7684\u60C5\u51B5\u4E0B\uFF0C\u6570\u636E\u5E93\u81EA\u589E\u4E3B\u952E\u5DF2\u65E0\u6CD5\u4FDD\u8BC1\u81EA\u589E\u4E3B\u952E\u7684\u5168\u5C40\u552F\u4E00\u3002\u4E3A\u6B64\uFF0CMycat \u63D0\u4F9B\u4E86\u5168\u5C40 sequence\uFF0C\u5E76\u4E14\u63D0\u4F9B\u4E86\u5305\u542B\u672C\u5730\u914D\u7F6E\u548C\u6570\u636E\u5E93\u914D\u7F6E\u7B49\u591A\u79CD\u5B9E\u73B0\u65B9\u5F0F</p><h4 id="\u672C\u5730\u6587\u4EF6"><a class="header-anchor" href="#\u672C\u5730\u6587\u4EF6" aria-hidden="true">#</a> \u672C\u5730\u6587\u4EF6</h4><p>\u6B64\u65B9\u5F0F Mycat \u5C06 sequence \u914D\u7F6E\u5230\u6587\u4EF6\u4E2D\uFF0C\u5F53\u4F7F\u7528\u5230 sequence \u4E2D\u7684\u914D\u7F6E\u540E\uFF0CMycat \u4F1A\u66F4\u4E0Bclasspath \u4E2D\u7684 sequence_conf.properties \u6587\u4EF6\u4E2D sequence \u5F53\u524D\u7684\u503C</p><ul><li>\u4F18\u70B9\uFF1A\u672C\u5730\u52A0\u8F7D\uFF0C\u8BFB\u53D6\u901F\u5EA6\u8F83\u5FEB</li><li>\u7F3A\u70B9\uFF1A\u6297\u98CE\u9669\u80FD\u529B\u5DEE\uFF0CMycat \u6240\u5728\u4E3B\u673A\u5B95\u673A\u540E\uFF0C\u65E0\u6CD5\u8BFB\u53D6\u672C\u5730\u6587\u4EF6</li></ul><h4 id="\u6570\u636E\u5E93\u65B9\u5F0F"><a class="header-anchor" href="#\u6570\u636E\u5E93\u65B9\u5F0F" aria-hidden="true">#</a> \u6570\u636E\u5E93\u65B9\u5F0F</h4><p>\u5229\u7528\u6570\u636E\u5E93\u4E00\u4E2A\u8868 \u6765\u8FDB\u884C\u8BA1\u6570\u7D2F\u52A0\u3002\u4F46\u662F\u5E76\u4E0D\u662F\u6BCF\u6B21\u751F\u6210\u5E8F\u5217\u90FD\u8BFB\u5199\u6570\u636E\u5E93\uFF0C\u8FD9\u6837\u6548\u7387\u592A\u4F4E\u3002Mycat \u4F1A\u9884\u52A0\u8F7D\u4E00\u90E8\u5206\u53F7\u6BB5\u5230 Mycat \u7684\u5185\u5B58\u4E2D\uFF0C\u8FD9\u6837\u5927\u90E8\u5206\u8BFB\u5199\u5E8F\u5217\u90FD\u662F\u5728\u5185\u5B58\u4E2D\u5B8C\u6210\u7684\u3002\u5982\u679C\u5185\u5B58\u4E2D\u7684\u53F7\u6BB5\u7528\u5B8C\u4E86 Mycat \u4F1A\u518D\u5411\u6570\u636E\u5E93\u8981\u4E00\u6B21</p><p>\u95EE\uFF1A\u90A3\u5982\u679C Mycat \u5D29\u6E83\u4E86 \uFF0C\u90A3\u5185\u5B58\u4E2D\u7684\u5E8F\u5217\u5C82\u4E0D\u662F\u90FD\u6CA1\u4E86\uFF1F</p><p>\u662F\u7684\u3002\u5982\u679C\u662F\u8FD9\u6837\uFF0C\u90A3\u4E48 Mycat \u542F\u52A8\u540E\u4F1A\u5411\u6570\u636E\u5E93\u7533\u8BF7\u65B0\u7684\u53F7\u6BB5\uFF0C\u539F\u6709\u53F7\u6BB5\u4F1A\u5F03\u7528\u3002\u4E5F\u5C31\u662F\u8BF4\u5982\u679C Mycat \u91CD\u542F\uFF0C\u90A3\u4E48\u635F\u5931\u662F\u5F53\u524D\u7684\u53F7\u6BB5\u6CA1\u7528\u5B8C\u7684\u53F7\u7801\uFF0C\u4F46\u662F\u4E0D\u4F1A\u56E0\u6B64\u51FA\u73B0\u4E3B\u952E\u91CD\u590D</p><ol><li>\u5EFA\u5E93\u5E8F\u5217\u811A\u672C</li></ol><p>\u5728 dn1 \u4E0A\u521B\u5EFA\u5168\u5C40\u5E8F\u5217\u8868</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE MYCAT_SEQUENCE (NAME VARCHAR(50) NOT NULL,current_value INT NOT NULL,increment INT NOT NULL DEFAULT 100, PRIMARY KEY(NAME)) ENGINE=INNODB;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u521B\u5EFA\u5168\u5C40\u5E8F\u5217\u6240\u9700\u51FD\u6570</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>DELIMITER $$ 
CREATE FUNCTION mycat_seq_currval(seq_name VARCHAR(50)) RETURNS VARCHAR(64)
DETERMINISTIC 
BEGIN
DECLARE retval VARCHAR(64);
SET retval=&quot;-999999999,null&quot;;
SELECT CONCAT(CAST(current_value AS CHAR),&quot;,&quot;,CAST(increment AS CHAR)) INTO retval FROM
MYCAT_SEQUENCE WHERE NAME = seq_name;
RETURN retval;
END $$
DELIMITER ;
DELIMITER $$
CREATE FUNCTION mycat_seq_setval(seq_name VARCHAR(50),VALUE INTEGER) RETURNS 
VARCHAR(64)
DETERMINISTIC
BEGIN
UPDATE MYCAT_SEQUENCE
SET current_value = VALUE
WHERE NAME = seq_name;
RETURN mycat_seq_currval(seq_name);
END $$
DELIMITER ;
DELIMITER $$
CREATE FUNCTION mycat_seq_nextval(seq_name VARCHAR(50)) RETURNS VARCHAR(64) 
DETERMINISTIC
BEGIN
UPDATE MYCAT_SEQUENCE
SET current_value = current_value + increment WHERE NAME = seq_name;
RETURN mycat_seq_currval(seq_name);
END $$
DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521D\u59CB\u5316\u5E8F\u5217\u8868\u8BB0\u5F55</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>INSERT INTO MYCAT_SEQUENCE(NAME,current_value,increment) VALUES (&#39;ORDERS&#39;, 400000,100);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+C+`" alt="image-20211229152537375"></p><ol start="2"><li>\u4FEE\u6539 Mycat \u914D\u7F6E</li></ol><p>\u4FEE\u6539sequence_db_conf.properties</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> sequence_db_conf.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u610F\u601D\u662F ORDERS\u8FD9\u4E2A\u5E8F\u5217\u5728dn1\u8FD9\u4E2A\u8282\u70B9\u4E0A\uFF0C\u5177\u4F53dn1\u8282\u70B9\u662F\u54EA\u53F0\u673A\u5B50\uFF0C\u8BF7\u53C2\u8003schema.xml</p><p><img src="`+D+`" alt="image-20211229152624349"></p><p>\u4FEE\u6539server.xml</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>vim server.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5168\u5C40\u5E8F\u5217\u7C7B\u578B\uFF1A0-\u672C\u5730\u6587\u4EF6\uFF0C1-\u6570\u636E\u5E93\u65B9\u5F0F\uFF0C2-\u65F6\u95F4\u6233\u65B9\u5F0F\u3002\u6B64\u5904\u5E94\u8BE5\u4FEE\u6539\u62101</p><p><img src="`+P+`" alt="image-20211229152656310"></p><p>\u91CD\u542FMycat</p><ol start="3"><li>\u9A8C\u8BC1\u5168\u5C40\u5E8F\u5217</li></ol><p>\u767B\u5F55 Mycat\uFF0C\u63D2\u5165\u6570\u636E</p><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>insert into orders(id,amount,customer_id,order_type) values(next value for MYCATSEQ_ORDERS,1000,101,102);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u67E5\u8BE2\u6570\u636E</p><p><img src="`+H+'" alt="image-20211229152751878"></p><p>\u91CD\u542FMycat\u540E\uFF0C\u518D\u6B21\u63D2\u5165\u6570\u636E\uFF0C\u518D\u67E5\u8BE2</p><p><img src="'+U+'" alt="image-20211229152812151"></p><h4 id="\u65F6\u95F4\u6233\u65B9\u5F0F"><a class="header-anchor" href="#\u65F6\u95F4\u6233\u65B9\u5F0F" aria-hidden="true">#</a> \u65F6\u95F4\u6233\u65B9\u5F0F</h4><p>\u5168\u5C40\u5E8F\u5217ID= 64 \u4F4D\u4E8C\u8FDB\u5236 (42(\u6BEB\u79D2)+5(\u673A\u5668 ID)+5(\u4E1A\u52A1\u7F16\u7801)+12(\u91CD\u590D\u7D2F\u52A0) \u6362\u7B97\u6210\u5341\u8FDB\u5236\u4E3A 18 \u4F4D\u6570\u7684long \u7C7B\u578B\uFF0C\u6BCF\u6BEB\u79D2\u53EF\u4EE5\u5E76\u53D1 12 \u4F4D\u4E8C\u8FDB\u5236\u7684\u7D2F\u52A0</p><ul><li>\u4F18\u70B9\uFF1A\u914D\u7F6E\u7B80\u5355</li><li>\u7F3A\u70B9\uFF1A18 \u4F4D ID \u8FC7\u957F</li></ul><h4 id="\u81EA\u4E3B\u751F\u6210\u5168\u5C40\u5E8F\u5217"><a class="header-anchor" href="#\u81EA\u4E3B\u751F\u6210\u5168\u5C40\u5E8F\u5217" aria-hidden="true">#</a> \u81EA\u4E3B\u751F\u6210\u5168\u5C40\u5E8F\u5217</h4><p>\u53EF\u5728 java \u9879\u76EE\u91CC\u81EA\u5DF1\u751F\u6210\u5168\u5C40\u5E8F\u5217\uFF0C\u5982\u4E0B\uFF1A</p><ul><li>\u6839\u636E\u4E1A\u52A1\u903B\u8F91\u7EC4\u5408</li><li>\u53EF\u4EE5\u5229\u7528 redis \u7684\u5355\u7EBF\u7A0B\u539F\u5B50\u6027 incr \u6765\u751F\u6210\u5E8F\u5217</li></ul><p>\u4F46\uFF0C\u81EA\u4E3B\u751F\u6210\u9700\u8981\u5355\u72EC\u5728\u5DE5\u7A0B\u4E2D\u7528 java \u4EE3\u7801\u5B9E\u73B0\uFF0C\u8FD8\u662F\u63A8\u8350\u4F7F\u7528 Mycat \u81EA\u5E26\u5168\u5C40\u5E8F\u5217</p><h2 id="\u57FA\u4E8Eha\u673A\u5236\u7684mycat\u9AD8\u53EF\u7528"><a class="header-anchor" href="#\u57FA\u4E8Eha\u673A\u5236\u7684mycat\u9AD8\u53EF\u7528" aria-hidden="true">#</a> \u57FA\u4E8EHA\u673A\u5236\u7684mycat\u9AD8\u53EF\u7528</h2><p>\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0CMycat \u670D\u52A1\u4E5F\u9700\u8981\u8003\u8651\u9AD8\u53EF\u7528\u6027\uFF0C\u5982\u679C Mycat \u6240\u5728\u670D\u52A1\u5668\u51FA\u73B0\u5B95\u673A\uFF0C\u6216 Mycat \u670D\u52A1\u6545\u969C\uFF0C\u9700\u8981\u6709\u5907\u673A\u63D0\u4F9B\u670D\u52A1\uFF0C\u9700\u8981\u8003\u8651 Mycat \u96C6\u7FA4</p><h3 id="\u9AD8\u53EF\u7528\u65B9\u6848"><a class="header-anchor" href="#\u9AD8\u53EF\u7528\u65B9\u6848" aria-hidden="true">#</a> \u9AD8\u53EF\u7528\u65B9\u6848</h3><p>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 HAProxy + Keepalived \u914D\u5408\u4E24\u53F0 Mycat \u642D\u8D77 Mycat \u96C6\u7FA4\uFF0C\u5B9E\u73B0\u9AD8\u53EF\u7528\u6027\u3002HAProxy \u5B9E\u73B0\u4E86 MyCat \u591A\u8282\u70B9\u7684\u96C6\u7FA4\u9AD8\u53EF\u7528\u548C\u8D1F\u8F7D\u5747\u8861\uFF0C\u800C HAProxy \u81EA\u8EAB\u7684\u9AD8\u53EF\u7528\u5219\u53EF\u4EE5\u901A\u8FC7 Keepalived \u6765\u5B9E\u73B0</p><p><img src="'+B+`" alt="image-20211229154800755"></p><table><thead><tr><th>\u7F16\u53F7</th><th>\u89D2\u8272</th><th>IP</th><th>\u5730\u5740</th></tr></thead><tbody><tr><td>1</td><td>Mycat1</td><td>192.168.140.128</td><td>host79</td></tr><tr><td>2</td><td>Mycat2</td><td>192.168.140.127</td><td>host80</td></tr><tr><td>3</td><td>HAProxy\uFF08master\uFF09</td><td>192.168.140.126</td><td>host81</td></tr><tr><td>4</td><td>Keepalived\uFF08master\uFF09</td><td>192.168.140.126</td><td>host81</td></tr><tr><td>5</td><td>HAProxy\uFF08backup\uFF09</td><td>192.168.140.125</td><td>host82</td></tr><tr><td>6</td><td>Keepalived\uFF08backup\uFF09</td><td>192.168.140.125</td><td>host82</td></tr></tbody></table><h3 id="\u5B89\u88C5\u914D\u7F6Ehaproxy"><a class="header-anchor" href="#\u5B89\u88C5\u914D\u7F6Ehaproxy" aria-hidden="true">#</a> \u5B89\u88C5\u914D\u7F6EHAProxy</h3><h4 id="\u5B89\u88C5haporxy"><a class="header-anchor" href="#\u5B89\u88C5haporxy" aria-hidden="true">#</a> \u5B89\u88C5HAPorxy</h4><ol><li>\u51C6\u5907\u597DHAProxy\u5B89\u88C5\u5305\uFF0C\u4F20\u5230/opt\u76EE\u5F55\u4E0B</li></ol><p>\u4F7F\u7528scp\u547D\u4EE4</p><ol start="2"><li>\u89E3\u538B\u5230/usr/local/src</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf haproxy-1.5.18.tar.gz -C /usr/local/src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u8FDB\u5165\u89E3\u538B\u540E\u7684\u76EE\u5F55\uFF0C\u67E5\u770B\u5185\u6838\u7248\u672C\uFF0C\u8FDB\u884C\u7F16\u8BD1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/src/haproxy-1.5.18
<span class="token function">uname</span> -r
<span class="token function">make</span> <span class="token assign-left variable">TARGET</span><span class="token operator">=</span>linux310 <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/haproxy <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>x86_64
<span class="token comment">## ARGET=linux310\uFF0C\u5185\u6838\u7248\u672C\uFF0C\u4F7F\u7528uname -r\u67E5\u770B\u5185\u6838\uFF0C\u5982\uFF1A3.10.0-514.el7\uFF0C\u6B64\u65F6\u8BE5\u53C2\u6570\u5C31\u4E3Alinux310</span>
<span class="token comment">## ARCH=x86_64\uFF0C\u7CFB\u7EDF\u4F4D\u6570</span>
<span class="token comment">## PREFIX=/usr/local/haprpxy #/usr/local/haprpxy\uFF0C\u4E3Ahaprpxy\u5B89\u88C5\u8DEF\u5F84</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>\u7F16\u8BD1\u5B8C\u6210\u540E\uFF0C\u8FDB\u884C\u5B89\u88C5</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> <span class="token function">install</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/haproxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>\u5B89\u88C5\u5B8C\u6210\u540E\uFF0C\u521B\u5EFA\u76EE\u5F55\u3001\u521B\u5EFAHAProxy\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /usr/data/haproxy/
<span class="token function">vim</span> /usr/local/haproxy/haproxy.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>\u5411\u914D\u7F6E\u6587\u4EF6\u4E2D\u63D2\u5165\u4EE5\u4E0B\u914D\u7F6E\u4FE1\u606F,\u5E76\u4FDD\u5B58</li></ol><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>global
  log 127.0.0.1 local0
  #log 127.0.0.1 local1 notice
  #log loghost local0 info
  maxconn 4096
  chroot /usr/local/haproxy
  pidfile /usr/data/haproxy/haproxy.pid
  uid 99
  gid 99
  daemon
  #debug
  #quiet
defaults
	log global
	mode tcp
  option abortonclose
  option redispatch
  retries 3
  maxconn 2000
  timeout connect 5000
  timeout client 50000
  timeout server 50000
listen proxy_status 
	bind :48066
    mode tcp
    balance roundrobin
    server mycat_1 192.168.140.128:8066 check inter 10s
    server mycat_2 192.168.140.127:8066 check inter 10s
    frontend admin_stats 
    bind :7777
    mode http
    stats enable
    option httplog
    maxconn 10
    stats refresh 30s
    stats uri /admin
    stats auth admin:123123
    stats hide-version
    stats admin if TRUE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u542F\u52A8\u9A8C\u8BC1"><a class="header-anchor" href="#\u542F\u52A8\u9A8C\u8BC1" aria-hidden="true">#</a> \u542F\u52A8\u9A8C\u8BC1</h4><ol><li>\u542F\u52A8HAProxy</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>/usr/local/haproxy/sbin/haproxy -f /usr/local/haproxy/haproxy.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u67E5\u770BHAProxy\u8FDB\u7A0B</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> haproxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u6253\u5F00\u6D4F\u89C8\u5668\u8BBF\u95EE</li></ol><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.140.125:7777/admin</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5728\u5F39\u51FA\u6846\u8F93\u5165\u7528\u6237\u540D\uFF1Aadmin\u5BC6\u7801\uFF1A123123</p><p>\u5982\u679CMycat\u4E3B\u5907\u673A\u5747\u5DF2\u542F\u52A8\uFF0C\u5219\u53EF\u4EE5\u770B\u5230\u5982\u4E0B\u56FE</p><p><img src="`+V+`" alt="image-20211229160330906"></p><ol start="4"><li>\u9A8C\u8BC1\u8D1F\u8F7D\u5747\u8861\uFF0C\u901A\u8FC7HAProxy\u8BBF\u95EEMycat</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.126 -P <span class="token number">48066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u914D\u7F6Ekeepalived"><a class="header-anchor" href="#\u914D\u7F6Ekeepalived" aria-hidden="true">#</a> \u914D\u7F6EKeepalived</h3><h4 id="\u5B89\u88C5keepalive"><a class="header-anchor" href="#\u5B89\u88C5keepalive" aria-hidden="true">#</a> \u5B89\u88C5Keepalive</h4><ol><li><p>\u51C6\u5907\u597DKeepalived\u5B89\u88C5\u5305\uFF0C\u4F20\u5230/opt\u76EE\u5F55\u4E0B</p></li><li><p>\u89E3\u538B\u5230/usr/local/src</p></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf keepalived-1.4.2.tar.gz -C /usr/local/src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u5B89\u88C5\u4F9D\u8D56\u63D2\u4EF6</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> -y gcc openssl-devel popt-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>\u8FDB\u5165\u89E3\u538B\u540E\u7684\u76EE\u5F55\uFF0C\u8FDB\u884C\u914D\u7F6E\uFF0C\u8FDB\u884C\u7F16\u8BD1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/src/keepalived-1.4.2
./configure --prefix<span class="token operator">=</span>/usr/local/keepalived
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>\u8FDB\u884C\u7F16\u8BD1\uFF0C\u5B8C\u6210\u540E\u8FDB\u884C\u5B89\u88C5</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="6"><li>\u8FD0\u884C\u524D\u914D\u7F6E</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> /usr/local/src/keepalived-1.4.2/keepalived/etc/init.d/keepalived /etc/init.d/
<span class="token function">mkdir</span> /etc/keepalived
<span class="token function">cp</span> /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/
<span class="token function">cp</span> /usr/local/src/keepalived-1.4.2/keepalived/etc/sysconfig/keepalived /etc/sysconfig/
<span class="token function">cp</span> /usr/local/keepalived/sbin/keepalived /usr/sbin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/keepalived/keepalived.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4FEE\u6539\u5982\u4E0B\u914D\u7F6E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u4FEE\u6539\u5185\u5BB9\u5982\u4E0B</span>
<span class="token operator">!</span> Configuration File <span class="token keyword">for</span> keepalived
global_defs <span class="token punctuation">{</span>
  notification_email <span class="token punctuation">{</span>
  	xlcocoon@foxmail.com
  <span class="token punctuation">}</span>
  notification_email_from keepalived@showjoy.com
  smtp_server <span class="token number">127.0</span>.0.1
  smtp_connect_timeout <span class="token number">30</span>
  router_id LVS_DEVEL
  vrrp_skip_check_adv_addr
  vrrp_garp_interval <span class="token number">0</span>
  vrrp_gna_interval <span class="token number">0</span>
<span class="token punctuation">}</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
  <span class="token comment">#\u4E3B\u673A\u914DMASTER\uFF0C\u5907\u673A\u914DBACKUP</span>
  state MASTER
  <span class="token comment">#\u6240\u5728\u673A\u5668\u7F51\u5361</span>
  interface ens33
  virtual_router_id <span class="token number">51</span>
  <span class="token comment">#\u6570\u503C\u8D8A\u5927\u4F18\u5148\u7EA7\u8D8A\u9AD8</span>
  priority <span class="token number">100</span>
  advert_int <span class="token number">1</span>
  authentication <span class="token punctuation">{</span>
    auth_type PASS
    auth_pass <span class="token number">1111</span>
  <span class="token punctuation">}</span>
  virtual_ipaddress <span class="token punctuation">{</span>
    <span class="token comment">#\u865A\u62DFIP</span>
    <span class="token number">192.168</span>.140.200
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
virtual_server <span class="token number">192.168</span>.140.200 <span class="token number">48066</span> <span class="token punctuation">{</span>
  delay_loop <span class="token number">6</span>
  lb_algo rr
  lb_kind NAT
  persistence_timeout <span class="token number">50</span>
  protocol TCP
  real_server <span class="token number">192.168</span>.140.125 <span class="token number">48066</span> <span class="token punctuation">{</span>
    weight <span class="token number">1</span>
    TCP_CHECK <span class="token punctuation">{</span>
      connect_timeout <span class="token number">3</span>
      retry <span class="token number">3</span>
      delay_before_retry <span class="token number">3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  real_server <span class="token number">192.168</span>.140.126 <span class="token number">48600</span> <span class="token punctuation">{</span>
    weight <span class="token number">1</span>
    TCP_CHECK <span class="token punctuation">{</span>
      connect_timeout <span class="token number">3</span>
      nb_get_retry <span class="token number">3</span>
      delay_before_retry <span class="token number">3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u542F\u52A8\u9A8C\u8BC1-1"><a class="header-anchor" href="#\u542F\u52A8\u9A8C\u8BC1-1" aria-hidden="true">#</a> \u542F\u52A8\u9A8C\u8BC1</h4><ol><li>\u542F\u52A8Keepalived</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">service</span> keepalived start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u767B\u5F55\u9A8C\u8BC1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.200 -P <span class="token number">48066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u6D4B\u8BD5\u9AD8\u53EF\u7528"><a class="header-anchor" href="#\u6D4B\u8BD5\u9AD8\u53EF\u7528" aria-hidden="true">#</a> \u6D4B\u8BD5\u9AD8\u53EF\u7528</h3><ol><li>\u5173\u95EDmycat</li></ol><p>\u5173\u95ED\u5176\u4E2D\u4E00\u4E2Amycat\uFF0C\u6D4B\u8BD5\u80FD\u5426\u5728\u5B95\u673A\u7684\u60C5\u51B5\u4E0B\u5B9E\u73B0\u9AD8\u53EF\u7528</p><ol start="2"><li>\u901A\u8FC7\u865A\u62DFIP\u67E5\u8BE2\u6570\u636E</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.200 -P <span class="token number">48066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="mycat\u5B89\u5168\u8BBE\u7F6E"><a class="header-anchor" href="#mycat\u5B89\u5168\u8BBE\u7F6E" aria-hidden="true">#</a> mycat\u5B89\u5168\u8BBE\u7F6E</h2><h3 id="\u6743\u9650\u914D\u7F6E"><a class="header-anchor" href="#\u6743\u9650\u914D\u7F6E" aria-hidden="true">#</a> \u6743\u9650\u914D\u7F6E</h3><h4 id="user\u6807\u7B7E\u6743\u9650\u63A7\u5236"><a class="header-anchor" href="#user\u6807\u7B7E\u6743\u9650\u63A7\u5236" aria-hidden="true">#</a> user\u6807\u7B7E\u6743\u9650\u63A7\u5236</h4><p>\u76EE\u524D Mycat \u5BF9\u4E8E\u4E2D\u95F4\u4EF6\u7684\u8FDE\u63A5\u63A7\u5236\u5E76\u6CA1\u6709\u505A\u592A\u590D\u6742\u7684\u63A7\u5236\uFF0C\u76EE\u524D\u53EA\u505A\u4E86\u4E2D\u95F4\u4EF6\u903B\u8F91\u5E93\u7EA7\u522B\u7684\u8BFB\u5199\u6743\u9650\u63A7\u5236\u3002\u662F\u901A\u8FC7 server.xml \u7684 user \u6807\u7B7E\u8FDB\u884C\u914D\u7F6E</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>#server.xml\u914D\u7F6E\u6587\u4EF6user\u90E8\u5206
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>readOnly<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u914D\u7F6E\u8BF4\u660E"><a class="header-anchor" href="#\u914D\u7F6E\u8BF4\u660E" aria-hidden="true">#</a> \u914D\u7F6E\u8BF4\u660E</h5><table><thead><tr><th>\u6807\u7B7E\u5C5E\u6027</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>name</td><td>\u5E94\u7528\u8FDE\u63A5\u4E2D\u95F4\u4EF6\u903B\u8F91\u5E93\u7684\u7528\u6237\u540D</td></tr><tr><td>password</td><td>\u8BE5\u7528\u6237\u5BF9\u5E94\u7684\u5BC6\u7801</td></tr><tr><td>TESTDB</td><td>\u5E94\u7528\u5F53\u524D\u8FDE\u63A5\u7684\u903B\u8F91\u5E93\u4E2D\u6240\u5BF9\u5E94\u7684\u903B\u8F91\u8868\u3002schema\u4E2D\u53EF\u4EE5\u8BBE\u7F6E\u4E00\u4E2A\u6216\u591A\u4E2A</td></tr><tr><td>readOnly</td><td>\u5E94\u7528\u8FDE\u63A5\u4E2D\u95F4\u4EF6\u903B\u8F91\u5E93\u6240\u5177\u6709\u7684\u7684\u6743\u9650\u3002true\u4E3A\u53EA\u8BFB\uFF0Cfalse\u4E3A\u8BFB\u5199\u90FD\u6709\uFF0C\u9ED8\u8BA4\u4E3Afalse</td></tr></tbody></table><h5 id="\u6D4B\u8BD5\u6848\u4F8B"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B</h5><h6 id="\u6D4B\u8BD5\u6848\u4F8B\u4E00"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B\u4E00" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B\u4E00</h6><p>\u4F7F\u7528user\u7528\u6237\uFF0C\u6743\u9650\u4E3A\u53EA\u8BFB\uFF08readOnly\uFF1Atrue\uFF09\uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u67E5\u8BE2\u51FA\u6570\u636E\uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u5199\u5165\u6570\u636E</p><ol><li>\u7528user\u7528\u6237\u767B\u5F55\uFF0C\u8FD0\u884C\u547D\u4EE4\u5982\u4E0B\uFF1A</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -uuser -puser -h <span class="token number">192.168</span>.140.128 -P8066
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u5207\u6362\u5230TESTDB\u6570\u636E\u5E93\uFF0C\u67E5\u8BE2orders\u8868\u6570\u636E\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>use TESTDB
select * from orders;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u53EF\u4EE5\u67E5\u8BE2\u5230\u6570\u636E\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ol><p><img src="`+Q+`" alt="image-20211229163035161"></p><ol start="4"><li>\u6267\u884C\u63D2\u5165\u6570\u636Esql\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>insert into orders(id,order_type,customer_id,amount) values(7,101,101,10000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>\u53EF\u770B\u5230\u8FD0\u884C\u7ED3\u679C\uFF0C\u63D2\u5165\u5931\u8D25\uFF0C\u53EA\u6709\u53EA\u8BFB\u6743\u9650\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ol><p><img src="`+Y+`" alt="image-20211229163119622"></p><h6 id="\u6D4B\u8BD5\u6848\u4F8B\u4E8C"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B\u4E8C" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B\u4E8C</h6><p>\u4F7F\u7528mycat\u7528\u6237\uFF0C\u6743\u9650\u4E3A\u53EF\u8BFB\u5199\uFF08readOnly\uFF1Afalse\uFF09 \uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u67E5\u8BE2\u51FA\u6570\u636E\uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u5199\u5165\u6570\u636E</p><ol><li>\u7528mycat\u7528\u6237\u767B\u5F55\uFF0C\u8FD0\u884C\u547D\u4EE4\u5982\u4E0B\uFF1A</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.128 -P8066
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u5207\u6362\u5230TESTDB\u6570\u636E\u5E93\uFF0C\u67E5\u8BE2orders\u8868\u6570\u636E\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>use TESTDB
select * from orders;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u53EF\u4EE5\u67E5\u8BE2\u5230\u6570\u636E\uFF0C\u5982\u4E0B\u56FE</li></ol><p><img src="`+K+`" alt="image-20211229163502529"></p><ol start="4"><li>\u6267\u884C\u63D2\u5165\u6570\u636Esql\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>insert into orders(id,order_type,customer_id,amount) values(7,101,101,10000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>\u53EF\u770B\u5230\u8FD0\u884C\u7ED3\u679C\uFF0C\u63D2\u5165\u6210\u529F\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ol><p><img src="`+G+`" alt="image-20211229163535962"></p><h4 id="privileges\u6807\u7B7E\u6743\u9650\u63A7\u5236"><a class="header-anchor" href="#privileges\u6807\u7B7E\u6743\u9650\u63A7\u5236" aria-hidden="true">#</a> privileges\u6807\u7B7E\u6743\u9650\u63A7\u5236</h4><p>\u5728 user \u6807\u7B7E\u4E0B\u7684 privileges \u6807\u7B7E\u53EF\u4EE5\u5BF9\u903B\u8F91\u5E93\uFF08schema\uFF09\u3001\u8868\uFF08table\uFF09\u8FDB\u884C\u7CBE\u7EC6\u5316\u7684 DML \u6743\u9650\u63A7\u5236</p><p>privileges \u6807\u7B7E\u4E0B\u7684 check \u5C5E\u6027\uFF0C\u5982\u4E3A true \u5F00\u542F\u6743\u9650\u68C0\u67E5\uFF0C\u4E3A false \u4E0D\u5F00\u542F\uFF0C\u9ED8\u8BA4\u4E3A false</p><p>\u7531\u4E8E Mycat \u4E00\u4E2A\u7528\u6237\u7684 schemas \u5C5E\u6027\u53EF\u914D\u7F6E\u591A\u4E2A\u903B\u8F91\u5E93\uFF08schema\uFF09 \uFF0C\u6240\u4EE5 privileges \u7684\u4E0B\u7EA7\u8282\u70B9 schema \u8282\u70B9\u540C\u6837\u53EF\u914D\u7F6E\u591A\u4E2A\uFF0C\u5BF9\u591A\u5E93\u591A\u8868\u8FDB\u884C\u7EC6\u7C92\u5EA6\u7684 DML \u6743\u9650\u63A7\u5236</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>## server.xml\u914D\u7F6E\u6587\u4EF6privileges\u90E8\u5206
## \u914D\u7F6Eorders\u8868\u6CA1\u6709\u589E\u5220\u6539\u67E5\u6743\u9650
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u8868\u7EA7 DML \u6743\u9650\u8BBE\u7F6E --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>privileges</span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dml</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1111<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dml</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!--&lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>privileges</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u914D\u7F6E\u8BF4\u660E-1"><a class="header-anchor" href="#\u914D\u7F6E\u8BF4\u660E-1" aria-hidden="true">#</a> \u914D\u7F6E\u8BF4\u660E</h5><table><thead><tr><th>DML\u6743\u9650</th><th>\u589E\u52A0\uFF08insert\uFF09</th><th>\u66F4\u65B0\uFF08update\uFF09</th><th>\u67E5\u8BE2\uFF08select\uFF09</th><th>\u5220\u9664\uFF08delete\uFF09</th></tr></thead><tbody><tr><td>0000</td><td>\u7981\u6B62</td><td>\u7981\u6B62</td><td>\u7981\u6B62</td><td>\u7981\u6B62</td></tr><tr><td>0010</td><td>\u7981\u6B62</td><td>\u7981\u6B62</td><td>\u53EF\u4EE5</td><td>\u7981\u6B62</td></tr><tr><td>1110</td><td>\u53EF\u4EE5</td><td>\u53EF\u4EE5</td><td>\u53EF\u4EE5</td><td>\u7981\u6B62</td></tr><tr><td>1111</td><td>\u53EF\u4EE5</td><td>\u53EF\u4EE5</td><td>\u53EF\u4EE5</td><td>\u53EF\u4EE5</td></tr></tbody></table><h5 id="\u6D4B\u8BD5\u6848\u4F8B-1"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B-1" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B</h5><h6 id="\u6D4B\u8BD5\u6848\u4F8B\u4E00-1"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B\u4E00-1" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B\u4E00</h6><p>\u4F7F\u7528mycat\u7528\u6237\uFF0Cprivileges\u914D\u7F6Eorders\u8868\u6743\u9650\u4E3A\u7981\u6B62\u589E\u5220\u6539\u67E5\uFF08dml=&quot;0000&quot;\uFF09 \uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u67E5\u8BE2\u51FA\u6570\u636E\uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u5199\u5165\u6570\u636E</p><ol><li>\u91CD\u542Fmycat\uFF0C\u7528mycat\u7528\u6237\u767B\u5F55\uFF0C\u8FD0\u884C\u547D\u4EE4\u5982\u4E0B\uFF1A</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.128 -P8066
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u5207\u6362\u5230TESTDB\u6570\u636E\u5E93\uFF0C\u67E5\u8BE2orders\u8868\u6570\u636E\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>use TESTDB
select * from orders;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u7981\u6B62\u8BE5\u7528\u6237\u67E5\u8BE2\u6570\u636E\uFF0C\u5982\u4E0B\u56FE</li></ol><p><img src="`+j+`" alt="image-20211229164448460"></p><ol start="4"><li>\u6267\u884C\u63D2\u5165\u6570\u636Esql\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>insert into orders(id,order_type,customer_id,amount) values(8,101,101,10000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>\u53EF\u770B\u5230\u8FD0\u884C\u7ED3\u679C\uFF0C\u7981\u6B62\u8BE5\u7528\u6237\u63D2\u5165\u6570\u636E\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ol><p><img src="`+F+`" alt="image-20211229164521978"></p><h6 id="\u6D4B\u8BD5\u6848\u4F8B\u4E8C-1"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B\u4E8C-1" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B\u4E8C</h6><p>\u4F7F\u7528mycat\u7528\u6237\uFF0Cprivileges\u914D\u7F6Eorders\u8868\u6743\u9650\u4E3A\u53EF\u4EE5\u589E\u5220\u6539\u67E5\uFF08dml=&quot;1111&quot;\uFF09 \uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u67E5\u8BE2\u51FA\u6570\u636E\uFF0C\u9A8C\u8BC1\u662F\u5426\u53EF\u4EE5\u5199\u5165\u6570\u636E</p><ol><li>\u91CD\u542Fmycat\uFF0C\u7528mycat\u7528\u6237\u767B\u5F55\uFF0C\u8FD0\u884C\u547D\u4EE4\u5982\u4E0B\uFF1A</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.128 -P8066
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u5207\u6362\u5230TESTDB\u6570\u636E\u5E93\uFF0C\u67E5\u8BE2orders\u8868\u6570\u636E\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>use TESTDB
select * from orders;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u53EF\u4EE5\u67E5\u8BE2\u5230\u6570\u636E\uFF0C\u5982\u4E0B\u56FE</li></ol><p><img src="`+W+`" alt="image-20211229164652475"></p><ol start="4"><li>\u6267\u884C\u63D2\u5165\u6570\u636Esql\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>insert into orders(id,order_type,customer_id,amount) values(8,101,101,10000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>\u53EF\u770B\u5230\u8FD0\u884C\u7ED3\u679C\uFF0C\u63D2\u5165\u6210\u529F\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ol><p><img src="`+z+`" alt="image-20211229164729977"></p><ol start="6"><li>\u6267\u884C\u63D2\u5165\u6570\u636Esql\uFF0C\u5982\u4E0B\uFF1A</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>delete from orders where id in (7,8);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="7"><li>\u53EF\u770B\u5230\u8FD0\u884C\u7ED3\u679C\uFF0C\u63D2\u5165\u6210\u529F\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ol><p><img src="`+$+`" alt="image-20211229164803014"></p><h3 id="sql\u62E6\u622A"><a class="header-anchor" href="#sql\u62E6\u622A" aria-hidden="true">#</a> SQL\u62E6\u622A</h3><p>firewall \u6807\u7B7E\u7528\u6765\u5B9A\u4E49\u9632\u706B\u5899\uFF1Bfirewall \u4E0B whitehost \u6807\u7B7E\u7528\u6765\u5B9A\u4E49 IP \u767D\u540D\u5355 \uFF0Cblacklist \u7528\u6765\u5B9A\u4E49SQL \u9ED1\u540D\u5355</p><h4 id="\u767D\u540D\u5355"><a class="header-anchor" href="#\u767D\u540D\u5355" aria-hidden="true">#</a> \u767D\u540D\u5355</h4><p>\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6E\u767D\u540D\u5355\uFF0C\u5B9E\u73B0\u67D0\u4E3B\u673A\u67D0\u7528\u6237\u53EF\u4EE5\u8BBF\u95EE Mycat\uFF0C\u800C\u5176\u4ED6\u4E3B\u673A\u7528\u6237\u7981\u6B62\u8BBF\u95EE</p><ol><li>\u8BBE\u7F6E\u767D\u540D\u5355</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>## server.xml\u914D\u7F6E\u6587\u4EF6firewall\u6807\u7B7E
## \u914D\u7F6E\u53EA\u6709192.168.140.128\u4E3B\u673A\u53EF\u4EE5\u901A\u8FC7mycat\u7528\u6237\u8BBF\u95EE
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>firewall</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitehost</span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitehost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>firewall</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u91CD\u542FMycat\u540E\uFF0C192.168.140.128\u4E3B\u673A\u4F7F\u7528mycat\u7528\u6237\u8BBF\u95EE</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.128 -P <span class="token number">8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE\uFF0C\u5982\u4E0B\u56FE</li></ol><p><img src="`+J+'" alt="image-20211229165005263"></p><ol start="4"><li>\u5728\u6B64\u4E3B\u673A\u6362user\u7528\u6237\u8BBF\u95EE\uFF0C\u7981\u6B62\u8BBF\u95EE</li></ol><p><img src="'+Z+'" alt="image-20211229165025458"></p><ol start="5"><li>\u5728192.168.140.127\u4E3B\u673A\u7528mycat\u7528\u6237\u8BBF\u95EE\uFF0C\u7981\u6B62\u8BBF\u95EE</li></ol><p><img src="'+X+`" alt="image-20211229165043176"></p><h4 id="\u9ED1\u540D\u5355"><a class="header-anchor" href="#\u9ED1\u540D\u5355" aria-hidden="true">#</a> \u9ED1\u540D\u5355</h4><p>\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6E\u9ED1\u540D\u5355\uFF0C\u5B9E\u73B0 Mycat \u5BF9\u5177\u4F53 SQL \u64CD\u4F5C\u7684\u62E6\u622A\uFF0C\u5982\u589E\u5220\u6539\u67E5\u7B49\u64CD\u4F5C\u7684\u62E6\u622A</p><ol><li>\u8BBE\u7F6E\u9ED1\u540D\u5355</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>#server.xml\u914D\u7F6E\u6587\u4EF6firewall\u6807\u7B7E
#\u914D\u7F6E\u7981\u6B62mycat\u7528\u6237\u8FDB\u884C\u5220\u9664\u64CD\u4F5C
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>firewall</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitehost</span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitehost</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blacklist</span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteAllow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blacklist</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>firewall</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u91CD\u542FMycat\u540E\uFF0C192.168.140.128\u4E3B\u673A\u4F7F\u7528mycat\u7528\u6237\u8BBF\u95EE</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -umycat -p123456 -h <span class="token number">192.168</span>.140.128 -P <span class="token number">8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE\uFF0C\u5982\u4E0B\u56FE</li></ol><p><img src="`+ss+`" alt="image-20211229165320776"></p><ol start="4"><li>\u5207\u6362TESTDB\u6570\u636E\u5E93\u540E\uFF0C\u6267\u884C\u5220\u9664\u6570\u636E\u8BED\u53E5</li></ol><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>delete from orders where id=7;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="5"><li>\u8FD0\u884C\u540E\u53D1\u73B0\u5DF2\u7981\u6B62\u5220\u9664\u6570\u636E\uFF0C\u5982\u4E0B\u56FE</li></ol><p><img src="`+as+'" alt="image-20211229165401450"></p><p>\u53EF\u4EE5\u8BBE\u7F6E\u7684\u9ED1\u540D\u5355 SQL \u62E6\u622A\u529F\u80FD\u5217\u8868</p><table><thead><tr><th>\u914D\u7F6E\u9879</th><th>\u7F3A\u7701\u503C</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>selelctAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C SELECT \u8BED\u53E5</td></tr><tr><td>deleteAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C DELETE \u8BED\u53E5</td></tr><tr><td>updateAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C UPDATE \u8BED\u53E5</td></tr><tr><td>insertAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C INSERT \u8BED\u53E5</td></tr><tr><td>createTableAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u521B\u5EFA\u8868</td></tr><tr><td>setAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u4F7F\u7528 SET \u8BED\u6CD5</td></tr><tr><td>alterTableAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C Alter Table \u8BED\u53E5</td></tr><tr><td>dropTableAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u4FEE\u6539\u8868</td></tr><tr><td>commitAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C commit \u64CD\u4F5C</td></tr><tr><td>rollbackAllow</td><td>true</td><td>\u662F\u5426\u5141\u8BB8\u6267\u884C roll back \u64CD\u4F5C</td></tr></tbody></table><h2 id="mycat\u76D1\u63A7\u5DE5\u5177"><a class="header-anchor" href="#mycat\u76D1\u63A7\u5DE5\u5177" aria-hidden="true">#</a> mycat\u76D1\u63A7\u5DE5\u5177</h2><h3 id="mycat-web\u7B80\u4ECB"><a class="header-anchor" href="#mycat-web\u7B80\u4ECB" aria-hidden="true">#</a> mycat-web\u7B80\u4ECB</h3><p>Mycat-web \u662F Mycat \u53EF\u89C6\u5316\u8FD0\u7EF4\u7684\u7BA1\u7406\u548C\u76D1\u63A7\u5E73\u53F0\uFF0C\u5F25\u8865\u4E86 Mycat \u5728\u76D1\u63A7\u4E0A\u7684\u7A7A\u767D\u3002\u5E2E Mycat \u5206\u62C5\u7EDF\u8BA1\u4EFB\u52A1\u548C\u914D\u7F6E\u7BA1\u7406\u4EFB\u52A1\u3002Mycat-web \u5F15\u5165\u4E86 ZooKeeper \u4F5C\u4E3A\u914D\u7F6E\u4E2D\u5FC3\uFF0C\u53EF\u4EE5\u7BA1\u7406\u591A\u4E2A\u8282\u70B9\u3002Mycat-web \u4E3B\u8981\u7BA1\u7406\u548C\u76D1\u63A7 Mycat \u7684\u6D41\u91CF\u3001\u8FDE\u63A5\u3001\u6D3B\u52A8\u7EBF\u7A0B\u548C\u5185\u5B58\u7B49\uFF0C\u5177\u5907 IP \u767D\u540D\u5355\u3001\u90AE\u4EF6\u544A\u8B66\u7B49\u6A21\u5757\uFF0C\u8FD8\u53EF\u4EE5\u7EDF\u8BA1 SQL \u5E76\u5206\u6790\u6162 SQL \u548C\u9AD8\u9891 SQL \u7B49\u3002\u4E3A\u4F18\u5316 SQL \u63D0\u4F9B\u4F9D\u636E</p><p><img src="'+ns+`" alt="image-20211229170038586"></p><h3 id="mycat-web\u914D\u7F6E\u4F7F\u7528"><a class="header-anchor" href="#mycat-web\u914D\u7F6E\u4F7F\u7528" aria-hidden="true">#</a> mycat-web\u914D\u7F6E\u4F7F\u7528</h3><h4 id="zookeeper\u5B89\u88C5"><a class="header-anchor" href="#zookeeper\u5B89\u88C5" aria-hidden="true">#</a> zookeeper\u5B89\u88C5</h4><p>\u5B89\u88C5\u6B65\u9AA4\u5982\u4E0B\uFF1A</p><ol><li>\u4E0B\u8F7D\u5B89\u88C5\u5305</li></ol><p>\u7F51\u5740\uFF1Ahttp://zookeeper.apache.org/</p><ol start="2"><li>\u5B89\u88C5\u5305\u62F7\u8D1D\u5230Linux\u7CFB\u7EDF/opt\u76EE\u5F55\u4E0B\uFF0C\u5E76\u89E3\u538B</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf zookeeper-3.4.11.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u8FDB\u5165ZooKeeper\u89E3\u538B\u540E\u7684\u914D\u7F6E\u76EE\u5F55\uFF08conf\uFF09\uFF0C\u590D\u5236\u914D\u7F6E\u6587\u4EF6\u5E76\u6539\u540D</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> zoo_sample.cfg zoo.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>\u8FDB\u5165ZooKeeper\u7684\u547D\u4EE4\u76EE\u5F55\uFF08bin\uFF09\uFF0C\u8FD0\u884C\u542F\u52A8\u547D\u4EE4</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./zkServer.sh start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+es+`" alt="image-20211229170246147"></p><ol start="5"><li>ZooKeeper\u670D\u52A1\u7AEF\u53E3\u4E3A2181\uFF0C\u67E5\u770B\u670D\u52A1\u5DF2\u7ECF\u542F\u52A8</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">netstat</span> -ant <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">2181</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ts+`" alt="image-20211229170321426"></p><h4 id="mycat-web\u5B89\u88C5"><a class="header-anchor" href="#mycat-web\u5B89\u88C5" aria-hidden="true">#</a> mycat-web\u5B89\u88C5</h4><p>\u5B89\u88C5\u6B65\u9AA4\u5982\u4E0B\uFF1A</p><ol><li>\u4E0B\u8F7D\u5B89\u88C5\u5305</li></ol><p>\u7F51\u5740\uFF1Ahttp://www.mycat.io/</p><ol start="2"><li>\u5B89\u88C5\u5305\u62F7\u8D1D\u5230Linux\u7CFB\u7EDF/opt\u76EE\u5F55\u4E0B\uFF0C\u5E76\u89E3\u538B</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf Mycat-web-1.0-SNAPSHOT-20170102153329-linux.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u62F7\u8D1Dmycat-web\u6587\u4EF6\u5939\u5230/usr/local\u76EE\u5F55\u4E0B</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> -r mycat-web /usr/local
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>\u8FDB\u5165mycat-web\u7684\u76EE\u5F55\u4E0B\u8FD0\u884C\u542F\u52A8\u547D\u4EE4</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/mycat-web/
./start.sh <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+ls+`" alt="image-20211229170518057"></p><ol start="5"><li>Mycat-web\u670D\u52A1\u7AEF\u53E3\u4E3A8082\uFF0C\u67E5\u770B\u670D\u52A1\u5DF2\u7ECF\u542F\u52A8</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">netstat</span> -ant <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">8082</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+ps+`" alt="image-20211229170544690"></p><ol start="6"><li>\u901A\u8FC7\u5730\u5740\u8BBF\u95EE\u670D\u52A1</li></ol><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//192.168.140.127:8082/mycat/</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+is+'" alt="image-20211229170626599"></p><h4 id="mycat-web\u914D\u7F6E"><a class="header-anchor" href="#mycat-web\u914D\u7F6E" aria-hidden="true">#</a> mycat-web\u914D\u7F6E</h4><p>\u5B89\u88C5\u6B65\u9AA4\u5982\u4E0B\uFF1A</p><ol><li>\u5148\u5728\u6CE8\u518C\u4E2D\u5FC3\u914D\u7F6EZooKeeper\u5730\u5740\uFF0C\u914D\u7F6E\u540E\u5237\u65B0\u9875\u9762\uFF0C\u53EF\u89C1</li></ol><p><img src="'+os+'" alt="image-20211229170657558"></p><ol start="2"><li>\u65B0\u589EMycat\u76D1\u63A7\u5B9E\u4F8B</li></ol><p><img src="'+cs+'" alt="image-20211229170814412"></p><p><img src="'+us+'" alt="image-20211229170829748"></p><h3 id="mycat\u6027\u80FD\u76D1\u63A7\u6307\u6807"><a class="header-anchor" href="#mycat\u6027\u80FD\u76D1\u63A7\u6307\u6807" aria-hidden="true">#</a> mycat\u6027\u80FD\u76D1\u63A7\u6307\u6807</h3><p>\u5728 Mycat-web \u4E0A\u53EF\u4EE5\u8FDB\u884C Mycat \u6027\u80FD\u76D1\u63A7\uFF0C\u4F8B\u5982\uFF1A\u5185\u5B58\u5206\u4EAB\u3001\u6D41\u91CF\u5206\u6790\u3001\u8FDE\u63A5\u5206\u6790\u3001\u6D3B\u52A8\u7EBF\u7A0B\u5206\u6790\u7B49\u7B49</p><p><img src="'+rs+'" alt="image-20211229170905008"></p>',602);function vs(ks,bs){return ms}var hs=s(ds,[["render",vs],["__file","01.mycat\u57FA\u7840.html.vue"]]);export{hs as default};
