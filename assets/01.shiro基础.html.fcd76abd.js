import{_ as n,c as s}from"./app.1b3ac386.js";var a="/naive-dafou-ui-dist/assets/16387068805752.5a14ab7e.jpg",t="/naive-dafou-ui-dist/assets/16387086716826.4c916aa9.jpg",e="/naive-dafou-ui-dist/assets/16387086834674.69d549d4.jpg",p="/naive-dafou-ui-dist/assets/16387095408198.d6108272.jpg",o="/naive-dafou-ui-dist/assets/16387101038814.601de748.jpg",c="/naive-dafou-ui-dist/assets/16387107502181.42fc6066.jpg",i="/naive-dafou-ui-dist/assets/16387192397861.d07c385d.jpg",l="/naive-dafou-ui-dist/assets/16387207172965.da32d314.jpg",u="/naive-dafou-ui-dist/assets/16387207651918.c1f4e2db.jpg",k="/naive-dafou-ui-dist/assets/16387239483298.4ce3f89b.jpg",r="/naive-dafou-ui-dist/assets/16387242970925.451d5d0b.jpg",d="/naive-dafou-ui-dist/assets/16387286754542.0174c8d1.jpg",v="/naive-dafou-ui-dist/assets/16387649792684.fb29f412.jpg",m="/naive-dafou-ui-dist/assets/16387694481799.ffd88960.jpg",b="/naive-dafou-ui-dist/assets/16387697118377.08fb12bc.jpg",g="/naive-dafou-ui-dist/assets/16387749363817.1ea6868c.jpg",h="/naive-dafou-ui-dist/assets/16387796977734.45446217.jpg",y="/naive-dafou-ui-dist/assets/16387797976741.c9cc1210.jpg",w="/naive-dafou-ui-dist/assets/16387807084892.239ab8ec.jpg",f="/naive-dafou-ui-dist/assets/16387809749234.0614002a.jpg",q="/naive-dafou-ui-dist/assets/16387926897062.f28ab734.jpg",S="/naive-dafou-ui-dist/assets/16387930428693.e5f7430e.jpg",A="/naive-dafou-ui-dist/assets/16387934749495.4d6c8b39.jpg",j="/naive-dafou-ui-dist/assets/16387992880896.314d268d.jpg",T="/naive-dafou-ui-dist/assets/16387993089963.db10e0e8.jpg",E="/naive-dafou-ui-dist/assets/16388009495221.09000d3d.jpg",R="/naive-dafou-ui-dist/assets/16388079642824.fb691af4.jpg",x="/naive-dafou-ui-dist/assets/16388080451759.dd214182.jpg",I="/naive-dafou-ui-dist/assets/16388101588103.f5e3c71b.jpg",C="/naive-dafou-ui-dist/assets/16388118609018.9955a2b4.jpg",_="/naive-dafou-ui-dist/assets/16388117890624.ade0b03b.jpg",M="/naive-dafou-ui-dist/assets/16388121760862.55bec599.jpg",U="/naive-dafou-ui-dist/assets/16388126182015.abc16c11.jpg",N="/naive-dafou-ui-dist/assets/16388543606182.97cd7ca5.jpg",L="/naive-dafou-ui-dist/assets/16388543768485.43b6fa11.jpg";const B={},F=s('<h2 id="\u6743\u9650\u7684\u7BA1\u7406"><a class="header-anchor" href="#\u6743\u9650\u7684\u7BA1\u7406" aria-hidden="true">#</a> \u6743\u9650\u7684\u7BA1\u7406</h2><h3 id="\u4EC0\u4E48\u662F\u6743\u9650\u7BA1\u7406"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u6743\u9650\u7BA1\u7406" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u6743\u9650\u7BA1\u7406</h3><p>\u57FA\u672C\u4E0A\u6D89\u53CA\u5230\u7528\u6237\u53C2\u4E0E\u7684\u7CFB\u7EDF\u90FD\u8981\u8FDB\u884C\u6743\u9650\u7BA1\u7406\uFF0C\u6743\u9650\u7BA1\u7406\u5C5E\u4E8E\u7CFB\u7EDF\u5B89\u5168\u7684\u8303\u7574</p><p>\u6309\u7167\u5B89\u5168\u89C4\u5219\u6216\u8005\u5B89\u5168\u7B56\u7565\u63A7\u5236\u7528\u6237\u53EF\u4EE5\u8BBF\u95EE\u800C\u4E14\u53EA\u80FD\u8BBF\u95EE\u81EA\u5DF1\u6388\u6743\u7684\u8D44\u6E90</p><p>\u6743\u9650\u7BA1\u7406\u5305\u542B</p><ul><li>\u8EAB\u4EFD\u8BA4\u8BC1</li><li>\u6388\u6743</li></ul><p>\u5408\u8D77\u6765\u5C31\u662F\u8BA4\u8BC1\u6388\u6743</p><p>\u5BF9\u4E8E\u9700\u8981\u8BBF\u95EE\u63A7\u5236\u7684\u8D44\u6E90\uFF0C\u7528\u6237\u9996\u5148\u7ECF\u8FC7\u8EAB\u4EFD\u8BA4\u8BC1\uFF0C\u8BA4\u8BC1\u901A\u8FC7\u7684\u7528\u6237\u5177\u6709\u8BE5\u8D44\u6E90\u7684\u8BBF\u95EE\u6743\u9650\u65B9\u53EF\u8BBF\u95EE</p><h3 id="\u4EC0\u4E48\u662F\u662F\u8EAB\u4EFD\u8BA4\u8BC1"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u662F\u8EAB\u4EFD\u8BA4\u8BC1" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u662F\u8EAB\u4EFD\u8BA4\u8BC1</h3><p>\u8EAB\u4EFD\u8BA4\u8BC1\uFF0C\u5C31\u662F\u5224\u65AD\u4E00\u4E2A\u7528\u6237\u662F\u5426\u4E3A\u5408\u6CD5\u7684\u7528\u6237\u7684\u5904\u7406\u8FC7\u7A0B\uFF0C\u6700\u5E38\u7528\u7684\u7B80\u5355\u8EAB\u4EFD\u8BA4\u8BC1\u65B9\u5F0F\u5C31\u662F\u7CFB\u7EDF\u901A\u8FC7\u6838\u5BF9\u7528\u6237\u8F93\u5165\u7684\u7528\u6237\u540D\u548C\u53E3\u4EE4\uFF0C\u770B\u5176\u662F\u5426\u4E0E\u7CFB\u7EDF\u4E2D\u5B58\u50A8\u7684\u8BE5\u7528\u6237\u7684\u7528\u6237\u540D\u548C\u53E3\u4EE4\u662F\u5426\u4E00\u81F4\uFF0C\u6765\u5224\u65AD\u7528\u6237\u7684\u8EAB\u4EFD\u662F\u5426\u6B63\u786E\uFF0C\u5BF9\u4E8E\u91C7\u7528\u6307\u7EB9\u7684\u7684\u7CFB\u7EDF\u5219\u9700\u8981\u6307\u7EB9\uFF1B\u5BF9\u4E8E\u786C\u4EF6key\u7B49\u5237\u5361\u7CFB\u7EDF\u5219\u9700\u8981\u5237\u5361</p><h3 id="\u4EC0\u4E48\u662F\u6388\u6743"><a class="header-anchor" href="#\u4EC0\u4E48\u662F\u6388\u6743" aria-hidden="true">#</a> \u4EC0\u4E48\u662F\u6388\u6743</h3><p>\u6388\u6743\uFF0C\u5373\u8BBF\u95EE\u63A7\u5236\uFF0C\u63A7\u5236\u8C01\u80FD\u8BBF\u95EE\u5230\u90A3\u4E9B\u8D44\u6E90\uFF0C\u4E3B\u9898\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1\u540E\u9700\u8981\u5206\u914D\u6743\u9650\u65B9\u53EF\u8BBF\u95EE\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u5BF9\u4E8E\u67D0\u4E9B\u8D44\u6E90\u6CA1\u6709\u6743\u9650\u662F\u65E0\u6CD5\u8BBF\u95EE\u7684</p><h2 id="\u4EC0\u4E48\u662Fshiro"><a class="header-anchor" href="#\u4EC0\u4E48\u662Fshiro" aria-hidden="true">#</a> \u4EC0\u4E48\u662Fshiro</h2><p>\u5B98\u7F51\uFF1Ahttps://shiro.apache.org/</p><blockquote><p>Apache Shiro\u2122 is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management. With Shiro\u2019s easy-to-understand API, you can quickly and easily secure any application \u2013 from the smallest mobile applications to the largest web and enterprise applications. Apache Shiro \u662F\u4E00\u4E2A\u529F\u80FD\u5F3A\u5927\u4E14\u6613\u4E8E\u4F7F\u7528\u7684 Java \u5B89\u5168\u6846\u67B6\uFF0C\u53EF\u6267\u884C<strong>\u8EAB\u4EFD\u9A8C\u8BC1\u3001\u6388\u6743\u3001\u52A0\u5BC6</strong>\u548C\u4F1A\u8BDD\u7BA1\u7406\u3002\u501F\u52A9 Shiro \u6613\u4E8E\u7406\u89E3\u7684 API\uFF0C\u60A8\u53EF\u4EE5\u5FEB\u901F\u8F7B\u677E\u5730\u4FDD\u62A4\u4EFB\u4F55\u5E94\u7528\u7A0B\u5E8F\u2014\u2014\u4ECE\u6700\u5C0F\u7684\u79FB\u52A8\u5E94\u7528\u7A0B\u5E8F\u5230\u6700\u5927\u7684 Web \u548C\u4F01\u4E1A\u5E94\u7528\u7A0B\u5E8F\u3002</p></blockquote><p>shiro \u662Fapache\u65D7\u4E0B\u7684\u4E00\u4E2A\u5F00\u6E90\u6846\u67B6\uFF0C\u5B83\u5C06\u8F6F\u4EF6\u7CFB\u7EDF\u7684\u5B89\u5168\u8BA4\u8BC1\u76F8\u5173\u7684\u529F\u80FD\u62BD\u53D6\u51FA\u6765\uFF0C\u5B9E\u73B0\u7528\u6237\u8EAB\u4EFD\u8BA4\u8BC1\uFF0C\u6743\u9650\u6388\u6743\u3001\u52A0\u5BC6\u3001\u4F1A\u8BDD\u7BA1\u7406\u7B49\u529F\u80FD\uFF0C\u7EC4\u6210\u4E00\u4E2A\u901A\u7528\u7684\u5B89\u5168\u8BA4\u8BC1\u6846\u67B6</p><h3 id="shiro\u7684\u6838\u5FC3\u67B6\u6784"><a class="header-anchor" href="#shiro\u7684\u6838\u5FC3\u67B6\u6784" aria-hidden="true">#</a> shiro\u7684\u6838\u5FC3\u67B6\u6784</h3><p>\u5B98\u65B9\u7684\u67B6\u6784\uFF1Ahttps://shiro.apache.org/reference.html</p><p><img src="'+a+'" alt=""></p><h4 id="subject"><a class="header-anchor" href="#subject" aria-hidden="true">#</a> Subject</h4><p>\u5C31\u76F8\u5F53\u4E8E\u4E3B\u4F53\uFF0C\u4E5F\u5C31\u662F\u5E94\u7528\u5728\u4E0D\u540C\u7684\u7B2C\u4E09\u65B9\u8BED\u8A00\u7684\u5E94\u7528</p><h4 id="securitymanager"><a class="header-anchor" href="#securitymanager" aria-hidden="true">#</a> SecurityManager</h4><p>\u5B89\u5168\u7BA1\u7406\u5668\uFF0C\u662Fshiro\u4E2D\u6700\u6838\u5FC3\u7684API\u4E4B\u4E00\uFF0C\u8981\u4F7F\u7528shiro\u8FDB\u884C\u6743\u9650\u7BA1\u7406\u7684\u65F6\u5019\uFF0C\u9996\u5148\u8981\u62FF\u5230\u5B89\u5168\u7BA1\u7406\u5668SecurityManager\uFF0C\u65E0\u8BBA\u662F\u505A\u4EC0\u4E48\uFF0C\u90FD\u9700\u8981\u5148\u627E\u5230\u5B89\u5168\u7BA1\u7406\u5668SecurityManager</p><p>\u7EE7\u627F\u4E86Authenticator\u3001Authorizer\u3001SessionManager\u8FD9\u4E09\u4E2A\u63A5\u53E3</p><h4 id="authenticator"><a class="header-anchor" href="#authenticator" aria-hidden="true">#</a> Authenticator</h4><p>\uFF08\u8BA4\u8BC1\uFF09</p><p>\u505A\u8BA4\u8BC1\u7684</p><p><img src="'+t+'" alt=""></p><h4 id="authorizer"><a class="header-anchor" href="#authorizer" aria-hidden="true">#</a> Authorizer</h4><p>\uFF08\u6388\u6743\uFF09</p><p>\u505A\u6388\u6743\u7684</p><p><img src="'+e+'" alt=""></p><h4 id="realm-\u9886\u57DF"><a class="header-anchor" href="#realm-\u9886\u57DF" aria-hidden="true">#</a> Realm\uFF08\u9886\u57DF\uFF09</h4><p>\u662F\u6574\u4E2Ashiro\u4E2D\u5177\u4F53\u53BB\u505A\u8BA4\u8BC1\u548C\u6388\u6743\u7684\u9002\u914D\u7684\uFF0C\u6BD4\u5982\uFF1AjdbcRealm</p><p>\u8BF4\u767D\u4E86\u5C31\u662F\u83B7\u53D6\u8BA4\u8BC1\u548C\u6388\u6743\u4E2D\u7684\u6570\u636E\uFF0C\u5E76\u5B8C\u6210\u76F8\u5E94\u7684\u8BA4\u8BC1\u7684\u6388\u6743\u64CD\u4F5C\u7684</p><h4 id="sessionmanager"><a class="header-anchor" href="#sessionmanager" aria-hidden="true">#</a> SessionManager</h4><p>\u56E0\u4E3Ashiro\u9700\u8981\u5E2E\u6211\u4EEC\u5BF9\u7528\u6237\u8FDB\u884C\u8BA4\u8BC1\u548C\u6388\u6743\uFF0C\u90A3\u4E48\u7528\u6237\u5728\u8BA4\u8BC1\u901A\u8FC7\u4E4B\u540E\uFF0C\u4E4B\u524D\u6CA1\u6709\u4F7F\u7528shiro\u7684\u65F6\u5019\uFF0C\u9700\u8981\u628A\u7528\u6237\u8BA4\u8BC1\u7684session\u4E2D\u4FDD\u5B58\u5230\u5185\u5B58\u4E2D\uFF0C\u73B0\u5728\u5982\u679C\u4F7F\u7528shiro\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u4EA4\u7ED9shiro\u7684session manager\u8FDB\u884C\u7BA1\u7406\uFF0C\u5373session manager\u662F\u6765\u7528\u7BA1\u7406\u6574\u4E2Ashiro\u5728web\u5E94\u7528\u4E2D\u7684\u4F1A\u8BDD\u7684</p><h4 id="sessiondao"><a class="header-anchor" href="#sessiondao" aria-hidden="true">#</a> SessionDAO</h4><p>\u662F\u7528\u6765\u5BF9\u4F1A\u8BDD\u6570\u636E\u8FDB\u884C\u7BA1\u7406\u7684\uFF0C\u5B9E\u73B0\u6570\u636E\u7684\u6301\u4E45\u5316\u548C\u5185\u5B58\u7684\u7BA1\u7406</p><h4 id="cachemanager"><a class="header-anchor" href="#cachemanager" aria-hidden="true">#</a> CacheManager</h4><p>\u4E3B\u8981\u662F\u7F13\u5B58\u8BA4\u8BC1\u7684\u6388\u6743\u7684\u4E00\u4E9B\u6570\u636E\uFF0C\u6BD4\u5982\uFF1A\u7528\u6237\u5728\u767B\u5F55\u4E4B\u540E\uFF0C\u5F53\u7528\u6237\u5BF9\u540E\u7AEF\u53D1\u8D77\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u6B64\u65F6\u5C31\u9700\u8981\u8BA4\u8BC1\u7528\u6237\uFF0C\u5982\u679C\u5728\u6BCF\u6B21\u90FD\u5BF9\u6570\u636E\u5E93\u8FDB\u884C\u8BFB\u53D6\u64CD\u4F5C\u7684\u8BDD\uFF0C\u5BF9\u6570\u636E\u5E93\u7684\u635F\u8017\u5C31\u6BD4\u8F83\u9AD8\uFF0C\u6240\u4EE5\u5982\u679C\u6B64\u65F6\u4F7F\u7528cachemanager\u7F13\u5B58\u8D77\u6765\uFF0C\u5C31\u4E0D\u7528\u6BCF\u6B21\u90FD\u8BFB\u53D6\u6570\u636E\u5E93\u4E86</p><h4 id="cryptography"><a class="header-anchor" href="#cryptography" aria-hidden="true">#</a> Cryptography</h4><p>\u7B97\u6CD5\u751F\u6210\u5668\uFF0C\u5728\u505A\u8BA4\u8BC1\u7684\u6388\u6743\u7684\u65F6\u5019\uFF0C\u9700\u8981\u9A8C\u8BC1\u7528\u6237\u7684\u65F6\u5019\uFF0C\u9700\u8981\u5BF9\u5BC6\u7801\u8FDB\u884C\u52A0\u5BC6\uFF0C\u52A0\u5BC6\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5C31\u9700\u8981\u7B97\u6CD5\u751F\u6210\u7684\u7B56\u7565\uFF0C\u63D0\u4F9B\u7684\u7B97\u6CD5\u6BD4\u5982\u6709sha256\u3001MD5\u7B49</p><h2 id="\u8BA4\u8BC1"><a class="header-anchor" href="#\u8BA4\u8BC1" aria-hidden="true">#</a> \u8BA4\u8BC1</h2><p>\u8EAB\u4EFD\u8BA4\u8BC1\uFF0C\u5C31\u662F\u5224\u65AD\u4E00\u4E2A\u7528\u6237\u662F\u5426\u4E3A\u5408\u6CD5\u7528\u6237\u7684\u5904\u7406\u8FC7\u7A0B\uFF0C\u6700\u5E38\u7528\u7684\u7B80\u5355\u8EAB\u4EFD\u8BA4\u8BC1\u5C31\u662F\u7CFB\u7EDF\u5BF9\u7528\u6237\u8F93\u5165\u7684\u7528\u6237\u540D\u548C\u53E3\u4EE4\uFF0C\u770B\u5176\u662F\u5426\u4E0E\u7CFB\u7EDF\u4E2D\u5B58\u50A8\u7684\u8BE5\u7528\u6237\u7684\u7528\u6237\u540D\u548C\u53E3\u4EE4\u662F\u5426\u4E00\u81F4</p><h3 id="\u8BA4\u8BC1\u4E2D\u7684\u5173\u952E\u5BF9\u8C61"><a class="header-anchor" href="#\u8BA4\u8BC1\u4E2D\u7684\u5173\u952E\u5BF9\u8C61" aria-hidden="true">#</a> \u8BA4\u8BC1\u4E2D\u7684\u5173\u952E\u5BF9\u8C61</h3><ol><li>subject \u4E3B\u4F53</li></ol><p>\u8BBF\u95EE\u7CFB\u7EDF\u7684\u7528\u6237\uFF0C\u4E3B\u4F53\u53EF\u4EE5\u662F\u7528\u6237\u3001\u7A0B\u5E8F\u7B49\uFF0C\u8FDB\u884C\u8BA4\u8BC1\u7684\u90FD\u79F0\u4E3A\u4E3B\u4F53</p><ol start="2"><li>Principal \u8EAB\u4EFD\u4FE1\u606F</li></ol><p>\u662F\u4E3B\u4F53\uFF08subject\uFF09\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1\u7684\u7684\u6807\u8BC6\uFF0C\u6807\u8BC6\u5FC5\u987B\u5177\u6709\u552F\u4E00\u6027\uFF0C\u5982\u7528\u6237\u540D\u3001\u624B\u673A\u53F7\u3001\u90AE\u7BB1\u5730\u5740\u7B49\uFF0C\u4E00\u4E2A\u4E3B\u4F53\u53EF\u4EE5\u6709\u591A\u4E2A\u8EAB\u4EFD\uFF0C\u4F46\u662F\u5FC5\u987B\u6709\u4E00\u4E2A\u4E3B\u8EAB\u4EFD\uFF08Primary Principal\uFF09</p><ol start="3"><li>Credential \u51ED\u8BC1\u4FE1\u606F</li></ol><p>\u662F\u53EA\u6709\u4E3B\u4F53\u81EA\u5DF1\u77E5\u9053\u7684\u5B89\u5168\u4FE1\u606F\uFF0C\u5982\u5BC6\u7801\u3001\u8BC1\u4E66\u7B49</p><h3 id="\u8BA4\u8BC1\u6D41\u7A0B"><a class="header-anchor" href="#\u8BA4\u8BC1\u6D41\u7A0B" aria-hidden="true">#</a> \u8BA4\u8BC1\u6D41\u7A0B</h3><p><img src="'+p+`" alt=""></p><h3 id="\u8BA4\u8BC1\u5F00\u53D1"><a class="header-anchor" href="#\u8BA4\u8BC1\u5F00\u53D1" aria-hidden="true">#</a> \u8BA4\u8BC1\u5F00\u53D1</h3><p>\u524D\u671F\u6211\u4EEC\u5B66\u4E60shiro\u5C31\u76F4\u63A5\u4F7F\u7528\u6807\u51C6\u7684Java maven\u9879\u76EE\u5C31\u53EF\u4EE5\u4E86\uFF0C\u4E4B\u540E\u4F1A\u7ED3\u5408web\u9879\u76EE\u8FDB\u884C\u5F00\u53D1</p><ol><li>\u521B\u5EFA\u9879\u76EE\u5E76\u5F15\u5165\u4F9D\u8D56</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EA\u8981\u5F15\u5165shiro\u6838\u5FC3\uFF0C\u5C31\u4F1A\u81EA\u52A8\u4F9D\u8D56\u5230\u5176\u4ED6\u7684\u9879\u76EE</p><p><img src="`+o+`" alt=""></p><ol start="2"><li>\u521B\u5EFAshiro\u914D\u7F6E\u6587\u4EF6</li></ol><p>\u4F7F\u7528\u540E\u7F00\u4E3Aini\u7684\u6587\u4EF6\uFF0Cini\u6587\u4EF6\u4E3B\u8981\u662F\u53EF\u4EE5\u5B58\u50A8\u590D\u6742\u6570\u636E\u7684\u914D\u7F6E\u6587\u4EF6\uFF0Cshiro\u4E5F\u4F1A\u6839\u636Eini\u6765\u5904\u7406\u914D\u7F6E\u6587\u4EF6</p><p>\u4EE5\u540E\u6211\u4EEC\u6574\u5408\u5230springboot\u4E4B\u540E\uFF0C\u662F\u7528\u4E0D\u5230\u8FD9\u4E2A\u914D\u7F6E\u6587\u4EF6\u7684\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u4E3B\u8981\u662F\u4E3A\u4E86\u7528\u6765\u5B66\u4E60shiro\u4F7F\u7528\u7684\uFF0C\u4E66\u5199\u6211\u4EEC\u7CFB\u7EDF\u4E2D\u76F8\u5173\u7684\u6743\u9650\u6570\u636E\uFF0C\u4E00\u822C\u5305\u62EC\u4E24\u4E2A\u90E8\u5206\uFF1A\u8BA4\u8BC1\u548C\u6388\u6743\uFF0C\u8BA4\u8BC1\u5C31\u9700\u8981\u7528\u6237\u540D\u548C\u53E3\u4EE4\uFF0C\u6388\u6743\u5C31\u662F\u4E3A\u4E86\u5224\u65AD\u67D0\u4E2A\u83DC\u5355\u6216\u8005\u6309\u94AE\u5BF9\u4E8E\u5F53\u524D\u901A\u8FC7\u8BA4\u8BC1\u7684\u7528\u6237\u662F\u5426\u6709\u8FD9\u4E2A\u6743\u9650</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">users</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">zhansan</span><span class="token punctuation">=</span><span class="token value attr-value">123</span>
<span class="token key attr-name">lisi</span><span class="token punctuation">=</span><span class="token value attr-value">456</span>
<span class="token key attr-name">wangwu</span><span class="token punctuation">=</span><span class="token value attr-value">789</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+c+`" alt=""></p><ol start="3"><li>\u5F00\u53D1\u8BA4\u8BC1\u4EE3\u7801</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestAuthenticator</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u521B\u5EFAsecurity manager</span>
        <span class="token keyword">final</span> <span class="token class-name">DefaultSecurityManager</span> defaultSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        defaultSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IniRealm</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:shiro.ini&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5C06\u5B89\u88C5\u5DE5\u5177\u7C7B\u4E2D\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5B89\u5168\u7BA1\u7406\u5668</span>
        <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
        <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span><span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u521B\u5EFAtoken\u4EE4\u724C</span>
        <span class="token keyword">final</span> <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u767B\u5F55\u6210\u529F~ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span><span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7528\u6237\u540D\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BC6\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u8BA4\u8BC1\u72B6\u6001: false
\u767B\u5F55\u6210\u529F~ 
\u8BA4\u8BC1\u72B6\u6001: true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u81EA\u5B9A\u4E49realm"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49realm" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49Realm</h3><p>\u901A\u8FC7\u4E4B\u524D\u7684shiro\u7684\u67B6\u6784\u53EF\u4EE5\u77E5\u9053\uFF0C\u5982\u679C\u60F3\u8981\u5C06\u6570\u636E\u5E93\u4E2D\u7684\u7528\u6237\u4FE1\u606F\u5E94\u7528\u5230\u8BA4\u8BC1\u4E2D\uFF0C\u90A3\u4E48\u5C31\u9700\u8981\u81EA\u5DF1\u5B9E\u73B0Realm</p><h4 id="\u8BA4\u8BC1\u6E90\u7801\u7684\u6D41\u7A0B"><a class="header-anchor" href="#\u8BA4\u8BC1\u6E90\u7801\u7684\u6D41\u7A0B" aria-hidden="true">#</a> \u8BA4\u8BC1\u6E90\u7801\u7684\u6D41\u7A0B</h4><p>\u8C03\u7528subject.login\u51FD\u6570\u7684\u8FC7\u7A0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token function">clearRunAsIdentitiesInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Subject</span> subject <span class="token operator">=</span> securityManager<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8C03\u7528securityManager\u767B\u5F55</span>

    <span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">;</span>

    <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// \u767B\u5F55\u4E4B\u540E\u83B7\u53D6\u7528\u6237\u7684\u8EAB\u4EFD\u4FE1\u606F\u5B58\u50A8\u5230principals\u4E2D</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subject <span class="token keyword">instanceof</span> <span class="token class-name">DelegatingSubject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DelegatingSubject</span> delegating <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DelegatingSubject</span><span class="token punctuation">)</span> subject<span class="token punctuation">;</span>
        <span class="token comment">//we have to do this in case there are assumed identities - we don&#39;t want to lose the &#39;real&#39; principals:</span>
        principals <span class="token operator">=</span> delegating<span class="token punctuation">.</span>principals<span class="token punctuation">;</span>
        host <span class="token operator">=</span> delegating<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        principals <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">getPrincipals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>principals <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> principals<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Principals returned from securityManager.login( token ) returned a null or &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;empty value.  This value must be non null and populated with one or more elements.&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>principals <span class="token operator">=</span> principals<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>authenticated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// \u80FD\u8D70\u5230\u8FD9\u91CC\u5C31\u8868\u793A\u5C31\u5DF2\u7ECF\u767B\u5F55\u6210\u529F\u4E86\uFF0C\u8868\u793A\u8BA4\u8BC1\u901A\u8FC7\u4E86</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token keyword">instanceof</span> <span class="token class-name">HostAuthenticationToken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        host <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HostAuthenticationToken</span><span class="token punctuation">)</span> token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>host <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u5B58\u50A8session</span>
    <span class="token class-name">Session</span> session <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token function">decorate</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8C03\u7528securityManager.login\u7684\u8FC7\u7A0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Subject</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">Subject</span> subject<span class="token punctuation">,</span> <span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">AuthenticationInfo</span> info<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        info <span class="token operator">=</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u4E3B\u8981\u662F\u8C03\u7528authenticate\u5B9E\u73B0\u767B\u5F55</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ae<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">onFailedLogin</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> ae<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;onFailedLogin method threw an &quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;exception.  Logging and propagating original AuthenticationException.&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> ae<span class="token punctuation">;</span> <span class="token comment">//propagate</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Subject</span> loggedIn <span class="token operator">=</span> <span class="token function">createSubject</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> info<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u521B\u5EFAsubject\u65B9\u4FBF\u8FD4\u56DE</span>

    <span class="token function">onSuccessfulLogin</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> info<span class="token punctuation">,</span> loggedIn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u767B\u5F55\u6210\u529F\uFF0C\u5C06\u5F53\u524D\u7684subject\u4FDD\u5B58\u8D77\u6765\uFF0C\u65B9\u4FBF\u505A\u4E0B\u6B21\u6821\u9A8C</span>

    <span class="token keyword">return</span> loggedIn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8C03\u7528authenticate\u51FD\u6570</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Method argument (authentication token) cannot be null.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication attempt received for token [{}]&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">AuthenticationInfo</span> info<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        info <span class="token operator">=</span> <span class="token function">doAuthenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u505A\u767B\u5F55\u5DE5\u4F5C</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>info <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;No account information found for authentication token [&quot;</span> <span class="token operator">+</span> token <span class="token operator">+</span> <span class="token string">&quot;] by this &quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;Authenticator instance.  Please check that it is configured correctly.&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AuthenticationException</span> ae <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token keyword">instanceof</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ae <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span><span class="token punctuation">)</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ae <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Exception thrown was not an expected AuthenticationException.  Therefore it is probably a little more</span>
            <span class="token comment">//severe or unexpected.  So, wrap in an AuthenticationException, log to warn, and propagate:</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Authentication failed for token submission [&quot;</span> <span class="token operator">+</span> token <span class="token operator">+</span> <span class="token string">&quot;].  Possible unexpected &quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;error? (Typical or expected login exceptions should extend from AuthenticationException).&quot;</span><span class="token punctuation">;</span>
            ae <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">notifyFailure</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> ae<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Unable to send notification for failed authentication attempt - listener error?.  &quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;Please check your AuthenticationListener implementation(s).  Logging sending exception &quot;</span> <span class="token operator">+</span>
                        <span class="token string">&quot;and propagating original AuthenticationException instead...&quot;</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">throw</span> ae<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Authentication successful for token [{}].  Returned account [{}]&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u901A\u77E5\u4EFB\u4F55\u4E00\u65A4\u6CE8\u518C\u76D1\u542C\u5668\uFF0C\u767B\u5F55\u6210\u529F</span>
    <span class="token function">notifySuccess</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>doAuthenticate</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doAuthenticate</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> authenticationToken<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token function">assertRealmsConfigured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u65AD\u8A00\u662F\u5426\u914D\u7F6Erealm</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Realm</span><span class="token punctuation">&gt;</span></span> realms <span class="token operator">=</span> <span class="token function">getRealms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>realms<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">doSingleRealmAuthentication</span><span class="token punctuation">(</span>realms<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">doMultiRealmAuthentication</span><span class="token punctuation">(</span>realms<span class="token punctuation">,</span> authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doSingleRealmAuthentication</span><span class="token punctuation">(</span><span class="token class-name">Realm</span> realm<span class="token punctuation">,</span> <span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>realm<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Realm [&quot;</span> <span class="token operator">+</span> realm <span class="token operator">+</span> <span class="token string">&quot;] does not support authentication token [&quot;</span> <span class="token operator">+</span>
                token <span class="token operator">+</span> <span class="token string">&quot;].  Please ensure that the appropriate Realm implementation is &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;configured correctly or that the realm accepts AuthenticationTokens of this type.&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedTokenException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u8FD9\u4E2A\u65B9\u6CD5\u662F\u4F1A\u5148\u4ECE\u7F13\u5B58\u4E2D\u83B7\u53D6\u5230\u4FE1\u606F\uFF0C\u5982\u679C\u83B7\u53D6\u4E0D\u5230\uFF0C\u5728\u6267\u884C\u8BA4\u8BC1</span>
    <span class="token class-name">AuthenticationInfo</span> info <span class="token operator">=</span> realm<span class="token punctuation">.</span><span class="token function">getAuthenticationInfo</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>info <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Realm [&quot;</span> <span class="token operator">+</span> realm <span class="token operator">+</span> <span class="token string">&quot;] was unable to find account data for the &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;submitted AuthenticationToken [&quot;</span> <span class="token operator">+</span> token <span class="token operator">+</span> <span class="token string">&quot;].&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnknownAccountException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doMultiRealmAuthentication</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Realm</span><span class="token punctuation">&gt;</span></span> realms<span class="token punctuation">,</span> <span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">AuthenticationStrategy</span> strategy <span class="token operator">=</span> <span class="token function">getAuthenticationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">AuthenticationInfo</span> aggregate <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">beforeAllAttempts</span><span class="token punctuation">(</span>realms<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Iterating through {} realms for PAM authentication&quot;</span><span class="token punctuation">,</span> realms<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Realm</span> realm <span class="token operator">:</span> realms<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            aggregate <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">beforeAttempt</span><span class="token punctuation">(</span>realm<span class="token punctuation">,</span> token<span class="token punctuation">,</span> aggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ShortCircuitIterationException</span> shortCircuitSignal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Break from continuing with subsequnet realms on receiving </span>
            <span class="token comment">// short circuit signal from strategy</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>realm<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Attempting to authenticate token [{}] using realm [{}]&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> realm<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">AuthenticationInfo</span> info <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">Throwable</span> t <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u540Csingle realm</span>
                info <span class="token operator">=</span> realm<span class="token punctuation">.</span><span class="token function">getAuthenticationInfo</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                t <span class="token operator">=</span> throwable<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Realm [&quot;</span> <span class="token operator">+</span> realm <span class="token operator">+</span> <span class="token string">&quot;] threw an exception during a multi-realm authentication attempt:&quot;</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            aggregate <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">afterAttempt</span><span class="token punctuation">(</span>realm<span class="token punctuation">,</span> token<span class="token punctuation">,</span> info<span class="token punctuation">,</span> aggregate<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Realm [{}] does not support token {}.  Skipping realm.&quot;</span><span class="token punctuation">,</span> realm<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    aggregate <span class="token operator">=</span> strategy<span class="token punctuation">.</span><span class="token function">afterAllAttempts</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> aggregate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> aggregate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">getAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5339\u914D\u5F53\u524D\u7528\u6237\u540D\u662F\u5426\u5728realm\u80FD\u83B7\u53D6\u5F97\u5230\u4E2D</span>
    <span class="token class-name">AuthenticationInfo</span> info <span class="token operator">=</span> <span class="token function">getCachedAuthenticationInfo</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>info <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//otherwise not cached, perform the lookup:</span>
        info <span class="token operator">=</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Looked up AuthenticationInfo [{}] from doGetAuthenticationInfo&quot;</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> info <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u7F13\u5B58\u8D77\u6765</span>
            <span class="token function">cacheAuthenticationInfoIfPossible</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Using cached authentication info [{}] to perform credentials matching.&quot;</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>info <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5F00\u59CB\u9A8C\u8BC1\u5BC6\u7801</span>
        <span class="token function">assertCredentialsMatch</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;No AuthenticationInfo found for submitted AuthenticationToken [{}].  Returning null.&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">UsernamePasswordToken</span> upToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>
    <span class="token class-name">SimpleAccount</span> account <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span>upToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8FD9\u91CC\u5C31\u83B7\u53D6\u5230\u6211\u4EEC\u914D\u7F6E\u7684shiro.ini\u6587\u4EF6\u4E2D\u7684\u7528\u6237\u4FE1\u606F\uFF0C\u5B58\u50A8\u5728protected final Map&lt;String, SimpleAccount&gt; users;\u4E2D</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>account <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>account<span class="token punctuation">.</span><span class="token function">isLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockedAccountException</span><span class="token punctuation">(</span><span class="token string">&quot;Account [&quot;</span> <span class="token operator">+</span> account <span class="token operator">+</span> <span class="token string">&quot;] is locked.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>account<span class="token punctuation">.</span><span class="token function">isCredentialsExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;The credentials for account [&quot;</span> <span class="token operator">+</span> account <span class="token operator">+</span> <span class="token string">&quot;] are expired&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExpiredCredentialsException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> account<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E5F\u5C31\u662F\u771F\u6B63\u5B8C\u6210\u7528\u6237\u540D\u7684\u8BA4\u8BC1\u5C31\u5728\u7C7B<code>SimpleAccountRealm</code>\u4E2D\u7684<code>doGetAuthenticationInfo</code>\u65B9\u6CD5\u4E2D</p><p>\u7136\u540E\u9A8C\u8BC1\u5BC6\u7801\u65B9\u6CD5\u5728<code>assertCredentialsMatch</code>\u4E2D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">assertCredentialsMatch</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">,</span> <span class="token class-name">AuthenticationInfo</span> info<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">CredentialsMatcher</span> cm <span class="token operator">=</span> <span class="token function">getCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cm <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cm<span class="token punctuation">.</span><span class="token function">doCredentialsMatch</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//not successful - throw an exception to indicate this:</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">&quot;Submitted credentials for token [&quot;</span> <span class="token operator">+</span> token <span class="token operator">+</span> <span class="token string">&quot;] did not match the expected credentials.&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IncorrectCredentialsException</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AuthenticationException</span><span class="token punctuation">(</span><span class="token string">&quot;A CredentialsMatcher must be configured in order to verify &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;credentials during authentication.  If you do not wish for credentials to be examined, you &quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;can configure an &quot;</span> <span class="token operator">+</span> <span class="token class-name">AllowAllCredentialsMatcher</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; instance.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E5F\u5C31\u662F\u6700\u7EC8\u5BC6\u7801\u7684\u6821\u9A8C\u5728<code>AuthenticatingRealm</code>\u7684<code>assertCredentialsMatch</code>\u65B9\u6CD5\u4E2D</p><p>\u7EFC\u4E0A\uFF0C\u6211\u4EEC\u8981\u60F3\u81EA\u5DF1\u5B9A\u4E49\u8BA4\u8BC1\uFF0C\u90A3\u4E48\u5C31\u9700\u8981\u505A\u8BA4\u8BC1\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C\u800C\u4E14\u5BC6\u7801\u7684\u6821\u9A8C\u662F\u5B83\u81EA\u5DF1\u81EA\u52A8\u5B8C\u6210\u7684</p><p>\u90A3\u4E48\u6211\u53EA\u9700\u8981\u5B9E\u73B0<code>SimpleAccountRealm</code>\u4E2D\u7684<code>doGetAuthenticationInfo</code>\u65B9\u6CD5\u5373\u53EF\uFF0C\u800C<code>SimpleAccountRealm</code>\u5B9E\u73B0\u4E86<code>AuthorizingRealm</code>\u63A5\u53E3\uFF0C\u90A3\u4E48\u6211\u53EA\u9700\u8981\u4E5F\u5B9E\u73B0\u8FD9\u4E2A\u63A5\u53E3\u5373\u53EF</p><p>\u4E3A\u4EC0\u4E48\u5BC6\u7801\u7684\u6821\u9A8C\u4E0D\u7528\u6211\u4EEC\u6765\u5B8C\u6210\u5462\uFF1F\u56E0\u4E3A\u9700\u8981\u505A\u52A0\u5BC6\u7684\u64CD\u4F5C\uFF0C\u8FD9\u4E9B\u52A0\u5BC6\u64CD\u4F5C\u76F4\u63A5\u7531shiro\u6765\u5B8C\u6210</p><p><img src="`+i+'" alt=""></p><ul><li>AuthorizingRealm \u4E2D\u7684 doGetAuthorizationInfo\u662F\u7528\u6765\u505A\u8BA4\u8BC1\u7684</li><li>AuthenticatingRealm \u4E2D\u7684 doGetAuthenticationInfo\u662F\u7528\u6765\u505A\u6388\u6743\u7684</li></ul><h4 id="\u81EA\u5B9A\u4E49realm\u5B9E\u73B0\u8BA4\u8BC1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49realm\u5B9E\u73B0\u8BA4\u8BC1" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49realm\u5B9E\u73B0\u8BA4\u8BC1</h4><p><img src="'+l+'" alt=""></p><p><img src="'+u+`" alt=""></p><p>\u53EF\u4EE5\u4F7F\u7528SimpleAuthenticationInfo\u4E5F\u53EF\u4EE5\u4F7F\u7528SimpleAccount\uFF0C\u4E00\u822C\u6211\u4EEC\u4F7F\u7528SimpleAuthenticationInfo</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49\u7684Realm\u7684\u5B9E\u73B0\uFF0C\u5C06\u8BA4\u8BC1\u6216\u8005\u6388\u6743\u7684\u6570\u636E\u7684\u6765\u6E90\u8F6C\u4E3A\u6570\u636E\u5E93\u7684\u5B9E\u73B0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u505A\u6388\u6743\u7684
     *
     * <span class="token keyword">@param</span> <span class="token parameter">principals</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u505A\u9A8C\u8BC1\u7684
     *
     * <span class="token keyword">@param</span> <span class="token parameter">token</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">AuthenticationException</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5728token\u4E2D\u83B7\u53D6\u5230\u7528\u6237\u540D</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//TODO \u6839\u636E\u8EAB\u4EFD\u4FE1\u606F\u4F7F\u7528jdbc\u6216\u8005mybatis\u67E5\u8BE2\u6570\u636E\u5E93\u4E2D\u7684\u5BF9\u5E94\u7684\u7528\u6237\u4FE1\u606F</span>
        <span class="token comment">// \u73B0\u5728\u4F7F\u7528\u6A21\u62DF\u6570\u636E\u6765\u6A21\u62DF</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u53C2\u65701 \u6570\u636E\u5E93\u4E2D\u6B63\u786E\u7684\u7528\u6237\u540D</span>
            <span class="token comment">// \u53C2\u65702 \u6570\u636E\u5E93\u4E2D\u8FD4\u56DE\u7684\u5BC6\u7801</span>
            <span class="token comment">// \u53C2\u65703 \u63D0\u4F9B\u5F53\u524Drealm\u7684\u540D\u5B57\uFF0C\u8FD9\u4E2A\u76F4\u63A5\u8C03\u7528\u7236\u7C7B\u7684getName\u5C31\u53EF\u4EE5\u4E86</span>
            <span class="token keyword">final</span> <span class="token class-name">SimpleAuthenticationInfo</span> authenticationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> authenticationInfo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFA\u6D4B\u8BD5\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCustomRealmAuthenticator</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// \u521B\u5EFAsecurity manager</span>
        <span class="token keyword">final</span> <span class="token class-name">DefaultSecurityManager</span> defaultSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        defaultSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u4F7F\u7528\u81EA\u5B9A\u7684realm</span>

        <span class="token comment">// \u5C06\u5B89\u88C5\u5DE5\u5177\u7C7B\u4E2D\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5B89\u5168\u7BA1\u7406\u5668</span>
        <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
        <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span><span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u521B\u5EFAtoken\u4EE4\u724C</span>
        <span class="token keyword">final</span> <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u767B\u5F55\u6210\u529F~ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span><span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7528\u6237\u540D\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BC6\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6267\u884C\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u8BA4\u8BC1\u72B6\u6001: false
zhangsan
\u767B\u5F55\u6210\u529F~ 
\u8BA4\u8BC1\u72B6\u6001: true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528md5\u548Csalt"><a class="header-anchor" href="#\u4F7F\u7528md5\u548Csalt" aria-hidden="true">#</a> \u4F7F\u7528MD5\u548CSalt</h3><p>\u5B9E\u9645\u5E94\u7528\u662F\u5C06\u76D0\u548C\u6563\u5217\u540E\u7684\u503C\u5B58\u5728\u6570\u636E\u5E93\u4E2D\u7684\uFF0C\u81EA\u5B9A\u4E49realm\u4ECE\u6570\u636E\u5E93\u53D6\u51FA\u76D0\u548C\u52A0\u5BC6\u540E\u7684\u503C\u7531shiro\u5B8C\u6210\u5BC6\u7801\u6821\u9A8C</p><p>\u6211\u4EEC\u4E0A\u9762\u7684\u6570\u636E\u5E93\u4E2D\u7684\u5BC6\u7801\u8FD8\u662F\u660E\u6587\u5B58\u50A8\u7684\uFF0C\u8FD9\u6837\u505A\u662F\u4E0D\u5B89\u5168\u7684\uFF0C\u4E00\u822C\u5728\u8BBE\u8BA1\u7CFB\u7EDF\u7684\u65F6\u5019\u4F1A\u5C06\u5BC6\u7801\u52A0\u5BC6\uFF0C\u540C\u65F6\u8FD8\u4F1A\u52A0\u4E00\u5B9A\u7684\u968F\u673A\u76D0\u8FDB\u884C\u6563\u5217</p><h4 id="md5\u4E00\u822C\u7528\u6765\u505A\u52A0\u5BC6\u548C\u7B7E\u540D"><a class="header-anchor" href="#md5\u4E00\u822C\u7528\u6765\u505A\u52A0\u5BC6\u548C\u7B7E\u540D" aria-hidden="true">#</a> MD5\u4E00\u822C\u7528\u6765\u505A\u52A0\u5BC6\u548C\u7B7E\u540D</h4><p>\uFF08\u6821\u9A8C\u548C\uFF09</p><p>\u7279\u70B9\uFF1A</p><ul><li>MD5\u7B97\u6CD5\u4E0D\u53EF\u9006</li><li>\u5982\u679C\u5185\u5BB9\u76F8\u540C\uFF0C\u5F97\u51FA\u7684\u52A0\u5BC6\u7684\u7ED3\u679C\u59CB\u7EC8\u662F\u4E00\u81F4\u7684\uFF0C\u6BD4\u5982\u7F51\u7AD9\u63D0\u4F9B\u4E86\u4E00\u4E2A\u8D44\u6E90\uFF0C\u5728\u4E0B\u8F7D\u8FC7\u7A0B\u4E2D\u56E0\u4E3A\u7F51\u7EDC\u95EE\u9898\uFF0C\u5BFC\u81F4\u5185\u5BB9\u5C11\u4E86\uFF0C\u8FD9\u4E2A\u65F6\u5019\u5C31\u53EF\u4EE5\u4F7F\u7528MD5\u8FDB\u884C\u6BD4\u8F83\uFF0C\u4E5F\u5C31\u662F\u53EF\u4EE5\u5BF9\u6587\u4EF6\u7684\u5185\u5BB9\u8FDB\u884C\u6BD4\u8F83</li></ul><p>\u90A3\u4E48\u7528\u5728shiro\u4E0A\uFF0C\u5C31\u53EF\u4EE5\u5BF9\u5BC6\u7801\u8FDB\u884C\u52A0\u5BC6</p><p>\u751F\u6210\u7ED3\u679C\uFF1A\u65E0\u8BBA\u5185\u5BB9\u6709\u591A\u5927\uFF0C\u59CB\u7EC8\u662F\u4E00\u4E2A16\u8FDB\u5236\u957F\u5EA6\u4E3A32\u4E3A\u957F\u5EA6\u7684\u5B57\u7B26\u4E32</p><p><img src="`+k+'" alt=""></p><h4 id="\u5B9E\u6218-md5\u548Csalt\u5B9E\u73B0"><a class="header-anchor" href="#\u5B9E\u6218-md5\u548Csalt\u5B9E\u73B0" aria-hidden="true">#</a> \u5B9E\u6218\uFF1AMD5\u548Csalt\u5B9E\u73B0</h4><p><img src="'+r+`" alt=""></p><p>MD5\u5728shiro\u4E2D\u7684\u4F7F\u7528\u6D4B\u8BD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Md5Hash</span> md5Hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> md5Hash<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u52A0\u76D0</span>
    <span class="token keyword">final</span> <span class="token class-name">Md5Hash</span> md5Hash1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;X0&amp;*&amp;&amp;38&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s1 <span class="token operator">=</span> md5Hash1<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6D4B\u8BD5md5\u7684\u81EA\u5B9A\u4E49realm
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u521B\u5EFAsecurity manager</span>
    <span class="token keyword">final</span> <span class="token class-name">DefaultSecurityManager</span> defaultSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">CustomMd5Realm</span> md5Realm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomMd5Realm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6Erealm\u5728\u5339\u914D\u5BC6\u7801\u7684\u4F7F\u7528\u4F7F\u7528md5\u7684\u51ED\u8BC1\u5339\u914D\u5668</span>
    <span class="token keyword">final</span> <span class="token class-name">HashedCredentialsMatcher</span> credentialsMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    md5Realm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>credentialsMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>

    defaultSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>md5Realm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u4F7F\u7528\u81EA\u5B9A\u7684realm</span>

    <span class="token comment">// \u5C06\u5B89\u88C5\u5DE5\u5177\u7C7B\u4E2D\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5B89\u5168\u7BA1\u7406\u5668</span>
    <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
    <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span> <span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521B\u5EFAtoken\u4EE4\u724C</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u767B\u5F55\u6210\u529F~ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span> <span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7528\u6237\u540D\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BC6\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5\u8C03\u7528</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49\u7684Realm\u7684\u5B9E\u73B0\uFF0C\u5C06\u8BA4\u8BC1\u6216\u8005\u6388\u6743\u7684\u6570\u636E\u7684\u6765\u6E90\u8F6C\u4E3A\u6570\u636E\u5E93\u7684\u5B9E\u73B0
 * \u52A0\u5165MD5+salt+hash\u6563\u5217
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomMd5Realm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u505A\u6388\u6743\u7684
     *
     * <span class="token keyword">@param</span> <span class="token parameter">principals</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u505A\u9A8C\u8BC1\u7684
     *
     * <span class="token keyword">@param</span> <span class="token parameter">token</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">AuthenticationException</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5728token\u4E2D\u83B7\u53D6\u5230\u7528\u6237\u540D</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//TODO \u6839\u636E\u8EAB\u4EFD\u4FE1\u606F\u4F7F\u7528jdbc\u6216\u8005mybatis\u67E5\u8BE2\u6570\u636E\u5E93\u4E2D\u7684\u5BF9\u5E94\u7684\u7528\u6237\u4FE1\u606F</span>
        <span class="token comment">// \u73B0\u5728\u4F7F\u7528\u6A21\u62DF\u6570\u636E\u6765\u6A21\u62DF</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fafdsfsfudidc&quot;</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u53C2\u65701 \u6570\u636E\u5E93\u4E2D\u6B63\u786E\u7684\u7528\u6237\u540D</span>
            <span class="token comment">// \u53C2\u65702 \u6570\u636E\u5E93\u4E2D\u8FD4\u56DE\u7684md5+salt\u7684\u5BC6\u7801</span>
            <span class="token comment">// \u53C2\u65703 \u6CE8\u518C\u65F6\u7684\u968F\u673A\u76D0</span>
            <span class="token comment">// \u53C2\u65704 \u63D0\u4F9B\u5F53\u524Drealm\u7684\u540D\u5B57\uFF0C\u8FD9\u4E2A\u76F4\u63A5\u8C03\u7528\u7236\u7C7B\u7684getName\u5C31\u53EF\u4EE5\u4E86</span>
            <span class="token keyword">final</span> <span class="token class-name">SimpleAuthenticationInfo</span> authenticationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token string">&quot;fafdsfsfudidc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> authenticationInfo<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6D4B\u8BD5\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u8BA4\u8BC1\u72B6\u6001: false
zhangsan
\u767B\u5F55\u6210\u529F~ 
\u8BA4\u8BC1\u72B6\u6001: true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6388\u6743"><a class="header-anchor" href="#\u6388\u6743" aria-hidden="true">#</a> \u6388\u6743</h2><h3 id="\u6982\u5FF5"><a class="header-anchor" href="#\u6982\u5FF5" aria-hidden="true">#</a> \u6982\u5FF5</h3><p>\u6388\u6743\uFF0C\u5C31\u662F\u8BBF\u95EE\u63A7\u5236\uFF0C\u63A7\u5236\u8C01\u80FD\u8BBF\u95EE\u90A3\u4E9B\u8D44\u6E90\uFF0C\u4E3B\u4F53\u8FDB\u884C\u8EAB\u4EFD\u8BA4\u8BC1\u540E\u9700\u8981\u5206\u914D\u6743\u9650\u65B9\u53EF\u8BBF\u95EE\u7CFB\u7EDF\u7684\u8D44\u6E90\uFF0C\u5BF9\u4E8E\u67D0\u4E9B\u8D44\u6E90\u6CA1\u6709\u6743\u9650\u662F\u65E0\u6CD5\u8BBF\u95EE\u7684</p><h3 id="\u5173\u952E\u5BF9\u8C61"><a class="header-anchor" href="#\u5173\u952E\u5BF9\u8C61" aria-hidden="true">#</a> \u5173\u952E\u5BF9\u8C61</h3><p>\u6388\u6743\u53EF\u4EE5\u7B80\u5355\u7406\u89E3\u4E3Awho\u5BF9what(which)\u8FDB\u884Chow\u64CD\u4F5C</p><ul><li>who \u4E3B\u4F53\uFF08Subject\uFF09\uFF0C\u4E3B\u4F53\u9700\u8981\u8BBF\u95EE\u7CFB\u7EDF\u4E2D\u7684\u8D44\u6E90</li><li>what \u8D44\u6E90\uFF08Resource\uFF09\uFF0C\u5982\u7CFB\u7EDF\u83DC\u5355\u3001\u9875\u9762\u3001\u6309\u94AE\u3001\u7C7B\u65B9\u6CD5\u3001\u7D2B\u94DC\u5546\u54C1\u4FE1\u606F\u7B49\uFF0C\u8D44\u6E90\u5305\u62EC\u8D44\u6E90\u7C7B\u578B\u548C\u8D44\u6E90\u5B9E\u4F8B\uFF0C\u6BD4\u5982\u5546\u54C1\u4FE1\u606F\u4E3A\u8D44\u6E90\u7C7B\u578B\uFF0C\u7C7B\u578B\u4E3At01\u7684\u5546\u54C1\u4E3A\u8D44\u6E90\u5B9E\u4F8B\u7F16\u53F7\u4E3A001\u7684\u5546\u54C1\u4FE1\u606F\u4E5F\u5C5E\u4E8E\u8D44\u6E90\u5B9E\u4F8B</li><li>how \u6743\u9650\u3001\u8BB8\u53EF\uFF08Premission\uFF09\uFF0C\u89C4\u5B9A\u4E86\u4E3B\u4F53\u5BF9\u8D44\u6E90\u7684\u64CD\u4F5C\u8BB8\u53EF\uFF0C\u6743\u9650\u79BB\u5F00\u6CA1\u6709\u610F\u4E49\uFF0C\u5982\u7528\u6237\u67E5\u8BE2\u6743\u9650\u3001\u7528\u6237\u6DFB\u52A0\u6743\u9650\u3001\u67D0\u4E2A\u7C7B\u65B9\u6CD5\u7684\u8C03\u7528\u6743\u9650\u3001\u7F16\u53F7\u4E3A001\u7528\u6237\u7684\u4FEE\u6539\u6743\u9650\u7B49\uFF0C\u901A\u8FC7\u6743\u9650\u53EF\u77E5\u4E3B\u4F53\u5BF9\u54EA\u4E9B\u8D44\u6E90\u90FD\u6709\u54EA\u4E9B\u64CD\u4F5C\u8BB8\u53EF</li></ul><h3 id="\u6388\u6743\u6D41\u7A0B"><a class="header-anchor" href="#\u6388\u6743\u6D41\u7A0B" aria-hidden="true">#</a> \u6388\u6743\u6D41\u7A0B</h3><p><img src="`+d+`" alt=""></p><h3 id="\u6388\u6743\u65B9\u5F0F"><a class="header-anchor" href="#\u6388\u6743\u65B9\u5F0F" aria-hidden="true">#</a> \u6388\u6743\u65B9\u5F0F</h3><ol><li>\u57FA\u4E8E\u89D2\u8272\u7684\u8BBF\u95EE\u63A7\u5236</li></ol><p>RBAC\u57FA\u4E8E\u89D2\u8272\u7684\u8BBF\u95EE\u63A7\u5236\uFF08Role-Based Access Control\uFF09\u662F\u4EE5\u89D2\u8272\u4E3A\u4E2D\u5FC3\u8FDB\u884C\u8BBF\u95EE\u63A7\u5236</p><p>\u4F2A\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>if(subject.hasRole(&quot;admin&quot;)){
    //\u64CD\u4F5C\u4EC0\u4E48\u8D44\u6E90
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u57FA\u4E8E\u8D44\u6E90\u7684\u8BBF\u95EE\u63A7\u5236</li></ol><p>RBAC\u57FA\u4E8E\u8D44\u6E90\u7684\u8BBF\u95EE\u63A7\u5236\uFF08Resource-Based Access Control\uFF09\u662F\u4EE5\u8D44\u6E90\u4E3A\u4E2D\u5FC3\u8FDB\u884C\u8BBF\u95EE\u63A7\u5236</p><p>\u4F2A\u4EE3\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>if(subject.isPremission(&quot;user:update:01&quot;)){
    // \u5BF901\u7528\u6237\u8FDB\u884C\u4FEE\u6539
}

if(subject.isPremission(&quot;user:update:*&quot;)){
    // \u5BF9\u6240\u6709\u7528\u6237\u8FDB\u884C\u4FEE\u6539
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6743\u9650\u5B57\u7B26\u4E32"><a class="header-anchor" href="#\u6743\u9650\u5B57\u7B26\u4E32" aria-hidden="true">#</a> \u6743\u9650\u5B57\u7B26\u4E32</h3><p>\u6743\u9650\u5B57\u7B26\u4E32\u7684\u89C4\u5219\u662F\uFF1A\u8D44\u6E90\u6807\u8BC6\u7B26\uFF1A\u64CD\u4F5C\uFF1A\u8D44\u6E90\u5B9E\u4F8B\u6807\u8BC6\u7B26\uFF0C\u610F\u601D\u662F\u5BF9\u90A3\u4E2A\u8D44\u6E90\u7684\u54EA\u4E2A\u5B9E\u4F8B\u5177\u6709\u4EC0\u4E48\u64CD\u4F5C\uFF0C&quot;:&quot;\u662F\u8D44\u6E90/\u64CD\u4F5C/\u5B9E\u4F8B\u7684\u5206\u5272\u7B26\uFF0C\u6743\u9650\u5B57\u7B26\u4E32\u4E5F\u53EF\u4EE5\u4F7F\u7528*\u901A\u914D\u7B26</p><p>\u4F8B\u5B50\uFF1A</p><ul><li>\u7528\u6237\u521B\u5EFA\u6743\u9650\uFF1Auser:create\uFF0C\u6216\u8005user:create:*</li><li>\u7528\u6237\u4FEE\u6539\u5B9E\u4F8B001\u7684\u6743\u9650\uFF1Auser:update:001</li><li>\u7528\u6237\u5B9E\u4F8B001\u7684\u6240\u4EE5\u6743\u9650\uFF1Auser:*:001</li></ul><h3 id="shiro\u4E2D\u6388\u6743\u7F16\u7A0B\u5B9E\u73B0\u65B9\u5F0F"><a class="header-anchor" href="#shiro\u4E2D\u6388\u6743\u7F16\u7A0B\u5B9E\u73B0\u65B9\u5F0F" aria-hidden="true">#</a> shiro\u4E2D\u6388\u6743\u7F16\u7A0B\u5B9E\u73B0\u65B9\u5F0F</h3><ol><li>\u7F16\u7A0B\u5F0F\uFF1A</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Subject</span> subject <span class="token operator">=</span><span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u6709\u6743\u9650</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">// \u65E0\u6743\u9650</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u6CE8\u89E3\u5F0F</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequiresRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u6709\u6743\u9650</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u6807\u7B7E\u5F0F</li></ol><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>JSP/GSP \u6807\u7B7E\uFF1A\u5728JSP/GSP\u9875\u9762\u901A\u8FC7\u76F8\u5E94\u7684\u6807\u7B7E\u5B8C\u6210
&lt;shiro:hasRole name=&quot;admin&quot;&gt;
&lt;!--\u6709\u6743\u9650--&gt;
&lt;/shiro:hasRole&gt;
\u6CE8\u610F\uFF1AThymelef\u4E2D\u4F7F\u7528shiro\u9700\u8981\u989D\u5916\u96C6\u6210
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5F00\u53D1\u81EA\u5B9A\u4E49\u6388\u6743"><a class="header-anchor" href="#\u5F00\u53D1\u81EA\u5B9A\u4E49\u6388\u6743" aria-hidden="true">#</a> \u5F00\u53D1\u81EA\u5B9A\u4E49\u6388\u6743</h3><ol><li>\u6388\u6743\u7684\u6570\u636E\u6765\u6E90\u586B\u5145\uFF0C\u4E5F\u5C31\u662FCustomMd5Realm.doGetAuthorizationInfo\u51FD\u6570\u4E2D\u9700\u8981\u63D0\u524D\u5C06\u5BF9\u5E94\u7684\u6743\u9650\u6216\u8005\u8D44\u6E90\u7ED9shiro</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u505A\u6388\u6743\u7684
 *
 * <span class="token keyword">@param</span> <span class="token parameter">principals</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8EAB\u4EFD\u4FE1\u606F\uFF1A&quot;</span> <span class="token operator">+</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// TODO \u6839\u636E\u8EAB\u4EFD\u4FE1\u606F\uFF0C\u4E5F\u5C31\u662F\u7528\u6237\u540D\uFF0C\u83B7\u53D6\u5F53\u524D\u7528\u6237\u7684\u89D2\u8272\u4FE1\u606F\uFF0C\u4EE5\u53CA\u6743\u9650\u4FE1\u606F</span>
    <span class="token comment">// \u6A21\u62DF\u4E00\u4E0B\u6570\u636E</span>
    <span class="token keyword">final</span> <span class="token class-name">SimpleAuthorizationInfo</span> authorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5C06\u6570\u636E\u5E93\u4E2D\u67E5\u8BE2\u7684\u89D2\u8272\u4FE1\u606F\u8D4B\u503C\u7ED9\u6743\u9650\u5BF9\u8C61</span>
    authorizationInfo<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    authorizationInfo<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">&quot;user:*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    authorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">&quot;product:update:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> authorizationInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u6388\u6743\u9A8C\u8BC1</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6D4B\u8BD5md5\u7684\u81EA\u5B9A\u4E49realm
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u521B\u5EFAsecurity manager</span>
    <span class="token keyword">final</span> <span class="token class-name">DefaultSecurityManager</span> defaultSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">CustomMd5Realm</span> md5Realm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomMd5Realm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6Erealm\u5728\u5339\u914D\u5BC6\u7801\u7684\u4F7F\u7528\u4F7F\u7528md5\u7684\u51ED\u8BC1\u5339\u914D\u5668</span>
    <span class="token keyword">final</span> <span class="token class-name">HashedCredentialsMatcher</span> credentialsMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;md5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    md5Realm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>credentialsMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>

    defaultSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>md5Realm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u4F7F\u7528\u81EA\u5B9A\u7684realm</span>

    <span class="token comment">// \u5C06\u5B89\u88C5\u5DE5\u5177\u7C7B\u4E2D\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5B89\u5168\u7BA1\u7406\u5668</span>
    <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
    <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span> <span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521B\u5EFAtoken\u4EE4\u724C</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u767B\u5F55\u6210\u529F~ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BA4\u8BC1\u72B6\u6001: &quot;</span> <span class="token operator">+</span> subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7528\u6237\u540D\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BC6\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u8BA4\u8BC1\u7528\u6237\u8FDB\u884C\u6388\u6743</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1. \u57FA\u4E8E\u89D2\u8272\u6743\u9650\u63A7\u5236</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u57FA\u4E8E\u591A\u89D2\u8272\u7684\u6743\u9650\u63A7\u5236</span>
        subject<span class="token punctuation">.</span><span class="token function">hasAllRoles</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u662F\u5426\u5177\u6709\u5176\u4E2D\u4E00\u4E2A\u89D2\u8272</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> booleans <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">hasRoles</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;super&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span> aBoolean <span class="token operator">:</span> booleans<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aBoolean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//2. \u57FA\u4E8E\u6743\u9650\u5B57\u7B26\u4E32\u7684\u8BBF\u95EE\u63A7\u5236 \u8D44\u6E90\u6807\u8BC6\u7B26:\u64CD\u4F5C\u7B26:\u8D44\u6E90\u7C7B\u578B</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;user:*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;product:*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5206\u522B\u5177\u6709\u90A3\u4E9B\u6743\u9650</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permitted <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;user:*:01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;product:*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span> b <span class="token operator">:</span> permitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u540C\u65F6\u5177\u6709\u90A3\u4E9B\u6743\u9650</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isPermittedAll</span><span class="token punctuation">(</span><span class="token string">&quot;user:*:01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;product:*:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6574\u5408\u5230springboot\u9879\u76EE"><a class="header-anchor" href="#\u6574\u5408\u5230springboot\u9879\u76EE" aria-hidden="true">#</a> \u6574\u5408\u5230springboot\u9879\u76EE</h2><h3 id="\u6574\u5408\u601D\u8DEF"><a class="header-anchor" href="#\u6574\u5408\u601D\u8DEF" aria-hidden="true">#</a> \u6574\u5408\u601D\u8DEF</h3><p><img src="`+v+`" alt=""></p><h3 id="\u6574\u5408\u6D41\u7A0B"><a class="header-anchor" href="#\u6574\u5408\u6D41\u7A0B" aria-hidden="true">#</a> \u6574\u5408\u6D41\u7A0B</h3><ol><li>\u521B\u5EFAspringboot\u9879\u76EE\uFF0C\u6DFB\u52A0spring-web\u4F9D\u8D56</li></ol><p>\u5E76\u5C06\u9879\u76EE\u4FEE\u6539\u6210\u652F\u6301jsp\u7684web\u9879\u76EE\uFF1A</p><p>pom\u4E2D\u5F15\u5165jsp\u4F9D\u8D56\u548Cjstl\u4F9D\u8D56</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--\u5F15\u5165jsp\u89E3\u6790\u4F9D\u8D56--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.embed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat-embed-jasper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728main\u76EE\u5F55\u521B\u5EFAwebapp\u76EE\u5F55\uFF0C\u5E76\u5728\u5728webapp\u4E2D\u521B\u5EFAindex.jsp\u6587\u4EF6\uFF0C\u901A\u8FC7<code>!</code>\u5FEB\u6377\u8F93\u5165jsp\u6587\u4EF6\u6A21\u677F</p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot;
          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    hello world
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&lt;%@page contentType=&quot;text/html; UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot; %&gt;</code>\u8BBE\u7F6Ejsp\u9875\u9762\u9632\u6B62\u4E71\u7801</p><p>application\u4E2D\u914D\u7F6Ejsp</p><ul><li><code>spring.mvc.view.prefix=/</code></li><li><code>spring.mvc.view.suffix=.jsp</code></li></ul><ol start="2"><li>\u5F15\u5165shiro\u4F9D\u8D56</li></ol><p>apache shiro\u7ED9\u6211\u4EEC\u63D0\u4F9B\u4E86springboot\u548Cshiro\u6574\u5408\u7684\u4F9D\u8D56</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--\u5F15\u5165shiro\u4F9D\u8D56--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u914D\u7F6Eshiro\u73AF\u5883"><a class="header-anchor" href="#\u914D\u7F6Eshiro\u73AF\u5883" aria-hidden="true">#</a> \u914D\u7F6Eshiro\u73AF\u5883</h4><p><img src="`+m+`" alt=""></p><ol><li>\u521B\u5EFA\u914D\u7F6E\u7C7B</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u7528\u6765\u6574\u5408shiro\u76F8\u5173\u7684\u914D\u7F6E\u7C7B
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u521B\u5EFAShiroFilter
     * \u8D1F\u8D23\u62E6\u622A\u6240\u6709\u7684\u8BF7\u6C42
     * \u901A\u8FC7\u5DE5\u5382\u7C7B\u6CE8\u5165 ShiroFilterFactoryBean\u5B9E\u73B0\u4E86FactoryBean
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">getShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">ShiroFilterFactoryBean</span> shiroFilterFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7ED9filter\u8BBE\u7F6E\u5B89\u5168\u7BA1\u7406\u5668</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultWebSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u914D\u7F6E\u7CFB\u7EDF\u7684\u53D7\u9650\u8D44\u6E90</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/index.jsp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// authc \u8BF7\u6C42\u8FD9\u4E2A\u8D44\u6E90\u9700\u8981\u8BA4\u8BC1\u548C\u6388\u6743\uFF0C\u5176\u5B9E\u5B83\u5C31\u662F\u4E00\u4E2Afilter</span>

        <span class="token comment">// \u9ED8\u8BA4\u7684\u8BA4\u8BC1\u754C\u9762\u7684\u8DEF\u5F84\uFF0C\u4E0D\u5199\u5C31\u662F/login.jsp</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u914D\u7F6E\u7CFB\u7EDF\u7684\u516C\u5171\u8D44\u6E90</span>

        <span class="token keyword">return</span> shiroFilterFactoryBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u521B\u5EFA\u5B89\u5168\u7BA1\u7406\u5668 SecurityManager
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">getDefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token class-name">Realm</span> realm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7ED9\u5B89\u5168\u7BA1\u7406\u5668\u8BBE\u7F6Erealm</span>
        defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>realm<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> defaultWebSecurityManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u521B\u5EFA\u81EA\u5B9A\u4E49\u7684realm
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span> <span class="token comment">// \u56E0\u4E3Aspring\u5BB9\u5668\u4E2D\u6709\u591A\u4E2Arealm\uFF0C\u6240\u4EE5\u8BBE\u7F6E\u4E00\u4E0B\u4F18\u5148\u7EA7</span>
    <span class="token keyword">public</span> <span class="token class-name">Realm</span> <span class="token function">getRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">CustomRealm</span> customRealm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> customRealm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u5E38\u89C1\u7684\u8FC7\u6EE4\u5668"><a class="header-anchor" href="#\u5E38\u89C1\u7684\u8FC7\u6EE4\u5668" aria-hidden="true">#</a> \u5E38\u89C1\u7684\u8FC7\u6EE4\u5668</h4><p>shiro\u63D0\u4F9B\u4E86\u591A\u4E2A\u9ED8\u8BA4\u7684\u8FC7\u6EE4\u5668\uFF0C\u6211\u4EEC\u53EF\u4EE5\u7528\u8FD9\u4E9B\u8FC7\u6EE4\u5668\u6765\u914D\u7F6E\u63A7\u5236\u6307\u5B9A\u7684url\u7684\u6743\u9650</p><p><img src="`+b+`" alt=""></p><h4 id="shiro\u8BA4\u8BC1\u548C\u9000\u51FA"><a class="header-anchor" href="#shiro\u8BA4\u8BC1\u548C\u9000\u51FA" aria-hidden="true">#</a> shiro\u8BA4\u8BC1\u548C\u9000\u51FA</h4><p>\u81EA\u5B9A\u4E49realm</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49realm
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u8BA4\u8BC1
     *
     * <span class="token keyword">@param</span> <span class="token parameter">token</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">AuthenticationException</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>

        <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>principal<span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u9000\u51FA\u767B\u5F55
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/login.jsp&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u7528\u6765\u5904\u7406\u8EAB\u4EFD\u8BA4\u8BC1
     * \u8FD9\u91CC\u7684\u8BA4\u8BC1\u65B9\u5F0F\u662F\u8981\u4F7F\u7528shiro\u8BA4\u8BC1\u65B9\u5F0F
     *
     * <span class="token keyword">@param</span> <span class="token parameter">username</span>
     * <span class="token keyword">@param</span> <span class="token parameter">password</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
        <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;redirect:/index.jsp&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7528\u6237\u540D\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5BC6\u7801\u9519\u8BEF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/login.jsp&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;%@page contentType=&quot;text/html; UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot;
          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;\u7528\u6237\u767B\u5F55&lt;/h1&gt;
&lt;form action=&quot;\${pageContext.request.contextPath}/user/login&quot; method=&quot;post&quot;&gt;
    \u7528\u6237\u540D\uFF1A&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;
    \u5BC6\u7801\uFF1A&lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; value=&quot;\u767B\u5F55&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>index.jsp\u4E2D\u589E\u52A0\u9000\u51FA\u8BF7\u6C42</p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;a href=&quot;\${pageContext.request.contextPath}/user/logout&quot;&gt;\u9000\u51FA\u767B\u5F55&lt;/a&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u7528\u6765\u6574\u5408shiro\u76F8\u5173\u7684\u914D\u7F6E\u7C7B
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u521B\u5EFAShiroFilter
     * \u8D1F\u8D23\u62E6\u622A\u6240\u6709\u7684\u8BF7\u6C42
     * \u901A\u8FC7\u5DE5\u5382\u7C7B\u6CE8\u5165 ShiroFilterFactoryBean\u5B9E\u73B0\u4E86FactoryBean
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">getShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">ShiroFilterFactoryBean</span> shiroFilterFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7ED9filter\u8BBE\u7F6E\u5B89\u5168\u7BA1\u7406\u5668</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>defaultWebSecurityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u914D\u7F6E\u7CFB\u7EDF\u7684\u53D7\u9650\u8D44\u6E90</span>
        <span class="token comment">// \u914D\u7F6E\u7CFB\u7EDF\u7684\u516C\u5171\u8D44\u6E90</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//map.put(&quot;/index.jsp&quot;, &quot;authc&quot;);// authc \u8BF7\u6C42\u8FD9\u4E2A\u8D44\u6E90\u9700\u8981\u8BA4\u8BC1\u548C\u6388\u6743\uFF0C\u5176\u5B9E\u5B83\u5C31\u662F\u4E00\u4E2Afilter</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8BBE\u7F6E\u4E3A\u516C\u5171\u8D44\u6E90</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;authc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8868\u793A\u6240\u6709\u7684\u8D44\u6E90\u90FD\u9700\u8981\u8BA4\u8BC1\u548C\u6388\u6743</span>

        <span class="token comment">// \u9ED8\u8BA4\u7684\u8BA4\u8BC1\u754C\u9762\u7684\u8DEF\u5F84\uFF0C\u4E0D\u5199\u5C31\u662F/login.jsp</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/login.jsp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shiroFilterFactoryBean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> shiroFilterFactoryBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u521B\u5EFA\u5B89\u5168\u7BA1\u7406\u5668 SecurityManager
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultWebSecurityManager</span> <span class="token function">getDefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token class-name">Realm</span> realm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">DefaultWebSecurityManager</span> defaultWebSecurityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7ED9\u5B89\u5168\u7BA1\u7406\u5668\u8BBE\u7F6Erealm</span>
        defaultWebSecurityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>realm<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> defaultWebSecurityManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u521B\u5EFA\u81EA\u5B9A\u4E49\u7684realm
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span> <span class="token comment">// \u56E0\u4E3Aspring\u5BB9\u5668\u4E2D\u6709\u591A\u4E2Arealm\uFF0C\u6240\u4EE5\u8BBE\u7F6E\u4E00\u4E0B\u4F18\u5148\u7EA7</span>
    <span class="token keyword">public</span> <span class="token class-name">Realm</span> <span class="token function">getRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">CustomRealm</span> customRealm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> customRealm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shiro\u8FDE\u63A5\u6570\u636E\u5E93-\u5B8C\u6210\u57FA\u4E8Emd5-salt\u7684\u6CE8\u518C\u529F\u80FD"><a class="header-anchor" href="#shiro\u8FDE\u63A5\u6570\u636E\u5E93-\u5B8C\u6210\u57FA\u4E8Emd5-salt\u7684\u6CE8\u518C\u529F\u80FD" aria-hidden="true">#</a> shiro\u8FDE\u63A5\u6570\u636E\u5E93+\u5B8C\u6210\u57FA\u4E8EMD5+salt\u7684\u6CE8\u518C\u529F\u80FD</h3><ol><li>\u521B\u5EFAregister.jsp\u9875\u9762</li></ol><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;%@page contentType=&quot;text/html; UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot;
          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;\u7528\u6237\u6CE8\u518C&lt;/h1&gt;
&lt;form action=&quot;\${pageContext.request.contextPath}/user/register&quot; method=&quot;post&quot;&gt;
    \u7528\u6237\u540D\uFF1A&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;
    \u5BC6\u7801\uFF1A&lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; value=&quot;\u7ACB\u5373\u6CE8\u518C&quot;&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u6DFB\u52A0mybatis\u3001mysql\u548Cdruid\u4F9D\u8D56</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--mysql--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--mybatis--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--druid--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u914D\u7F6E\u6570\u636E\u5E93\u548Cmybatis\u4FE1\u606F</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/springboot-shiro-jsp-demo?characterEncoding=UTF-8
spring.datasource.username=root
spring.datasource.password=123456

mybatis.type-aliases-package=com.example.shiro.db.pojo
mybatis.mapper-locations=classpath:mapper/*.xml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>\u521B\u5EFA\u5BF9\u5E94\u7684\u6570\u636E\u5E93\u548C\u8868</li></ol><p><img src="`+g+`" alt=""></p><ol start="5"><li><p>\u901A\u8FC7idea\u7684\u63D2\u4EF6mybatis-plus\u9006\u5411\u751F\u6210mybatis\u4E09\u4EF6\u5957\uFF1ATUserDao\u63A5\u53E3\u3001TUser\u5B9E\u4F53\u7C7B\u3001TUserDao.xml\u6620\u5C04\u6587\u4EF6</p></li><li><p>\u521B\u5EFAUserService\u548CUserServiceImpl</p></li></ol><p>\u7ED9\u51FAUserServiceImpl</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TUserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">TUser</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u660E\u6587\u5BC6\u7801\u8FDB\u884Cmd5+salt+hash\u6563\u5217</span>
        <span class="token class-name">String</span> salt <span class="token operator">=</span> <span class="token class-name">SaltUtil</span><span class="token punctuation">.</span><span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Md5Hash</span> md5Hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Md5Hash</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5C06\u968F\u673A\u76D0\u4FDD\u5B58\u5230\u6570\u636E\u5E93</span>
        user<span class="token punctuation">.</span><span class="token function">setSalt</span><span class="token punctuation">(</span>salt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>md5Hash<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4FDD\u5B58\u5230\u6570\u636E\u5E93</span>
        userDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>SaltUtil\u968F\u673A\u76D0\u5DE5\u5177\u7C7B</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaltUtil</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u751F\u6210salt\u7684\u9759\u6001\u65B9\u6CD5
     *
     * <span class="token keyword">@param</span> <span class="token parameter">n</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()_&quot;</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">char</span> c <span class="token operator">=</span> chars<span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>chars<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="8"><li>UserController\u4E2D\u521B\u5EFA\u6CE8\u518C\u65B9\u6CD5</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u7528\u6237\u6CE8\u518C
 *
 * <span class="token keyword">@param</span> <span class="token parameter">user</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">TUser</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/login.jsp&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        exception<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/register.jsp&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shiro\u8FDE\u63A5\u6570\u636E\u5E93-\u5B8C\u6210\u57FA\u4E8Emd5-salt\u7684\u8BA4\u8BC1\u529F\u80FD"><a class="header-anchor" href="#shiro\u8FDE\u63A5\u6570\u636E\u5E93-\u5B8C\u6210\u57FA\u4E8Emd5-salt\u7684\u8BA4\u8BC1\u529F\u80FD" aria-hidden="true">#</a> shiro\u8FDE\u63A5\u6570\u636E\u5E93+\u5B8C\u6210\u57FA\u4E8EMD5+salt\u7684\u8BA4\u8BC1\u529F\u80FD</h3><ol><li>\u5982\u679C\u60F3\u8981\u5728CustomRealm\u4E2D\u5B9E\u73B0\u8BA4\u8BC1\u529F\u80FD\uFF0C\u5C31\u9700\u8981\u901A\u8FC7\u7528\u6237\u540D\u67E5\u8BE2\u5230\u5BF9\u5E94\u7684\u7528\u6237\u4FE1\u606F</li></ol><p>\u6240\u4EE5\u6211\u4EEC\u663E\u521B\u5EFA\u67E5\u8BE2\u64CD\u4F5C</p><p>TUserDao.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findByUsername<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.shiro.db.pojo.TUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
select * from t_user where username=#{username}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TUserDao.java</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TUser</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>UserServiceImpl.java</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">TUser</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> userDao<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u7F16\u5199\u8BA4\u8BC1\u65B9\u6CD5\uFF0C\u901A\u8FC7\u4E0A\u9762\u7684\u67E5\u8BE2\u64CD\u4F5C\u6765\u83B7\u53D6\u5230\u6570\u636E\u5E93\u4E2D\u5BF9\u5E94\u7684\u7528\u6237\u4FE1\u606F</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8BA4\u8BC1
 *
 * <span class="token keyword">@param</span> <span class="token parameter">token</span>
 * <span class="token keyword">@return</span>
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">AuthenticationException</span></span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>

    <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5728spring\u5DE5\u5382\u4E2D\u83B7\u53D6\u5230\u6307\u5B9A\u7684\u5BF9\u8C61 userService</span>
    <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> <span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">TUser</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ByteSource<span class="token punctuation">.</span>Util</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D\uFF0CApplicationContextUtil\u662F\u4E3A\u4E86\u80FD\u83B7\u53D6\u5230\u6CE8\u5165\u5230spring\u5BB9\u5668\u4E2D\u7684UserService</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * spring application context \u5DE5\u5177\u7C7B\uFF0C\u4E3B\u8981\u4E3A\u4E86\u8BA9\u4E0D\u518Dspring\u5BB9\u5668\u4E2D\u7684\u5BF9\u8C61\u80FD\u83B7\u53D6\u5230\u5DF2\u7ECF\u6CE8\u5165\u5230spring \u5BB9\u5668\u4E2D\u7684\u4E2D\u7684bean\u5BF9\u8C61
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * \u5E94\u8BE5\u662F\u4F7F\u7528\u4E86spring\u6269\u5C55\u70B9\uFF0C\u5F53ApplicaitonContext\u521B\u5EFA\u4E4B\u540E\u56DE\u8C03\u5230\u8FD9\u91CC\u7ED9\u6211\u4EEC
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextUtil</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ApplicationContext</span> context<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u6839\u636Ebean\u7684\u540D\u5B57\u83B7\u53D6\u5230spring\u5BB9\u5668\u4E2D\u5BF9\u5E94\u7684bean
     *
     * <span class="token keyword">@param</span> <span class="token parameter">beanName</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u914D\u7F6EShiroConfig\u7684getRealm\uFF0C\u8BA9\u5B83\u80FD\u4F7F\u7528md5\u52A0\u5BC6\u8FDB\u884C\u5BC6\u7801\u5339\u914D</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u521B\u5EFA\u81EA\u5B9A\u4E49\u7684realm
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span> <span class="token comment">// \u56E0\u4E3Aspring\u5BB9\u5668\u4E2D\u6709\u591A\u4E2Arealm\uFF0C\u6240\u4EE5\u8BBE\u7F6E\u4E00\u4E0B\u4F18\u5148\u7EA7</span>
<span class="token keyword">public</span> <span class="token class-name">Realm</span> <span class="token function">getRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">CustomRealm</span> customRealm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u4FEE\u6539\u9ED8\u8BA4\u7684\u51ED\u8BC1\uFF08\u5BC6\u7801\uFF09\u5339\u914D\u5668</span>
    <span class="token keyword">final</span> <span class="token class-name">HashedCredentialsMatcher</span> credentialsMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8BBE\u7F6E\u52A0\u5BC6\u4E3Amd5\u7B97\u6CD5</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>credentialsMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> customRealm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shiro\u6388\u6743\u7684\u57FA\u672C\u4F7F\u7528"><a class="header-anchor" href="#shiro\u6388\u6743\u7684\u57FA\u672C\u4F7F\u7528" aria-hidden="true">#</a> shiro\u6388\u6743\u7684\u57FA\u672C\u4F7F\u7528</h3><h4 id="\u5728jsp\u9875\u9762\u4E2D\u505A\u6743\u9650\u63A7\u5236"><a class="header-anchor" href="#\u5728jsp\u9875\u9762\u4E2D\u505A\u6743\u9650\u63A7\u5236" aria-hidden="true">#</a> \u5728jsp\u9875\u9762\u4E2D\u505A\u6743\u9650\u63A7\u5236</h4><p>\u505A\u83DC\u5355\u7B49\u5E26\u6709\u6743\u9650\u8272\u5F69\u7684\u5C55\u793A\u4E0E\u5426</p><p>\u4E4B\u524D\u6709\u8BF4\u8FC7\u5982\u679C\u60F3\u8981\u81EA\u5B9A\u4E49\u6388\u6743\uFF0C\u5C31\u9700\u8981\u5728CustomRealm\u4E2D\u5B9E\u73B0doGetAuthorizationInfo</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5148\u6A21\u62DF\u5047\u6570\u636E</span>
    <span class="token comment">// \u83B7\u53D6\u8EAB\u4EFD\u4FE1\u606F</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6839\u636E\u4E3B\u8EAB\u4EFD\u4FE1\u606F\u83B7\u53D6\u5B83\u7684\u89D2\u8272\u4FE1\u606F \u548C \u6743\u9650\u4FE1\u606F</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">SimpleAuthorizationInfo</span> simpleAuthorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleAuthorizationInfo<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> simpleAuthorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+h+`" alt=""></p><p>\u5047\u8BBEadmin\u53EF\u4EE5\u770B\u5230\u6240\u6709\u7684\u83DC\u5355\uFF0Cuser\u53EA\u80FD\u770B\u5230\u7528\u6237\u7BA1\u7406\uFF0C\u90A3\u4E48\u5C31\u8981\u5728\u9875\u9762\u4E0A\u8FDB\u884C\u6743\u9650\u63A7\u5236\uFF0C\u4F7F\u7528shiro\u4E3A\u6211\u4EEC\u63D0\u4F9B\u7684\u6807\u7B7E</p><p>\u9700\u8981\u5148\u5F15\u5165\u6807\u7B7E</p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;%@taglib prefix=&quot;shiro&quot; uri=&quot;http://shiro.apache.org/tags&quot; %&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+y+`" alt=""></p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u7528\u6237\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
    &lt;%--\u53EA\u6709admin\u6743\u9650\u7684\u7528\u6237\u624D\u80FD\u770B\u89C1--%&gt;
    &lt;shiro:hasRole name=&quot;admin&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u5546\u54C1\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u8BA2\u5355\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u7269\u6D41\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
    &lt;/shiro:hasRole&gt;
&lt;/ul&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u591A\u4E2A\u89D2\u8272\u53EF\u89C1\uFF0C\u4F7F\u7528\u9017\u53F7\u9694\u5F00</p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;shiro:hasAnyRoles name=&quot;user,admin&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u7528\u6237\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
&lt;/shiro:hasAnyRoles&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u8D44\u6E90\uFF08\u6743\u9650\uFF09\u9650\u5B9A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>simpleAuthorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span><span class="token string">&quot;user:update:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6BD4\u5982\uFF0C\u7528\u6237\u7BA1\u7406\u4E2D\u6709\u589E\u5220\u6539\u67E5\u6743\u9650</p><p><img src="`+w+`" alt=""></p><p>\u8FD9\u4E2A\u65F6\u5019\u5C31\u53EF\u4EE5\u4F7F\u7528<code>shiro:hasPermission</code>\u6765\u9650\u5B9A</p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;ul&gt;
    &lt;shiro:hasPermission name=&quot;user:add:*&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u6DFB\u52A0\u7528\u6237&lt;/a&gt;&lt;/li&gt;
    &lt;/shiro:hasPermission&gt;
    &lt;shiro:hasPermission name=&quot;user:delete:*&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u5220\u9664\u7528\u6237&lt;/a&gt;&lt;/li&gt;
    &lt;/shiro:hasPermission&gt;
    &lt;shiro:hasPermission name=&quot;user:update:*&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u4FEE\u6539\u7528\u6237&lt;/a&gt;&lt;/li&gt;
    &lt;/shiro:hasPermission&gt;
    &lt;shiro:hasPermission name=&quot;user:select:*&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u67E5\u8BE2\u7528\u6237&lt;/a&gt;&lt;/li&gt;
    &lt;/shiro:hasPermission&gt;
&lt;/ul&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u65F6\u5019\u53EA\u80FD\u505A\u66F4\u65B0\u64CD\u4F5C</p><p><img src="`+f+`" alt=""></p><h4 id="\u5728\u4EE3\u7801\u4E2D\u5B8C\u6210\u6743\u9650\u63A7\u5236"><a class="header-anchor" href="#\u5728\u4EE3\u7801\u4E2D\u5B8C\u6210\u6743\u9650\u63A7\u5236" aria-hidden="true">#</a> \u5728\u4EE3\u7801\u4E2D\u5B8C\u6210\u6743\u9650\u63A7\u5236</h4><p>\u6BD4\u5982\u5BF9\u8BA2\u5355\u7BA1\u7406\u7684\u63A7\u5236\uFF0COrderController\uFF0C\u4E3B\u8981\u662F\u4E3A\u4E86\u9632\u6B62\u7528\u6237\u901A\u8FC7\u6D4F\u89C8\u5668\u8F93\u5165\u8FDE\u63A5\u5730\u5740\u8BBF\u95EE</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/save&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4E1A\u52A1\u5904\u7406</span>

        <span class="token comment">// .......</span>

        <span class="token comment">// \u4EE3\u7801\u7684\u65B9\u5F0F\u8FDB\u884C\u6388\u6743</span>
        <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
        <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u57FA\u4E8E\u89D2\u8272\u7684</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FDD\u5B58\u8BA2\u5355&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u65E0\u6743\u8BBF\u95EE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u57FA\u4E8E\u6743\u9650\uFF08\u8D44\u6E90\uFF09</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;order:save:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FDD\u5B58\u8BA2\u5355&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u65E0\u6743\u8BBF\u95EE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">&quot;redirect:/index.jsp&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u4F7F\u7528\u6CE8\u89E3\u65B9\u5F0F\u505A\u6388\u6743"><a class="header-anchor" href="#\u4F7F\u7528\u6CE8\u89E3\u65B9\u5F0F\u505A\u6388\u6743" aria-hidden="true">#</a> \u4F7F\u7528\u6CE8\u89E3\u65B9\u5F0F\u505A\u6388\u6743</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/save&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//@RequiresRoles(&quot;admin&quot;) // \u5FC5\u987B\u8981\u6709admin\u6743\u9650</span>
<span class="token annotation punctuation">@RequiresRoles</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// \u5FC5\u987B\u8981\u540C\u65F6\u6709admin\u548Cuser\u6743\u9650</span>
<span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;order:save:*&quot;</span><span class="token punctuation">)</span><span class="token comment">// \u7528\u6765\u5224\u65AD\u6743\u9650\u5B57\u7B26\u4E32</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4E1A\u52A1\u5904\u7406</span>

    <span class="token comment">// .......</span>

    <span class="token comment">// \u4EE3\u7801\u7684\u65B9\u5F0F\u8FDB\u884C\u6388\u6743</span>
    <span class="token comment">// \u83B7\u53D6\u4E3B\u4F53\u5BF9\u8C61</span>
    <span class="token keyword">final</span> <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u57FA\u4E8E\u89D2\u8272\u7684</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FDD\u5B58\u8BA2\u5355&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u65E0\u6743\u8BBF\u95EE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u57FA\u4E8E\u6743\u9650\uFF08\u8D44\u6E90\uFF09</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">&quot;order:save:*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FDD\u5B58\u8BA2\u5355&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u65E0\u6743\u8BBF\u95EE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token string">&quot;redirect:/index.jsp&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shiro\u6388\u6743\u7684\u6570\u636E\u4ECE\u6570\u636E\u5E93\u83B7\u53D6-\u89D2\u8272"><a class="header-anchor" href="#shiro\u6388\u6743\u7684\u6570\u636E\u4ECE\u6570\u636E\u5E93\u83B7\u53D6-\u89D2\u8272" aria-hidden="true">#</a> shiro\u6388\u6743\u7684\u6570\u636E\u4ECE\u6570\u636E\u5E93\u83B7\u53D6-\u89D2\u8272</h3><ol><li>\u521B\u5EFA\u6570\u636E\u5E93\u89D2\u8272\u8868\u548C\u6743\u9650\u8868</li></ol><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u6709\u51E0\u79CD\u6A21\u5F0F</p><ul><li>\u7528\u6237\u548C\u89D2\u8272\u7ED1\u5B9A\uFF0C\u89D2\u8272\u548C\u6743\u9650\uFF08\u8D44\u6E90URL\uFF09\u7ED1\u5B9A</li><li>\u53EA\u6709\u7528\u6237\u89D2\u8272</li><li>\u7528\u6237\u548C\u6743\u9650\u5B57\u7B26\u4E32</li></ul><p>\u4E00\u822C\u5728\u505Aweb\u5E94\u7528\u7684\u65F6\u5019\uFF0C\u90FD\u662F\u7528\u6237\u4F5C\u4E3A\u67D0\u4E2A\u89D2\u8272\uFF0C\u89D2\u8272\u6301\u6709\u67D0\u4E9B\u6743\u9650</p><p>\u7528\u6237 * ------- * \u89D2\u8272 * ------- * \u6743\u9650</p><p><img src="`+q+'" alt=""></p><p><img src="'+S+`" alt=""></p><p>\u5BF9\u5E94\u7684sql\u521B\u5EFA\u8BED\u53E5</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*
 Navicat Premium Data Transfer

 Source Server         : 127.0.0.1.3306
 Source Server Type    : MySQL
 Source Server Version : 50729
 Source Host           : localhost:3306
 Source Schema         : springboot-shiro-jsp-demo

 Target Server Type    : MySQL
 Target Server Version : 50729
 File Encoding         : 65001

 Date: 06/12/2021 20:18:25
*/</span>

<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_presmission</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_presmission<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_presmission<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>url<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_role_persmission</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_persmission<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_persmission<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>presmission_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>salt<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6DFB\u52A0\u5BF9\u5E94\u7528\u6237\u548C\u89D2\u8272\u7684\u5BF9\u5E94</p><p>zhangsan - admin lisi - user lisi - productor</p><p><img src="`+A+`" alt=""></p><p>TRoleDao\u4E2D\u67E5\u8BE2\u7528\u6237\u6743\u9650</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u67E5\u8BE2\u6240\u6709\u89D2\u8272</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TRole</span><span class="token punctuation">&gt;</span></span> <span class="token function">findRoleByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findRoleByUsername<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.shiro.db.pojo.TRole<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
SELECT
  t_role.id,
  t_role.\`name\`
FROM
  t_user
    LEFT JOIN t_user_role ON t_user.id = t_user_role.user_id
    LEFT JOIN t_role ON t_user_role.role_id = t_role.id
WHERE
  t_user.username = #{username};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CustomRealm\u4E2D\u7F16\u5199\u6388\u6743\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5148\u6A21\u62DF\u5047\u6570\u636E</span>
    <span class="token comment">// \u83B7\u53D6\u8EAB\u4EFD\u4FE1\u606F</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6839\u636E\u4E3B\u8EAB\u4EFD\u4FE1\u606F\u83B7\u53D6\u5B83\u7684\u89D2\u8272\u4FE1\u606F \u548C \u6743\u9650\u4FE1\u606F</span>
    <span class="token keyword">final</span> <span class="token class-name">RoleService</span> roleService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RoleService</span><span class="token punctuation">)</span><span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;roleService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TRole</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">findRoleByUsername</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6388\u6743\u89D2\u8272\u4FE1\u606F</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">SimpleAuthorizationInfo</span> simpleAuthorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleAuthorizationInfo<span class="token punctuation">.</span><span class="token function">addRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">TRole</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> simpleAuthorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shiro\u6388\u6743\u7684\u6570\u636E\u4ECE\u6570\u636E\u5E93\u83B7\u53D6-\u6743\u9650"><a class="header-anchor" href="#shiro\u6388\u6743\u7684\u6570\u636E\u4ECE\u6570\u636E\u5E93\u83B7\u53D6-\u6743\u9650" aria-hidden="true">#</a> shiro\u6388\u6743\u7684\u6570\u636E\u4ECE\u6570\u636E\u5E93\u83B7\u53D6-\u6743\u9650</h3><h4 id="\u6570\u636E\u5E93\u8BBE\u8BA1"><a class="header-anchor" href="#\u6570\u636E\u5E93\u8BBE\u8BA1" aria-hidden="true">#</a> \u6570\u636E\u5E93\u8BBE\u8BA1</h4><p>\u5B58\u5728\u4E24\u4E2A\u8D26\u53F7\uFF1Azhangsan \u548C lisi\uFF0C\u5176\u4E2Dzhangsan\u662Fadmin\u89D2\u8272\uFF0C\u8FD9\u4E2A\u89D2\u8272\u62E5\u6709\u6240\u6709\u7684\u6743\u9650\uFF1A\u7528\u6237\u7BA1\u7406\u3001\u5546\u54C1\u7BA1\u7406\u3001\u8BA2\u5355\u7BA1\u7406\u3001\u7269\u6D41\u7BA1\u7406\u4E0B\u7684\u589E\u5220\u6539\u67E5\u64CD\u4F5C\uFF1Blisi\u662Fuser\u89D2\u8272\uFF0C\u8FD9\u4E2A\u89D2\u8272\u62E5\u6709\u7528\u6237\u7BA1\u7406\u4E0B\u7684\u67E5\u8BE2\u64CD\u4F5C</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*
 Navicat Premium Data Transfer

 Source Server         : 127.0.0.1.3306
 Source Server Type    : MySQL
 Source Server Version : 50729
 Source Host           : localhost:3306
 Source Schema         : springboot-shiro-jsp-demo

 Target Server Type    : MySQL
 Target Server Version : 50729
 File Encoding         : 65001

 Date: 06/12/2021 21:55:44
*/</span>

<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_permission</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_permission<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_permission<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>url<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of t_permission</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;user:add&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;user:update&#39;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;user:delete&#39;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&#39;user:select&#39;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of t_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_role_permission</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>premission_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of t_role_permission</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_role_permission<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>salt<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of t_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;zhangsan&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;7514a6557cbe65d41dd878461ec1a3cc&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;R(65KlL%&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;lisi&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;4587b203cc7e841bb73eba4b4b90ab11&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;DS3RWLuo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user_role<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>role_id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of t_user_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user_role<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user_role<span class="token punctuation">\`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u83B7\u53D6\u6570\u636E\u5E93\u7684Permission\u7684\u4FE1\u606F</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>findPermissionByRoleId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>integer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.example.shiro.db.pojo.TPermission<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
SELECT
  t_permission.id,
  t_permission.\`name\`
FROM
  t_role
    LEFT JOIN t_role_permission ON t_role.id = t_role_permission.role_id
    LEFT JOIN t_permission ON t_role_permission.premission_id = t_permission.id
WHERE
  t_role.id = #{roleId};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PermissionServiceImpl</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;permissionService&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PermissionService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TPermissionDao</span> permissionDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TPermission</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPermissionByRoleId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> roleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> permissionDao<span class="token punctuation">.</span><span class="token function">findPermissionByRoleId</span><span class="token punctuation">(</span>roleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CustomRealm.doGetAuthorizationInfo\u51FD\u6570</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5148\u6A21\u62DF\u5047\u6570\u636E</span>
    <span class="token comment">// \u83B7\u53D6\u8EAB\u4EFD\u4FE1\u606F</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> principal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> principals<span class="token punctuation">.</span><span class="token function">getPrimaryPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6839\u636E\u4E3B\u8EAB\u4EFD\u4FE1\u606F\u83B7\u53D6\u5B83\u7684\u89D2\u8272\u4FE1\u606F \u548C \u6743\u9650\u4FE1\u606F</span>
    <span class="token keyword">final</span> <span class="token class-name">RoleService</span> roleService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RoleService</span><span class="token punctuation">)</span><span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;roleService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">PermissionService</span> permissionService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PermissionService</span><span class="token punctuation">)</span><span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;permissionService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TRole</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> roleService<span class="token punctuation">.</span><span class="token function">findRoleByUsername</span><span class="token punctuation">(</span>principal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6388\u6743\u89D2\u8272\u4FE1\u606F</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">SimpleAuthorizationInfo</span> simpleAuthorizationInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        roles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>one<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            simpleAuthorizationInfo<span class="token punctuation">.</span><span class="token function">addRole</span><span class="token punctuation">(</span>one<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u6839\u636E\u4E3B\u8EAB\u4EFD\u4FE1\u606F\u83B7\u53D6\u5B83\u7684\u89D2\u8272\u4FE1\u606F \u548C \u6743\u9650\u4FE1\u606F</span>
            <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TPermission</span><span class="token punctuation">&gt;</span></span> permissions <span class="token operator">=</span> permissionService<span class="token punctuation">.</span><span class="token function">findPermissionByRoleId</span><span class="token punctuation">(</span>one<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// \u6388\u6743\u89D2\u8272\u4FE1\u606F</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                simpleAuthorizationInfo<span class="token punctuation">.</span><span class="token function">addStringPermissions</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">TPermission</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> simpleAuthorizationInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>index.jsp</p><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;%@page contentType=&quot;text/html; UTF-8&quot; pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;%@taglib prefix=&quot;shiro&quot; uri=&quot;http://shiro.apache.org/tags&quot; %&gt;
&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot;
          content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;\u7CFB\u7EDF\u4E3B\u9875 v1.0&lt;/h1&gt;
&lt;a href=&quot;\${pageContext.request.contextPath}/user/logout&quot;&gt;\u9000\u51FA\u767B\u5F55&lt;/a&gt;
&lt;ul&gt;
    &lt;shiro:hasAnyRoles name=&quot;user,admin&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u7528\u6237\u7BA1\u7406&lt;/a&gt;
            &lt;ul&gt;
                &lt;shiro:hasPermission name=&quot;user:add:*&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u6DFB\u52A0\u7528\u6237&lt;/a&gt;&lt;/li&gt;
                &lt;/shiro:hasPermission&gt;
                &lt;shiro:hasPermission name=&quot;user:delete:*&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u5220\u9664\u7528\u6237&lt;/a&gt;&lt;/li&gt;
                &lt;/shiro:hasPermission&gt;
                &lt;shiro:hasPermission name=&quot;user:update:*&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u4FEE\u6539\u7528\u6237&lt;/a&gt;&lt;/li&gt;
                &lt;/shiro:hasPermission&gt;
                &lt;shiro:hasPermission name=&quot;user:select:*&quot;&gt;
                    &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u67E5\u8BE2\u7528\u6237&lt;/a&gt;&lt;/li&gt;
                &lt;/shiro:hasPermission&gt;
            &lt;/ul&gt;
        &lt;/li&gt;
    &lt;/shiro:hasAnyRoles&gt;
    &lt;%--\u53EA\u6709admin\u6743\u9650\u7684\u7528\u6237\u624D\u80FD\u770B\u89C1--%&gt;
    &lt;shiro:hasRole name=&quot;admin&quot;&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u5546\u54C1\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u8BA2\u5355\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;&quot;&gt;\u7269\u6D41\u7BA1\u7406&lt;/a&gt;&lt;/li&gt;
    &lt;/shiro:hasRole&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>zhangsan\u767B\u5F55</p><p><img src="`+j+'" alt=""></p><p>lisi\u767B\u5F55</p><p><img src="'+T+'" alt=""></p><h3 id="shiro\u7F13\u5B58"><a class="header-anchor" href="#shiro\u7F13\u5B58" aria-hidden="true">#</a> shiro\u7F13\u5B58</h3><p>\u5982\u679C\u6211\u4EEC\u8981\u5728\u9875\u9762\u4E2D\u505A\u6743\u9650\u5224\u65AD\u7684\u8BDD\uFF0C\u5C31\u9700\u8981\u5728\u9875\u9762\u4E2D\u7F16\u5199\u5927\u91CF\u7684\u6743\u9650\u5224\u65AD</p><p>\u5E76\u4E14\u8FD8\u9700\u8981\u5728Controller\u4E2D\u6DFB\u52A0\u76F8\u5E94\u7684\u6CE8\u89E3</p><p>\u8FD9\u91CC\u5C31\u4F1A\u53D1\u73B0\u4E00\u4E9B\u95EE\u9898\uFF0C\u6BCF\u4E00\u6B21\u5728\u5237\u65B0\u9875\u9762\u7684\u65F6\u5019\uFF0C\u90FD\u9700\u8981\u91CD\u65B0\u8BBF\u95EE\u6570\u636E\u5E93\uFF0C\u4F46\u662F\u4E00\u4E2A\u7528\u6237\u6743\u9650\u6570\u636E\u5267\u672C\u4E0A\u662F\u4E0D\u600E\u4E48\u4F1A\u53D8\u5316\u7684\uFF0C\u6240\u4EE5\u5BF9\u4E8E\u6743\u9650\u6765\u8BF4\uFF0C\u4E0D\u80FD\u6BCF\u505A\u4E00\u6B21\u6821\u9A8C\u5C31\u505A\u4E00\u6B21\u6570\u636E\u5E93\u67E5\u8BE2\uFF0C\u5BF9\u4E8E\u6570\u636E\u5E93\u7684\u538B\u529B\u4E0D\u5C0F</p><p>\u4E3A\u4E86\u907F\u514D\u8FD9\u4E9B\u95EE\u9898\uFF0C\u6211\u4EEC\u4E00\u822C\u90FD\u4F1A\u7ED9\u6743\u9650\u52A0\u7F13\u5B58\u3002\u4E5F\u5C31\u662F\u4E00\u65E6\u8FD9\u4E2A\u7528\u6237\u5DF2\u7ECF\u6388\u6743\u8FC7\u4E00\u6B21\u4E86\uFF0C\u5C31\u6743\u9650\u6570\u636E\u7F13\u5B58\u8D77\u6765</p><p>\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528CacheManager\u5B9E\u73B0\u7F13\u5B58</p><p><img src="'+E+`" alt=""></p><h4 id="\u4F7F\u7528ehcache\u5B9E\u73B0\u7F13\u5B58"><a class="header-anchor" href="#\u4F7F\u7528ehcache\u5B9E\u73B0\u7F13\u5B58" aria-hidden="true">#</a> \u4F7F\u7528EhCache\u5B9E\u73B0\u7F13\u5B58</h4><ol><li>\u5F15\u5165\u4F9D\u8D56</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u5F00\u542F\u7F13\u5B58</li></ol><p>\u65E2\u7136\u662Frealm\u67E5\u8BE2\u7684\u6570\u636E\uFF0C\u5F53\u7136\u662F\u8981\u5728realm\u4E2D\u5F00\u542F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u521B\u5EFA\u81EA\u5B9A\u4E49\u7684realm
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span> <span class="token comment">// \u56E0\u4E3Aspring\u5BB9\u5668\u4E2D\u6709\u591A\u4E2Arealm\uFF0C\u6240\u4EE5\u8BBE\u7F6E\u4E00\u4E0B\u4F18\u5148\u7EA7</span>
<span class="token keyword">public</span> <span class="token class-name">Realm</span> <span class="token function">getRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">CustomRealm</span> customRealm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u4FEE\u6539\u9ED8\u8BA4\u7684\u51ED\u8BC1\uFF08\u5BC6\u7801\uFF09\u5339\u914D\u5668</span>
    <span class="token keyword">final</span> <span class="token class-name">HashedCredentialsMatcher</span> credentialsMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashedCredentialsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8BBE\u7F6E\u52A0\u5BC6\u4E3Amd5\u7B97\u6CD5</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashAlgorithmName</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    credentialsMatcher<span class="token punctuation">.</span><span class="token function">setHashIterations</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setCredentialsMatcher</span><span class="token punctuation">(</span>credentialsMatcher<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5F00\u542F\u7F13\u5B58\u7BA1\u7406\u5668</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setCachingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u5F00\u542F\u5168\u5C40\u7F13\u5B58</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setAuthenticationCachingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8BA4\u8BC1\u7F13\u5B58</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setAuthenticationCacheName</span><span class="token punctuation">(</span><span class="token string">&quot;authenticationCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u8BBE\u7F6E\u7F13\u5B58\u540D\u5B57\u65B9\u4FBF\u67E5\u627E</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setAuthorizationCachingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u6388\u6743\u7F13\u5B58</span>
    customRealm<span class="token punctuation">.</span><span class="token function">setAuthorizationCacheName</span><span class="token punctuation">(</span><span class="token string">&quot;authorizationCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    customRealm<span class="token punctuation">.</span><span class="token function">setCacheManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EhCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> customRealm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F00\u542F\u4E86\u7F13\u5B58\u4E4B\u540E\uFF0C\u53EA\u6709\u5728\u7B2C\u4E00\u6B21\u67E5\u8BE2\u7684\u65F6\u5019\u4F1A\u53BB\u67E5\u8BE2\u6570\u636E\u5E93\uFF0C\u4E4B\u540E\u5C31\u4E0D\u4F1A\u4E86</p><h4 id="shiro\u4F7F\u7528redis\u7F13\u5B58"><a class="header-anchor" href="#shiro\u4F7F\u7528redis\u7F13\u5B58" aria-hidden="true">#</a> shiro\u4F7F\u7528redis\u7F13\u5B58</h4><ol><li>\u5F15\u5165\u4F9D\u8D56</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u914D\u7F6Eredis\u8FDE\u63A5</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>spring.redis.host=localhost
spring.redis.port=6379
spring.redis.database=0
spring.redis.password=123456
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>\u542F\u52A8redis</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">(</span>base<span class="token punctuation">)</span> aldencarter@aldencarter ~ % <span class="token function">ps</span> -ef <span class="token operator">|</span><span class="token function">grep</span> redis
  <span class="token number">501</span> <span class="token number">28122</span>     <span class="token number">1</span>   <span class="token number">0</span> \u56DB04\u4E0B\u5348 ??         <span class="token number">8</span>:16.15 redis-server <span class="token number">127.0</span>.0.1:6379 
  <span class="token number">501</span> <span class="token number">54220</span> <span class="token number">24999</span>   <span class="token number">0</span> <span class="token number">11</span>:01\u4E0B\u5348 ttys002    <span class="token number">0</span>:00.00 <span class="token function">grep</span> redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>\u5F00\u53D1RedisCacheManager</li></ol><p>\u6211\u4EEC\u53EF\u4EE5\u53C2\u7167EhCacheManager\u5B9E\u73B0\u65B9\u5F0F\uFF0CEhCacheManager\u5B9E\u73B0\u4E86CacheManager</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49redisCacheManager
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCacheManager</span> <span class="token keyword">implements</span> <span class="token class-name">CacheManager</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     *
     * <span class="token keyword">@param</span> <span class="token parameter">cacheName</span> \u8BA4\u8BC1\u6216\u8005\u662F\u6388\u6743\u7F13\u5B58\u7684\u7EDF\u4E00\u540D\u79F0\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u521A\u624D\u914D\u7F6E\u7684
     *          customRealm.setAuthenticationCacheName(&quot;authenticationCache&quot;);// \u8BBE\u7F6E\u7F13\u5B58\u540D\u5B57\u65B9\u4FBF\u67E5\u627E
     *          customRealm.setAuthorizationCacheName(&quot;authorizationCache&quot;);
     *          \u8FD9\u4E24\u4E2A
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>K<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>V<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">CacheException</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> cacheName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>\u5F00\u53D1RedisCache\u5B9E\u73B0</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49redis\u7F13\u5B58\u7684\u5B9E\u73B0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">,</span> <span class="token class-name">V</span> v<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>

        <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> <span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span> redisTemplate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token punctuation">)</span> <span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>\u5C06\u7F13\u5B58\u7BA1\u7406\u5668\u6539\u6210\u81EA\u5DF1\u7684</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>customRealm<span class="token punctuation">.</span><span class="token function">setCacheManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="7"><li><p>\u7B2C\u4E00\u6B21\u67E5\u8BE2\u4F1A\u67E5\u8BE2\u6570\u636E\u5E93\uFF0C\u518D\u6B21\u67E5\u8BE2\u4F1A\u4ECEredis\u4E2D\u83B7\u53D6</p></li><li><p>\u5982\u679C\u60F3\u8981\u5206\u5F00\u505A\u8BA4\u8BC1\u548C\u6388\u6743\u7684\u7F13\u5B58\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5C06cacheName\u4F20\u8F93\u7ED9redisCache</p></li></ol><p>\u90A3\u4E48\u5728set\u7684\u65F6\u5019\uFF0C\u5C31\u53EF\u4EE5\u901A\u8FC7hash\u7684\u65B9\u5F0F\u5B58\u50A8\u5230Redis\u4E2D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">,</span> <span class="token class-name">V</span> v<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>

    <span class="token comment">//getRedisTemplate().opsForValue().set(k.toString(), v);</span>

    <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">,</span> k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90A3\u4E48\u5728get\u7684\u65F6\u5019</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
    <span class="token comment">//return (V) getRedisTemplate().opsForValue().get(k.toString());</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">,</span> k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539getRedisTemplate\uFF0C\u6DFB\u52A0hash key\u5E8F\u5217\u5316\u65B9\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span> redisTemplate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token punctuation">)</span> <span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="9"><li>\u8BB0\u4F4F\u8981\u5C06\u5B9E\u4F53\u7C7B\uFF0C\u4E5F\u5C31\u662F\u8981\u5B58\u5165Redis\u7684\u6570\u636E\u5B9E\u73B0Serializable</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TPermission</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="10"><li>\u51FA\u73B0\u9519\u8BEF</li></ol><p><img src="`+R+'" alt=""></p><p>\u662F\u56E0\u4E3A\uFF0C\u6211\u4EEC\u914D\u7F6E\u7684salt\u4E0D\u80FD\u5B9E\u73B0\u5E8F\u5217\u5316</p><p><img src="'+x+`" alt=""></p><p>\u6211\u4EEC\u81EA\u5B9A\u4E49salt\u5B9E\u73B0\uFF0C\u5E76\u5B9E\u73B0\u5E8F\u5217\u5316\u63A5\u53E3</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49salt\u5B9E\u73B0\uFF0C\u5B9E\u73B0\u5E8F\u5217\u5316\u63A5\u53E3
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySimpleByteSource</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleByteSource</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CustomRealm.doGetAuthenticationInfo\u6539\u6210\u6211\u4EEC\u81EA\u5DF1\u7684\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E4B\u540E\u5C31\u53EF\u4EE5\u4E86\uFF0C\u4F46\u662F\u5982\u679C\u662F\u76F4\u63A5\u4F7F\u7528string\u7C7B\u578B\u7684\u5B58\u50A8\u5230redis\u4E2D\u7684\u8BDD\uFF0C\u5C31\u4F1A\u62A5\u9519\uFF0C\u5982\u679C\u4F7F\u7528Hash\u7C7B\u578B\u7684\u5B58\u50A8\u5C31\u4E0D\u4F1A\uFF0C\u4E4B\u540E\u5728\u770B\u770B</p><p>\u539F\u56E0\uFF1A\u56E0\u4E3ASimpleByteSource\u6CA1\u6709\u65E0\u53C2\u7684\u6784\u9020\uFF0C\u4F46\u662Fredis\u53CD\u5E8F\u5217\u5316\u53C8\u9700\u8981\u7528\u5230\u65E0\u53C2\u6784\u9020\uFF0C\u6240\u4EE5\u6211\u4EEC\u5B9E\u73B0ByteSource</p><p>\u76F4\u63A5\u590D\u5236SimpleByteSource\u4E2D\u7684\u4EE3\u7801\u6765\u4FEE\u6539\uFF0C\u7136\u540E\u5728\u589E\u52A0\u4E00\u4E2A\u65E0\u53C2\u6784\u9020</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49salt\u5B9E\u73B0\uFF0C\u5B9E\u73B0\u5E8F\u5217\u5316\u63A5\u53E3
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySimpleByteSource</span> <span class="token keyword">implements</span> <span class="token class-name">ByteSource</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cachedHex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cachedBase64<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> bytes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> <span class="token class-name">CodecSupport</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> <span class="token class-name">CodecSupport</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token class-name">ByteSource</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MySimpleByteSource<span class="token punctuation">.</span>BytesHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MySimpleByteSource</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MySimpleByteSource<span class="token punctuation">.</span>BytesHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isCompatible</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> o <span class="token keyword">instanceof</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">ByteSource</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">File</span> <span class="token operator">||</span> o <span class="token keyword">instanceof</span> <span class="token class-name">InputStream</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toHex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cachedHex <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cachedHex <span class="token operator">=</span> <span class="token class-name">Hex</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachedHex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toBase64</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cachedBase64 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cachedBase64 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cachedBase64<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toBase64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytes <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bytes<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">ByteSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ByteSource</span> bs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteSource</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bs<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">BytesHelper</span> <span class="token keyword">extends</span> <span class="token class-name">CodecSupport</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">BytesHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+I+`" alt=""></p><p>\u5B8C\u5584\u6574\u4E2ARedisCache</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u81EA\u5B9A\u4E49redis\u7F13\u5B58\u7684\u5B9E\u73B0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> cacheName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RedisCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">RedisCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> cacheName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cacheName <span class="token operator">=</span> cacheName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
        <span class="token comment">//return (V) getRedisTemplate().opsForValue().get(k.toString());</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">,</span> k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">,</span> <span class="token class-name">V</span> v<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>

        <span class="token comment">//getRedisTemplate().opsForValue().set(k.toString(), v);</span>

        <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">,</span> k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">V</span><span class="token punctuation">)</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">,</span>k<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CacheException</span> <span class="token punctuation">{</span>
        <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> <span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> <span class="token function">getRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span> redisTemplate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token punctuation">)</span> <span class="token class-name">ApplicationContextUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shiro\u52A0\u5165\u9A8C\u8BC1\u7801"><a class="header-anchor" href="#shiro\u52A0\u5165\u9A8C\u8BC1\u7801" aria-hidden="true">#</a> shiro\u52A0\u5165\u9A8C\u8BC1\u7801</h3><ol><li>\u6539\u9020\u767B\u5F55\u9875\u9762</li></ol><p><img src="`+C+'" alt=""></p><ol start="2"><li>\u83B7\u53D6\u9A8C\u8BC1\u7801</li></ol><p><img src="'+_+'" alt=""></p><ol start="3"><li><p>shiro\u653E\u884C\u83B7\u53D6\u9A8C\u8BC1\u7801\u7684\u8BF7\u6C42</p></li><li><p>\u7136\u540E\u5C31\u662F\u5728\u767B\u5F55\u65B9\u6CD5\u4E2D\u9A8C\u8BC1\u901A\u8FC7\u9A8C\u8BC1\u7801\u518D\u8FDB\u884C\u767B\u5F55\u64CD\u4F5C</p></li></ol><p><img src="'+M+'" alt=""></p><ul><li>\u4ECEsession\u4E2D\u83B7\u53D6\u5230\u9A8C\u8BC1\u7801</li><li>\u6BD4\u8F83\u9A8C\u8BC1\u7801</li><li>\u8FDB\u884C\u540E\u7EED\u7684\u64CD\u4F5C</li></ul><ol start="5"><li>\u7ED3\u679C</li></ol><p><img src="'+U+`" alt=""></p><h3 id="shiro\u6807\u7B7E\u5C55\u793A\u7528\u6237\u8EAB\u4EFD\u4FE1\u606F"><a class="header-anchor" href="#shiro\u6807\u7B7E\u5C55\u793A\u7528\u6237\u8EAB\u4EFD\u4FE1\u606F" aria-hidden="true">#</a> shiro\u6807\u7B7E\u5C55\u793A\u7528\u6237\u8EAB\u4EFD\u4FE1\u606F</h3><div class="language-jsp ext-jsp line-numbers-mode"><pre class="language-jsp"><code>&lt;%--\u7528\u6237\u7684\u4E3B\u8EAB\u4EFD\u4FE1\u606F--%&gt;
&lt;h1&gt;&lt;shiro:principal/&gt;&lt;/h1&gt;
&lt;shiro:authenticated&gt;
    \u8BA4\u8BC1\u4E4B\u540E\u5C55\u793A\u7684\u5185\u5BB9\uFF0C\u6BD4\u5982\u672A\u767B\u5F55\u663E\u793A\u767B\u5F55\u6309\u94AE\uFF0C\u5DF2\u7ECF\u767B\u5F55\u663E\u793A\u7528\u6237\u540D
&lt;/shiro:authenticated&gt;
&lt;shiro:notAuthenticated&gt;
    \u6CA1\u6709\u8BA4\u8BC1\u5C55\u793A\u7684\u5185\u5BB9
&lt;/shiro:notAuthenticated&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="shiro\u5728springboot-thymeleaf\u4E2D\u7684\u5E94\u7528"><a class="header-anchor" href="#shiro\u5728springboot-thymeleaf\u4E2D\u7684\u5E94\u7528" aria-hidden="true">#</a> shiro\u5728springboot+thymeleaf\u4E2D\u7684\u5E94\u7528</h2><p>\u5148\u521B\u5EFAspringboot+thymeleaf\u9879\u76EE</p><p>\u62FF\u4E0A\u9762\u7684jsp\u6539\u6210thymeleaf</p><h3 id="\u5E38\u89C1\u7684\u6743\u9650\u63A7\u5236\u6807\u7B7E\u7684\u4F7F\u7528"><a class="header-anchor" href="#\u5E38\u89C1\u7684\u6743\u9650\u63A7\u5236\u6807\u7B7E\u7684\u4F7F\u7528" aria-hidden="true">#</a> \u5E38\u89C1\u7684\u6743\u9650\u63A7\u5236\u6807\u7B7E\u7684\u4F7F\u7528</h3><ol><li>\u5F15\u5165\u4F9D\u8D56</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.theborakompanioni<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u5F15\u5165\u547D\u540D\u7A7A\u95F4</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>shiro</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.pollix.at/thymeleaf/shiro<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>\u5E38\u89C1\u7684\u6743\u9650\u63A7\u5236\u6807\u7B7E</li></ol><p><img src="`+N+'" alt=""></p><p><img src="'+L+`" alt=""></p><ol start="4"><li>\u52A0\u5165shiro\u7684\u65B9\u8A00\u914D\u7F6E</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;shiroDialect&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ShiroDialect</span> <span class="token function">shiroDialect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ShiroDialect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//  .......\u5176\u4ED6\u914D\u7F6E</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,352);function P(D,O){return F}var H=n(B,[["render",P],["__file","01.shiro\u57FA\u7840.html.vue"]]);export{H as default};
